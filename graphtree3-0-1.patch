diff -x graphtree -Naru ./README.md graphtree/README.md
--- ./README.md	1970-01-01 08:00:00.000000000 +0800
+++ graphtree/README.md	2016-04-18 18:46:03.000000000 +0800
@@ -0,0 +1 @@
+#OneOaas-Zabbix301
diff -x graphtree -Naru ./biggraph.php graphtree/biggraph.php
--- ./biggraph.php	1970-01-01 08:00:00.000000000 +0800
+++ graphtree/biggraph.php	2016-04-18 18:46:02.000000000 +0800
@@ -0,0 +1,166 @@
+<?php
+    /*
+    ** Zabbix
+    ** Copyright (C) 2001-2015 Zabbix SIA
+    **
+    ** This program is free software; you can redistribute it and/or modify
+    ** it under the terms of the GNU General Public License as published by
+    ** the Free Software Foundation; either version 2 of the License, or
+    ** (at your option) any later version.
+    **
+    ** This program is distributed in the hope that it will be useful,
+    ** but WITHOUT ANY WARRANTY; without even the implied warranty of
+    ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+    ** GNU General Public License for more details.
+    **
+    ** You should have received a copy of the GNU General Public License
+    ** along with this program; if not, write to the Free Software
+    ** Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+    **/
+
+
+    require_once dirname(__FILE__) . '/include/config.inc.php';
+    require_once dirname(__FILE__) . '/include/hosts.inc.php';
+    require_once dirname(__FILE__) . '/include/graphs.inc.php';
+
+    $page['title'] = _('Big graphs');
+    $page['file'] = 'biggraph.php';
+    $page['hist_arg'] = array('hostid', 'groupid', 'graphid');
+    $page['scripts'] = array('class.calendar.js', 'gtlc.js', 'flickerfreescreen.js');
+    $page['type'] = detect_page_type(PAGE_TYPE_HTML);
+
+    define('ZBX_PAGE_DO_JS_REFRESH', 1);
+    define('ZBX_PAGE_NO_MENU', 1);
+
+    ob_start();
+    require_once dirname(__FILE__) . '/include/page_header.php';
+
+    // VAR	TYPE	OPTIONAL	FLAGS	VALIDATION	EXCEPTION
+    $fields = array(
+        'groupid'     => array(T_ZBX_INT, O_OPT, P_SYS, DB_ID, null),
+        'hostid'      => array(T_ZBX_INT, O_OPT, P_SYS, DB_ID, null),
+        'graphid'     => array(T_ZBX_INT, O_OPT, P_SYS, DB_ID, null),
+        'period'      => array(T_ZBX_INT, O_OPT, P_SYS, null, null),
+        'stime'       => array(T_ZBX_STR, O_OPT, P_SYS, null, null),
+        'fullscreen'  => array(T_ZBX_INT, O_OPT, P_SYS, IN('0,1'), null),
+        // ajax
+        'filterState' => array(T_ZBX_INT, O_OPT, P_ACT, null, null),
+        'favobj'      => array(T_ZBX_STR, O_OPT, P_ACT, null, null),
+        'favid'       => array(T_ZBX_INT, O_OPT, P_ACT, null, null),
+        'favaction'   => array(T_ZBX_STR, O_OPT, P_ACT, IN('"add","remove"'), null)
+    );
+    check_fields($fields);
+
+    /*
+     * Permissions
+     */
+    if (getRequest('groupid') && !API::HostGroup()->isReadable(array($_REQUEST['groupid']))) {
+        access_deny();
+    }
+    if (getRequest('hostid') && !API::Host()->isReadable(array($_REQUEST['hostid']))) {
+        access_deny();
+    }
+
+    if (getRequest('graphid')) {
+        $graphs = API::Graph()->get(array(
+            'graphids' => array($_REQUEST['graphid']),
+            'output'   => array('graphid')
+        ));
+        if (!$graphs) {
+            access_deny();
+        }
+    }
+
+
+    $pageFilter = new CPageFilter(array(
+        'groups'  => array('real_hosts' => true, 'with_graphs' => true),
+        'hosts'   => array('with_graphs' => true),
+        'groupid' => getRequest('groupid'),
+        'hostid'  => getRequest('hostid'),
+        'graphs'  => array('templated' => 0),
+        'graphid' => getRequest('graphid')
+    ));
+
+    /*
+     * Ajax
+     */
+    if (hasRequest('filterState')) {
+        CProfile::update('web.biggraph.filter.state', getRequest('filterState'), PROFILE_TYPE_INT);
+    }
+
+    if (isset($_REQUEST['favobj'])) {
+        if (getRequest('favobj') === 'timelinefixedperiod' && hasRequest('favid')) {
+            CProfile::update('web.biggraph.timelinefixed', getRequest('favid'), PROFILE_TYPE_INT);
+        }
+
+        if (str_in_array($_REQUEST['favobj'], array('itemid', 'graphid'))) {
+            $result = false;
+
+            DBstart();
+
+            if ($_REQUEST['favaction'] == 'add') {
+                $result = CFavorite::add('web.favorite.graphids', $_REQUEST['favid'], $_REQUEST['favobj']);
+                if ($result) {
+                    echo '$("addrm_fav").title = "' . _('Remove from favourites') . '";' . "\n";
+                    echo '$("addrm_fav").onclick = function() { rm4favorites("graphid", "' . $_REQUEST['favid'] . '"); }' . "\n";
+                }
+            } elseif ($_REQUEST['favaction'] == 'remove') {
+                $result = CFavorite::remove('web.favorite.graphids', $_REQUEST['favid'], $_REQUEST['favobj']);
+                if ($result) {
+                    echo '$("addrm_fav").title = "' . _('Add to favourites') . '";' . "\n";
+                    echo '$("addrm_fav").onclick = function() { add2favorites("graphid", "' . $_REQUEST['favid'] . '"); }' . "\n";
+                }
+            }
+
+            $result = DBend($result);
+
+            if ($page['type'] == PAGE_TYPE_JS && $result) {
+                echo 'switchElementClass("addrm_fav", "iconminus", "iconplus");';
+            }
+        }
+    }
+
+    if (!empty($_REQUEST['period']) || !empty($_REQUEST['stime'])) {
+        CScreenBase::calculateTime(array(
+            'profileIdx'    => 'web.biggraph',
+            'profileIdx2'   => $pageFilter->graphid,
+            'updateProfile' => true,
+            'period'        => getRequest('period'),
+            'stime'         => getRequest('stime')
+        ));
+
+        $curl = new CUrl();
+        $curl->removeArgument('period');
+        $curl->removeArgument('stime');
+
+        ob_end_clean();
+
+        DBstart();
+        CProfile::flush();
+        DBend();
+        redirect($curl->getUrl());
+    }
+
+    ob_end_flush();
+
+
+    if ($page['type'] == PAGE_TYPE_JS || $page['type'] == PAGE_TYPE_HTML_BLOCK) {
+        require_once dirname(__FILE__) . '/include/page_footer.php';
+        exit;
+    }
+
+    /*
+     * Display
+     */
+    $data = array(
+        'pageFilter' => $pageFilter,
+        'graphid'    => $pageFilter->graphid,
+        'fullscreen' => $_REQUEST['fullscreen']
+    );
+
+    // render view
+    $chartsView = new CView('monitoring.charts', $data);
+    $chartsView->render();
+    $chartsView->show();
+
+    require_once dirname(__FILE__) . '/include/page_footer.php';
diff -x graphtree -Naru ./conf/maintenance.inc.php graphtree/conf/maintenance.inc.php
--- ./conf/maintenance.inc.php	2016-02-26 17:45:56.000000000 +0800
+++ graphtree/conf/maintenance.inc.php	1970-01-01 08:00:00.000000000 +0800
@@ -1,29 +0,0 @@
-<?php
-/*
-** Zabbix
-** Copyright (C) 2001-2016 Zabbix SIA
-**
-** This program is free software; you can redistribute it and/or modify
-** it under the terms of the GNU General Public License as published by
-** the Free Software Foundation; either version 2 of the License, or
-** (at your option) any later version.
-**
-** This program is distributed in the hope that it will be useful,
-** but WITHOUT ANY WARRANTY; without even the implied warranty of
-** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
-** GNU General Public License for more details.
-**
-** You should have received a copy of the GNU General Public License
-** along with this program; if not, write to the Free Software
-** Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
-**/
-
-
-// Maintenance mode
-//define('ZBX_DENY_GUI_ACCESS', 1);
-
-// IP range, who are allowed to connect to FrontEnd
-//$ZBX_GUI_ACCESS_IP_RANGE = array('127.0.0.1');
-
-// MSG shown on Warning screen!
-//$_REQUEST['warning_msg'] = 'Zabbix is under maintenance.';
diff -x graphtree -Naru ./conf/zabbix.conf.php.example graphtree/conf/zabbix.conf.php.example
--- ./conf/zabbix.conf.php.example	2016-02-26 17:45:56.000000000 +0800
+++ graphtree/conf/zabbix.conf.php.example	1970-01-01 08:00:00.000000000 +0800
@@ -1,19 +0,0 @@
-<?php
-// Zabbix GUI configuration file.
-global $DB;
-
-$DB['TYPE']				= 'MYSQL';
-$DB['SERVER']			= 'localhost';
-$DB['PORT']				= '0';
-$DB['DATABASE']			= 'zabbix';
-$DB['USER']				= 'zabbix';
-$DB['PASSWORD']			= '';
-// Schema name. Used for IBM DB2 and PostgreSQL.
-$DB['SCHEMA']			= '';
-
-$ZBX_SERVER				= 'localhost';
-$ZBX_SERVER_PORT		= '10051';
-$ZBX_SERVER_NAME		= '';
-
-$IMAGE_FORMAT_DEFAULT	= IMAGE_FORMAT_PNG;
-?>
diff -x graphtree -Naru ./graphtree.left.php graphtree/graphtree.left.php
--- ./graphtree.left.php	1970-01-01 08:00:00.000000000 +0800
+++ graphtree/graphtree.left.php	2016-04-18 18:46:02.000000000 +0800
@@ -0,0 +1,140 @@
+<?php
+
+require_once dirname(__FILE__) . '/include/config.inc.php';
+
+$type = getRequest("type", "");
+if ($type === "zTree") {
+    $page['scripts'] = ["jquery.ztree.core-3.5.js", "graphtree.js"];
+    $page['type'] = detect_page_type(PAGE_TYPE_HTML);
+    $page['css'] = ["ztree/zTreeStyle.css"];
+    define("ZBX_PAGE_NO_MENU", 1);
+    define("ZBX_PAGE_NO_HEADER", 1);
+    define("ZBX_PAGE_NO_THEME", 1);
+
+    require_once dirname(__FILE__) . '/include/page_header.php';
+
+    $left_tree = new CTag("ul", "yes");
+    $left_tree->setAttribute("id", "graphtree");
+    $left_tree->setAttribute("class", "ztree");
+
+    $graphtreeJs = <<<GRAPHJS
+
+        var zTree;
+        var setting = {
+            view: {
+                dblClickExpand: false
+            },
+            async: { //异步加载请求数据
+                enable: true,
+                url: "graphtree.left.php",
+                autoParam: ["groupid=groupid", "hostid=hostid"], //请求的参数即groupid=nodeid
+                otherParam: {"timestamp": new Date().getTime()},
+                type: "get"
+            },
+            callback: {}
+        };
+
+        jQuery(document).ready(function () {
+            jQuery.fn.zTree.init(jQuery("#graphtree"), setting);
+            //右键菜单
+            zTree = jQuery.fn.zTree.getZTreeObj("graphtree");
+        });
+GRAPHJS;
+    insert_js($graphtreeJs, true);
+    $left_tree->show();
+} else {
+    $groupid = getRequest("groupid", 0);
+    $hostid = getRequest("hostid", 0);
+
+    if ($groupid > 0) {
+        //根据分组id查询分组下的机器
+        $hosts = API::Host()->get([
+            "output"          => ["hostid", "host", "name"],
+            "monitored_hosts" => true,
+            "groupids"        => [$groupid],
+            "sortfield"       => ["host"],
+            "sortorder"       => ["ASC"]
+        ]);
+
+        $new_list = $hosts;
+        foreach ($hosts as &$each_host) {
+            $each_host['target'] = 'rightFrame';
+            $each_host['isParent'] = "true";
+            $app_count = API::Application()->get([
+                'countOutput' => "1",
+                'hostids'     => $each_host['hostid']
+            ]);
+            $each_host['name'] = $each_host['name'] . '(' . $app_count . ')';
+            $each_host['url'] = 'graphtree.right.php?hostid=' . $each_host['hostid'];
+        }
+        unset($each_host);
+        echo json_encode(array_values($hosts));
+    } else {
+        if ($groupid == 0) {
+            if ($hostid == 0) {
+                //查询所有的分组列表
+                $groups = API::HostGroup()->get([
+                    "output"               => "extend",
+                    "monitored_hosts"      => true,
+                    "with_monitored_items" => 1,
+                    "sortfield"            => "name"
+                ]);
+
+                //$groups = getAvailableHostGroup();
+                foreach ($groups as &$each) {
+                    $each['id'] = $each['groupid'];
+                    $each['isParent'] = true;
+                    $each['target'] = 'rightFrame';
+                    $each['url'] = 'graphtree.right.php?groupid=' . $each['groupid'];
+
+                    //查询下面有多少机器
+                    $hosts = API::Host()->get([
+                        "output"          => "extend",
+                        "monitored_hosts" => true,
+                        "groupids"        => [$each['groupid']]
+                    ]);
+
+                    $each['name'] = $each['name'] . '(' . count($hosts) . ')';
+                }
+                /*$groups[] = array(
+                    'groupid' => -1,
+                    'name' => 'others',
+                    'internal' => 0 ,
+                    'flags'=> 0,
+                    'id' => -1,
+                    'isParent' => 1,
+                    'target' => 'rightFrame',
+                    'url' => 'graphtree.right.php?groupid=-1'
+                );*/
+                echo json_encode($groups);
+            } else {
+                $applications = API::Application()->get([
+                    "output"    => "extend",
+                    "hostids"   => [$hostid],
+                    "sortfield" => ["name"],
+                    "sortorder" => ["ASC"]
+                ]);
+
+                if (is_array($applications)) {
+                    foreach ($applications as &$each) {
+                        $each['target'] = 'rightFrame';
+                        $each['url'] = 'graphtree.right.php?applicationid=' . $each['applicationid'];
+                    }
+                }
+
+                echo json_encode($applications);
+            }
+        }
+    }/*else{
+            $other_items = array(
+                'applicationid' => 10000,
+                'name' => "other_001",
+                'target' => 'rightFrame',
+                'url' => 'graphtree.right.php?applicationid=10000'
+            );
+            echo json_encode($other_items);
+        }*/
+}
+
+
+
diff -x graphtree -Naru ./graphtree.patch graphtree/graphtree.patch
--- ./graphtree.patch	2016-04-18 18:47:19.000000000 +0800
+++ graphtree/graphtree.patch	1970-01-01 08:00:00.000000000 +0800
@@ -1,375 +0,0 @@
-diff -x graphtree -Naru ./README.md graphtree/README.md
---- ./README.md	1970-01-01 08:00:00.000000000 +0800
-+++ graphtree/README.md	2016-04-18 18:46:03.000000000 +0800
-@@ -0,0 +1 @@
-+#OneOaas-Zabbix301
-diff -x graphtree -Naru ./biggraph.php graphtree/biggraph.php
---- ./biggraph.php	1970-01-01 08:00:00.000000000 +0800
-+++ graphtree/biggraph.php	2016-04-18 18:46:02.000000000 +0800
-@@ -0,0 +1,166 @@
-+<?php
-+    /*
-+    ** Zabbix
-+    ** Copyright (C) 2001-2015 Zabbix SIA
-+    **
-+    ** This program is free software; you can redistribute it and/or modify
-+    ** it under the terms of the GNU General Public License as published by
-+    ** the Free Software Foundation; either version 2 of the License, or
-+    ** (at your option) any later version.
-+    **
-+    ** This program is distributed in the hope that it will be useful,
-+    ** but WITHOUT ANY WARRANTY; without even the implied warranty of
-+    ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
-+    ** GNU General Public License for more details.
-+    **
-+    ** You should have received a copy of the GNU General Public License
-+    ** along with this program; if not, write to the Free Software
-+    ** Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
-+    **/
-+
-+
-+    require_once dirname(__FILE__) . '/include/config.inc.php';
-+    require_once dirname(__FILE__) . '/include/hosts.inc.php';
-+    require_once dirname(__FILE__) . '/include/graphs.inc.php';
-+
-+    $page['title'] = _('Big graphs');
-+    $page['file'] = 'biggraph.php';
-+    $page['hist_arg'] = array('hostid', 'groupid', 'graphid');
-+    $page['scripts'] = array('class.calendar.js', 'gtlc.js', 'flickerfreescreen.js');
-+    $page['type'] = detect_page_type(PAGE_TYPE_HTML);
-+
-+    define('ZBX_PAGE_DO_JS_REFRESH', 1);
-+    define('ZBX_PAGE_NO_MENU', 1);
-+
-+    ob_start();
-+    require_once dirname(__FILE__) . '/include/page_header.php';
-+
-+    // VAR	TYPE	OPTIONAL	FLAGS	VALIDATION	EXCEPTION
-+    $fields = array(
-+        'groupid'     => array(T_ZBX_INT, O_OPT, P_SYS, DB_ID, null),
-+        'hostid'      => array(T_ZBX_INT, O_OPT, P_SYS, DB_ID, null),
-+        'graphid'     => array(T_ZBX_INT, O_OPT, P_SYS, DB_ID, null),
-+        'period'      => array(T_ZBX_INT, O_OPT, P_SYS, null, null),
-+        'stime'       => array(T_ZBX_STR, O_OPT, P_SYS, null, null),
-+        'fullscreen'  => array(T_ZBX_INT, O_OPT, P_SYS, IN('0,1'), null),
-+        // ajax
-+        'filterState' => array(T_ZBX_INT, O_OPT, P_ACT, null, null),
-+        'favobj'      => array(T_ZBX_STR, O_OPT, P_ACT, null, null),
-+        'favid'       => array(T_ZBX_INT, O_OPT, P_ACT, null, null),
-+        'favaction'   => array(T_ZBX_STR, O_OPT, P_ACT, IN('"add","remove"'), null)
-+    );
-+    check_fields($fields);
-+
-+    /*
-+     * Permissions
-+     */
-+    if (getRequest('groupid') && !API::HostGroup()->isReadable(array($_REQUEST['groupid']))) {
-+        access_deny();
-+    }
-+    if (getRequest('hostid') && !API::Host()->isReadable(array($_REQUEST['hostid']))) {
-+        access_deny();
-+    }
-+
-+    if (getRequest('graphid')) {
-+        $graphs = API::Graph()->get(array(
-+            'graphids' => array($_REQUEST['graphid']),
-+            'output'   => array('graphid')
-+        ));
-+        if (!$graphs) {
-+            access_deny();
-+        }
-+    }
-+
-+
-+    $pageFilter = new CPageFilter(array(
-+        'groups'  => array('real_hosts' => true, 'with_graphs' => true),
-+        'hosts'   => array('with_graphs' => true),
-+        'groupid' => getRequest('groupid'),
-+        'hostid'  => getRequest('hostid'),
-+        'graphs'  => array('templated' => 0),
-+        'graphid' => getRequest('graphid')
-+    ));
-+
-+    /*
-+     * Ajax
-+     */
-+    if (hasRequest('filterState')) {
-+        CProfile::update('web.biggraph.filter.state', getRequest('filterState'), PROFILE_TYPE_INT);
-+    }
-+
-+    if (isset($_REQUEST['favobj'])) {
-+        if (getRequest('favobj') === 'timelinefixedperiod' && hasRequest('favid')) {
-+            CProfile::update('web.biggraph.timelinefixed', getRequest('favid'), PROFILE_TYPE_INT);
-+        }
-+
-+        if (str_in_array($_REQUEST['favobj'], array('itemid', 'graphid'))) {
-+            $result = false;
-+
-+            DBstart();
-+
-+            if ($_REQUEST['favaction'] == 'add') {
-+                $result = CFavorite::add('web.favorite.graphids', $_REQUEST['favid'], $_REQUEST['favobj']);
-+                if ($result) {
-+                    echo '$("addrm_fav").title = "' . _('Remove from favourites') . '";' . "\n";
-+                    echo '$("addrm_fav").onclick = function() { rm4favorites("graphid", "' . $_REQUEST['favid'] . '"); }' . "\n";
-+                }
-+            } elseif ($_REQUEST['favaction'] == 'remove') {
-+                $result = CFavorite::remove('web.favorite.graphids', $_REQUEST['favid'], $_REQUEST['favobj']);
-+                if ($result) {
-+                    echo '$("addrm_fav").title = "' . _('Add to favourites') . '";' . "\n";
-+                    echo '$("addrm_fav").onclick = function() { add2favorites("graphid", "' . $_REQUEST['favid'] . '"); }' . "\n";
-+                }
-+            }
-+
-+            $result = DBend($result);
-+
-+            if ($page['type'] == PAGE_TYPE_JS && $result) {
-+                echo 'switchElementClass("addrm_fav", "iconminus", "iconplus");';
-+            }
-+        }
-+    }
-+
-+    if (!empty($_REQUEST['period']) || !empty($_REQUEST['stime'])) {
-+        CScreenBase::calculateTime(array(
-+            'profileIdx'    => 'web.biggraph',
-+            'profileIdx2'   => $pageFilter->graphid,
-+            'updateProfile' => true,
-+            'period'        => getRequest('period'),
-+            'stime'         => getRequest('stime')
-+        ));
-+
-+        $curl = new CUrl();
-+        $curl->removeArgument('period');
-+        $curl->removeArgument('stime');
-+
-+        ob_end_clean();
-+
-+        DBstart();
-+        CProfile::flush();
-+        DBend();
-+        redirect($curl->getUrl());
-+    }
-+
-+    ob_end_flush();
-+
-+
-+    if ($page['type'] == PAGE_TYPE_JS || $page['type'] == PAGE_TYPE_HTML_BLOCK) {
-+        require_once dirname(__FILE__) . '/include/page_footer.php';
-+        exit;
-+    }
-+
-+    /*
-+     * Display
-+     */
-+    $data = array(
-+        'pageFilter' => $pageFilter,
-+        'graphid'    => $pageFilter->graphid,
-+        'fullscreen' => $_REQUEST['fullscreen']
-+    );
-+
-+    // render view
-+    $chartsView = new CView('monitoring.charts', $data);
-+    $chartsView->render();
-+    $chartsView->show();
-+
-+    require_once dirname(__FILE__) . '/include/page_footer.php';
-diff -x graphtree -Naru ./conf/maintenance.inc.php graphtree/conf/maintenance.inc.php
---- ./conf/maintenance.inc.php	2016-02-26 17:45:56.000000000 +0800
-+++ graphtree/conf/maintenance.inc.php	1970-01-01 08:00:00.000000000 +0800
-@@ -1,29 +0,0 @@
--<?php
--/*
--** Zabbix
--** Copyright (C) 2001-2016 Zabbix SIA
--**
--** This program is free software; you can redistribute it and/or modify
--** it under the terms of the GNU General Public License as published by
--** the Free Software Foundation; either version 2 of the License, or
--** (at your option) any later version.
--**
--** This program is distributed in the hope that it will be useful,
--** but WITHOUT ANY WARRANTY; without even the implied warranty of
--** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
--** GNU General Public License for more details.
--**
--** You should have received a copy of the GNU General Public License
--** along with this program; if not, write to the Free Software
--** Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
--**/
--
--
--// Maintenance mode
--//define('ZBX_DENY_GUI_ACCESS', 1);
--
--// IP range, who are allowed to connect to FrontEnd
--//$ZBX_GUI_ACCESS_IP_RANGE = array('127.0.0.1');
--
--// MSG shown on Warning screen!
--//$_REQUEST['warning_msg'] = 'Zabbix is under maintenance.';
-diff -x graphtree -Naru ./conf/zabbix.conf.php.example graphtree/conf/zabbix.conf.php.example
---- ./conf/zabbix.conf.php.example	2016-02-26 17:45:56.000000000 +0800
-+++ graphtree/conf/zabbix.conf.php.example	1970-01-01 08:00:00.000000000 +0800
-@@ -1,19 +0,0 @@
--<?php
--// Zabbix GUI configuration file.
--global $DB;
--
--$DB['TYPE']				= 'MYSQL';
--$DB['SERVER']			= 'localhost';
--$DB['PORT']				= '0';
--$DB['DATABASE']			= 'zabbix';
--$DB['USER']				= 'zabbix';
--$DB['PASSWORD']			= '';
--// Schema name. Used for IBM DB2 and PostgreSQL.
--$DB['SCHEMA']			= '';
--
--$ZBX_SERVER				= 'localhost';
--$ZBX_SERVER_PORT		= '10051';
--$ZBX_SERVER_NAME		= '';
--
--$IMAGE_FORMAT_DEFAULT	= IMAGE_FORMAT_PNG;
--?>
-diff -x graphtree -Naru ./graphtree.left.php graphtree/graphtree.left.php
---- ./graphtree.left.php	1970-01-01 08:00:00.000000000 +0800
-+++ graphtree/graphtree.left.php	2016-04-18 18:46:02.000000000 +0800
-@@ -0,0 +1,140 @@
-+<?php
-+
-+require_once dirname(__FILE__) . '/include/config.inc.php';
-+
-+$type = getRequest("type", "");
-+if ($type === "zTree") {
-+    $page['scripts'] = ["jquery.ztree.core-3.5.js", "graphtree.js"];
-+    $page['type'] = detect_page_type(PAGE_TYPE_HTML);
-+    $page['css'] = ["ztree/zTreeStyle.css"];
-+    define("ZBX_PAGE_NO_MENU", 1);
-+    define("ZBX_PAGE_NO_HEADER", 1);
-+    define("ZBX_PAGE_NO_THEME", 1);
-+
-+    require_once dirname(__FILE__) . '/include/page_header.php';
-+
-+    $left_tree = new CTag("ul", "yes");
-+    $left_tree->setAttribute("id", "graphtree");
-+    $left_tree->setAttribute("class", "ztree");
-+
-+    $graphtreeJs = <<<GRAPHJS
-+
-+        var zTree;
-+        var setting = {
-+            view: {
-+                dblClickExpand: false
-+            },
-+            async: { //异步加载请求数据
-+                enable: true,
-+                url: "graphtree.left.php",
-+                autoParam: ["groupid=groupid", "hostid=hostid"], //请求的参数即groupid=nodeid
-+                otherParam: {"timestamp": new Date().getTime()},
-+                type: "get"
-+            },
-+            callback: {}
-+        };
-+
-+        jQuery(document).ready(function () {
-+            jQuery.fn.zTree.init(jQuery("#graphtree"), setting);
-+            //右键菜单
-+            zTree = jQuery.fn.zTree.getZTreeObj("graphtree");
-+        });
-+GRAPHJS;
-+    insert_js($graphtreeJs, true);
-+    $left_tree->show();
-+} else {
-+    $groupid = getRequest("groupid", 0);
-+    $hostid = getRequest("hostid", 0);
-+
-+    if ($groupid > 0) {
-+        //根据分组id查询分组下的机器
-+        $hosts = API::Host()->get([
-+            "output"          => ["hostid", "host", "name"],
-+            "monitored_hosts" => true,
-+            "groupids"        => [$groupid],
-+            "sortfield"       => ["host"],
-+            "sortorder"       => ["ASC"]
-+        ]);
-+
-+        $new_list = $hosts;
-+        foreach ($hosts as &$each_host) {
-+            $each_host['target'] = 'rightFrame';
-+            $each_host['isParent'] = "true";
-+            $app_count = API::Application()->get([
-+                'countOutput' => "1",
-+                'hostids'     => $each_host['hostid']
-+            ]);
-+            $each_host['name'] = $each_host['name'] . '(' . $app_count . ')';
-+            $each_host['url'] = 'graphtree.right.php?hostid=' . $each_host['hostid'];
-+        }
-+        unset($each_host);
-+        echo json_encode(array_values($hosts));
-+    } else {
-+        if ($groupid == 0) {
-+            if ($hostid == 0) {
-+                //查询所有的分组列表
-+                $groups = API::HostGroup()->get([
-+                    "output"               => "extend",
-+                    "monitored_hosts"      => true,
-+                    "with_monitored_items" => 1,
-+                    "sortfield"            => "name"
-+                ]);
-+
-+                //$groups = getAvailableHostGroup();
-+                foreach ($groups as &$each) {
-+                    $each['id'] = $each['groupid'];
-+                    $each['isParent'] = true;
-+                    $each['target'] = 'rightFrame';
-+                    $each['url'] = 'graphtree.right.php?groupid=' . $each['groupid'];
-+
-+                    //查询下面有多少机器
-+                    $hosts = API::Host()->get([
-+                        "output"          => "extend",
-+                        "monitored_hosts" => true,
-+                        "groupids"        => [$each['groupid']]
-+                    ]);
-+
-+                    $each['name'] = $each['name'] . '(' . count($hosts) . ')';
-+                }
-+                /*$groups[] = array(
-+                    'groupid' => -1,
-+                    'name' => 'others',
-+                    'internal' => 0 ,
-+                    'flags'=> 0,
-+                    'id' => -1,
-+                    'isParent' => 1,
-+                    'target' => 'rightFrame',
-+                    'url' => 'graphtree.right.php?groupid=-1'
-+                );*/
-+                echo json_encode($groups);
-+            } else {
-+                $applications = API::Application()->get([
-+                    "output"    => "extend",
-+                    "hostids"   => [$hostid],
-+                    "sortfield" => ["name"],
-+                    "sortorder" => ["ASC"]
-+                ]);
-+
-+                if (is_array($applications)) {
-+                    foreach ($applications as &$each) {
-+                        $each['target'] = 'rightFrame';
-+                        $each['url'] = 'graphtree.right.php?applicationid=' . $each['applicationid'];
-+                    }
-+                }
-+
-+                echo json_encode($applications);
-+            }
-+        }
-+    }/*else{
-+            $other_items = array(
-+                'applicationid' => 10000,
-+                'name' => "other_001",
-+                'target' => 'rightFrame',
-+                'url' => 'graphtree.right.php?applicationid=10000'
-+            );
-+            echo json_encode($other_items);
-+        }*/
-+}
-+
-+
-+
diff -x graphtree -Naru ./graphtree.right.php graphtree/graphtree.right.php
--- ./graphtree.right.php	1970-01-01 08:00:00.000000000 +0800
+++ graphtree/graphtree.right.php	2016-04-18 18:46:02.000000000 +0800
@@ -0,0 +1,354 @@
+<?php
+require_once dirname(__FILE__) . '/include/config.inc.php';
+require_once dirname(__FILE__) . '/include/hosts.inc.php';
+include_once dirname(__FILE__) . '/include/items.inc.php';
+require_once dirname(__FILE__) . '/include/graphs.inc.php';
+
+$page['title'] = _('Graph trees');
+$page['file'] = 'graphtree.right.php';
+$page['hist_arg'] = ['hostid', 'groupid', 'graphid'];
+$page['scripts'] = ['class.calendar.js', 'gtlc.js', 'flickerfreescreen.js'];
+$page['type'] = detect_page_type(PAGE_TYPE_HTML);
+
+define("ZBX_PAGE_NO_MENU", 1);
+define("ZBX_PAGE_NO_HEADER", 1);
+require_once dirname(__FILE__) . '/include/page_header.php';
+
+// VAR	TYPE	OPTIONAL	FLAGS	VALIDATION	EXCEPTION
+$fields = [
+    'groupid'       => [T_ZBX_INT, O_OPT, P_SYS, DB_ID, null],
+    'hostid'        => [T_ZBX_INT, O_OPT, P_SYS, DB_ID, null],
+    'graphid'       => [T_ZBX_INT, O_OPT, P_SYS, DB_ID, null],
+    'applicationid' => [T_ZBX_INT, O_OPT, P_SYS, DB_ID, null],
+    'period'        => [T_ZBX_INT, O_OPT, P_SYS, null, null],
+    'stime'         => [T_ZBX_STR, O_OPT, P_SYS, null, null],
+    'fullscreen'    => [T_ZBX_INT, O_OPT, P_SYS, IN('0,1'), null],
+    // ajax
+    'filterState'   => [T_ZBX_INT, O_OPT, P_ACT, null, null],
+    'favobj'        => [T_ZBX_STR, O_OPT, P_ACT, null, null],
+    'favid'         => [T_ZBX_INT, O_OPT, P_ACT, null, null],
+    'favaction'     => [T_ZBX_STR, O_OPT, P_ACT, IN('"add","remove"'), null]
+];
+check_fields($fields);
+
+/*
+ * Filter
+ */
+if (hasRequest('filterState')) {
+    CProfile::update('web.graphtree.filter.state', getRequest('filterState'), PROFILE_TYPE_INT);
+}
+
+/*
+ * ajax update timelinefixedperiod
+ */
+if (isset($_REQUEST['favobj'])) {
+    // saving fixed/dynamic setting to profile
+    if ($_REQUEST['favobj'] == 'timelinefixedperiod' && isset($_REQUEST['favid'])) {
+        CProfile::update('web.graphtree.timelinefixed', $_REQUEST['favid'], PROFILE_TYPE_INT);
+    }
+}
+
+if ($page['type'] == PAGE_TYPE_JS || $page['type'] == PAGE_TYPE_HTML_BLOCK) {
+    require_once dirname(__FILE__) . '/include/page_footer.php';
+    exit;
+}
+
+$hostid = getRequest("hostid", -1);
+$groupid = getRequest("groupid", -1);
+$applicationid = getRequest("applicationid", -1);
+
+$curtime = time(); //当前时间
+$timeline = [];
+
+if (!empty($_REQUEST['period']) || !empty($_REQUEST['stime'])) {
+    $timeline = CScreenBase::calculateTime([
+        'period' => getRequest('period'),
+        'stime'  => getRequest('stime')
+    ]);
+
+
+    $screen = new CScreenBuilder();
+    CScreenBuilder::insertScreenStandardJs([
+        'timeline'   => $timeline,
+        'profileIdx' => 'web.graphtree'
+    ]);
+} else {
+    $timeline = [
+        'period' => 3600,
+        'stime'  => $curtime - 3600
+    ];
+
+    $screen = new CScreenBuilder();
+    CScreenBuilder::insertScreenStandardJs([
+        'timeline'   => $screen->timeline,
+        'profileIdx' => "web.graphtree"
+    ]);
+}
+
+$graph_list = []; //记录结果信息数
+$value_list = [];
+$item_list = [];
+$graphids = null;
+$pagingLine = null;
+if ($groupid > 0 || $hostid > 0 || $applicationid > 0) {
+    DBstart();
+    $result = [];
+
+    if ($groupid !== -1 && $groupid > 0) {
+        $sql = "
+                    SELECT DISTINCT
+                      g.graphid,g.graphtype
+                    FROM
+                      `graphs` g,
+                      `graphs_items` gi,
+                      `items` i,
+                      `hosts` h,
+                      `hosts_groups` hg
+                    WHERE i.hostid = h.`hostid`
+                      AND gi.graphid = g.graphid
+                      AND i.itemid = gi.itemid
+                      AND g.flags IN ('0', '4')
+                      AND hg.groupid = {$groupid}
+                      AND hg.hostid = h.hostid
+                      AND h.status = 0
+                      AND EXISTS
+                      (SELECT
+                        NULL
+                      FROM
+                        `items` i
+                      WHERE h.hostid = i.hostid
+                        AND i.status = 0
+                        AND i.flags IN (0, 4))
+                    ORDER BY g.name ";
+
+        $dbRes = DBselect($sql);
+        while ($graph = DBfetch($dbRes)) {
+            $result["graph_" . $graph['graphid']] = $graph;
+        }
+        $graph_list = $result;
+
+    } elseif ($hostid !== -1 && $hostid > 0) {
+        $sql = "
+                    SELECT DISTINCT
+                      g.*
+                    FROM
+                      `graphs` g,
+                      `graphs_items` gi,
+                      `items` i,
+                      `hosts` h
+                    WHERE i.hostid = {$hostid}
+                      AND gi.graphid = g.graphid
+                      AND i.itemid = gi.itemid
+                      AND g.flags IN ('0', '4')
+                      AND h.status = 0
+                      AND EXISTS
+                      (SELECT
+                        NULL
+                      FROM
+                        `items` i
+                      WHERE h.hostid = i.hostid
+                        AND i.status = 0
+                        AND i.flags IN (0, 4))
+                    ORDER BY g.name ";
+
+        $dbRes = DBselect($sql);
+        while ($graph = DBfetch($dbRes)) {
+            $result["graph_" . $graph['graphid']] = $graph;
+        }
+        $graph_list = $result;
+    } elseif ($applicationid !== -1 && $applicationid > 0) {
+        //graph list
+        $sql = "
+                    SELECT DISTINCT
+                      g.graphid,g.graphtype
+                    FROM
+                      items_applications ia,
+                      `graphs_items` gi,
+                      `graphs` g
+                    WHERE ia.applicationid = {$applicationid}
+                      AND gi.`itemid` = ia.`itemid`
+                      AND g.`graphid` = gi.`graphid`
+                      AND g.flags IN ('0', '4')
+                    ORDER BY g.name";
+
+        $dbRes = DBselect($sql);
+        while ($graph = DBfetch($dbRes)) {
+            $result["graph_" . $graph['graphid']] = $graph;
+        }
+        $graph_list = $result;
+
+        //no graphid
+        $result = [];
+        $sql = "
+                    SELECT
+                      i.itemid,i.name,i.value_type
+                    FROM
+                      `items` i,
+                      `items_applications` ia
+                    WHERE i.itemid = ia.itemid
+                      AND ia.applicationid = {$applicationid}
+                      AND i.state = 0
+                      AND i.flags IN ('0', '4')
+                      AND NOT EXISTS
+                      (SELECT
+                        NULL
+                      FROM
+                        `items_applications` ia,
+                        `graphs_items` gi,
+                        `graphs` g
+                      WHERE ia.applicationid = {$applicationid}
+                        AND gi.`itemid` = i.`itemid`
+                        AND g.`graphid` = gi.`graphid`
+                        AND g.`flags` IN ('0', '4'))
+                    ";
+
+        $dbRes = DBselect($sql);
+        while ($item = DBfetch($dbRes)) {
+            $result["item_" . $item['itemid']] = $item;
+        }
+
+        $item_list = $result;
+
+        /*
+         * 0 float
+         * 1 character
+         * 2 log
+         * 3 unsign float
+         * 4 text
+         */
+        foreach ($item_list as $k => $item) {
+            switch ($item['value_type']) {
+                case 1:
+                case 2:
+                case 4:
+                    $value_list[$item['itemid']] = $item;
+                    unset($item_list[$k]);
+                    break;
+                default:
+                    break;
+            }
+        }
+
+        $graph_list = zbx_array_merge($graph_list, $item_list);
+
+        if ($value_list) {
+            // get history
+            if ($history = Manager::History()->getLast($value_list, 1, ZBX_HISTORY_PERIOD)) {
+                foreach ($value_list as &$item) {
+                    if (isset($history[$item['itemid']])) {
+                        $item = zbx_array_merge($item, $history[$item['itemid']][0]);
+                    } else {
+                        $item = zbx_array_merge($item, ['clock' => null, 'value' => null, 'ns' => null]);
+                    }
+                }
+            } else {
+                $value_list = [];
+            }
+            unset($item);
+        }
+    }
+
+    $pagingLine = getPagingLine($graph_list, ZBX_SORT_UP);
+    DBend(true);
+}
+
+/*
+ * Display
+ */
+$graphWidth = 520; //图形宽度
+$displayWidth = "50%";//"50%"; //显示宽度
+$height = 260;
+
+$chartsWidget = (new CWidget())->setTitle("Graphs");
+
+$chartForm = (new CForm('get'))->addVar('fullscreen', getRequest('fullscreen'));
+$chartsWidget->setControls($chartForm);
+
+$filterForm = (new CFilter('web.graphtree.filter.state'))->addNavigator();
+$chartsWidget->addItem($filterForm);
+if (!is_null($pagingLine)) {
+    $chartsWidget->addItem($pagingLine);
+}
+
+if (is_array($graph_list) && !empty($graph_list)) {
+    $imgDiv = (new CDiv())->setId("imgDiv");
+    //graphid --> graph
+    foreach ($graph_list as $key => $item) {
+        if (strpos($key, "graph_") === 0) {
+            $chart = 'chart2.php';
+            if($item['graphtype'] == 2 || $item['graphtype'] == 3){
+                $chart = 'chart6.php';
+            }
+
+            $small_graph = $chart.'?graphid=' . $item['graphid'] . '&width=' . $graphWidth . '&height=' . $height . '&stime=' . $timeline['stime'] . '&period=' . $timeline['period'];
+            $big_graph = 'biggraph.php?graphid=' . $item['graphid'] . '&stime=' . $timeline['stime'] . '&period=' . $timeline['period'];
+            $div_tmp = (new CDiv())->setId("div_" . $item['graphid']);
+        }
+        if (strpos($key, "item_") === 0) {
+            $small_graph = "chart.php?itemids=" . $item['itemid'] . "&width=" . $graphWidth . "&height=" . $height . "&stime=" . $timeline['stime'] . "&period=" . $timeline['period'];
+            $big_graph = "history.php?action=showgraph&itemids[]=" . $item['itemid'];
+            $div_tmp = (new CDiv())->setId("div_" . $item['itemid']);
+        }
+
+        $div_tmp->addStyle("box-sizing: border-box;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;width:{$displayWidth};float: left;text-align: center;padding: 6px 6px 0px 0px;");
+
+        $img_tmp = new CImg($small_graph, null, null, $height);
+        $img_tmp->setAttribute('style', "width:100%");
+        $a_tmp = new CLink($img_tmp, $big_graph);
+
+        if (strpos($key, "item_") === 0) {
+            $a_tmp->setAttribute("target", "_blank");
+        }
+
+        $div_tmp->addItem($a_tmp);
+        $imgDiv->addItem($div_tmp);
+
+    }
+    $chartsWidget->addItem($imgDiv);
+    unset($item);
+
+    $chartsWidget->addItem(BR());
+
+    $chartsWidget->addItem((new CDiv($pagingLine))->addStyle("clear:both;padding:12px 0;"));
+
+}
+
+if ($value_list) {
+    $valueTable = (new CTableInfo())->setHeader([
+        _("Name"),
+        _("Last check"),
+        _("Last value"),
+        _("Option"),
+    ]);
+
+    foreach ($value_list as $item) {
+        $history_link = new CLink(new CSpan("history"), "history.php?action=showvalues&period=86400&itemids[]=" . $item['itemid']);
+        $history_link->setTarget("_blank");
+        $valueTable->addRow([
+            new CCol(new CSpan($item['name'], "item")),
+            new CCol(new CSpan(zbx_date2str(DATE_TIME_FORMAT_SECONDS, $item['clock']), "item")),
+            new CCol(new CSpan(($item['value'] !== null) ? $item['value'] : _("No Value"), "item")),
+            new CCol($history_link)
+        ]);
+        unset($history_link);
+    }
+
+    $valueTable->addStyle("clear:both");
+    $chartsWidget->addItem($valueTable);
+    unset($item);
+}
+
+if(empty($graph_list) && empty($value_list)){
+    $chartsWidget->addItem(new CTableInfo());
+}
+echo "<div>Graphtree由<a href=\"http://www.oneoaas.com\">OneOaaS</a>开源<a href=\"http://www.oneoaas.com\">https://www.oneoaas.com</a></br>
+OneOaaS专注于国内Zabbix监控技术(包括二次开发)服务,Zabbix官方中国区合作伙伴</br>
+微信公众号专注于Zabbix监控和运维工具知识推广,扫描立即关注</br>
+ <img src='img/oneoaas-wechat.jpg'></br></div>";
+echo "编辑";
+echo dirname(__FILE__);
+echo "/graphtree.right.php 344-350行删除此提示信息";  
+
+$chartsWidget->show();
+
+require_once dirname(__FILE__) . '/include/page_footer.php';
diff -x graphtree -Naru ./graphtrees.php graphtree/graphtrees.php
--- ./graphtrees.php	1970-01-01 08:00:00.000000000 +0800
+++ graphtree/graphtrees.php	2016-04-18 18:46:02.000000000 +0800
@@ -0,0 +1,68 @@
+<?php
+/*
+** Zabbix
+** Copyright (C) 2001-2015 Zabbix SIA
+**
+** This program is free software; you can redistribute it and/or modify
+** it under the terms of the GNU General Public License as published by
+** the Free Software Foundation; either version 2 of the License, or
+** (at your option) any later version.
+**
+** This program is distributed in the hope that it will be useful,
+** but WITHOUT ANY WARRANTY; without even the implied warranty of
+** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+** GNU General Public License for more details.
+**
+** You should have received a copy of the GNU General Public License
+** along with this program; if not, write to the Free Software
+** Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+**/
+
+require_once dirname(__FILE__) . '/include/config.inc.php';
+require_once dirname(__FILE__) . '/include/hosts.inc.php';
+require_once dirname(__FILE__) . '/include/graphs.inc.php';
+
+
+$page['title'] = _('Graphtrees');
+$page['file'] = 'graphtrees.php';
+$page['hist_arg'] = ['graphid', 'groupid', 'hostid'];
+$page['type'] = detect_page_type(PAGE_TYPE_HTML);
+
+//define('ZBX_PAGE_DO_JS_REFRESH', 1); no refresh
+
+ob_start();
+require_once dirname(__FILE__) . '/include/page_header.php';
+
+$fields = [
+    'groupid'     => [T_ZBX_INT, O_OPT, P_SYS, DB_ID, null],
+    'hostid'      => [T_ZBX_INT, O_OPT, P_SYS, DB_ID, null],
+    'graphid'     => [T_ZBX_INT, O_OPT, P_SYS, DB_ID, null],
+    'period'      => [T_ZBX_INT, O_OPT, P_SYS, null, null],
+    'stime'       => [T_ZBX_STR, O_OPT, P_SYS, null, null],
+    'fullscreen'  => [T_ZBX_INT, O_OPT, P_SYS, IN('0,1'), null],
+    // ajax
+    'filterState' => [T_ZBX_INT, O_OPT, P_ACT, null, null],
+    'favobj'      => [T_ZBX_STR, O_OPT, P_ACT, null, null],
+    'favid'       => [T_ZBX_INT, O_OPT, P_ACT, null, null],
+    'favaction'   => [T_ZBX_STR, O_OPT, P_ACT, IN('"add","remove"'), null]
+];
+check_fields($fields);
+$gtreeWidget = (new CWidget())->setTitle(_('Graphtrees'))->setControls((new CList())->addItem(get_icon('fullscreen', ['fullscreen' => getRequest('fullscreen')])));
+
+
+$gtree_iframe_left = new CIFrame("graphtree.left.php?type=zTree", "100%", "100%", "auto", "zatree_iframe_left");
+$gtree_iframe_right = new CIFrame("graphtree.right.php", "100%", "100%", "auto", "zatree_iframe_right");
+$gtree_iframe_left->setAttribute("name", "leftFrame");
+$gtree_iframe_left->setAttribute("id", "leftFrame");
+$gtree_iframe_right->setAttribute("name", "rightFrame");
+$gtree_iframe_right->setAttribute("id", "rightFrame");
+$gtree_div_left = (new CDiv($gtree_iframe_left))->setAttribute('style', "width:20%;height:800px;display:inline-block");
+$gtree_div_right = (new CDiv($gtree_iframe_right))->setAttribute('style', "width:80%;height:800px;display:inline-block");
+
+$gtreeWidget->addItem($gtree_div_left);
+$gtreeWidget->addItem($gtree_div_right);
+
+$gtreeWidget->show();
+
+require_once dirname(__FILE__) . '/include/page_footer.php';
+
diff -x graphtree -Naru ./hosts.php graphtree/hosts.php
--- ./hosts.php	2016-02-26 17:45:56.000000000 +0800
+++ graphtree/hosts.php	2016-04-18 18:46:02.000000000 +0800
@@ -1,1130 +1,1145 @@
 <?php
-/*
-** Zabbix
-** Copyright (C) 2001-2016 Zabbix SIA
-**
-** This program is free software; you can redistribute it and/or modify
-** it under the terms of the GNU General Public License as published by
-** the Free Software Foundation; either version 2 of the License, or
-** (at your option) any later version.
-**
-** This program is distributed in the hope that it will be useful,
-** but WITHOUT ANY WARRANTY; without even the implied warranty of
-** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
-** GNU General Public License for more details.
-**
-** You should have received a copy of the GNU General Public License
-** along with this program; if not, write to the Free Software
-** Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
-**/
-
-
-require_once dirname(__FILE__).'/include/config.inc.php';
-require_once dirname(__FILE__).'/include/forms.inc.php';
-
-if (hasRequest('action') && getRequest('action') == 'host.export' && hasRequest('hosts')) {
-	$page['file'] = 'zbx_export_hosts.xml';
-	$page['type'] = detect_page_type(PAGE_TYPE_XML);
-
-	$exportData = true;
-}
-else {
-	$page['title'] = _('Configuration of hosts');
-	$page['file'] = 'hosts.php';
-	$page['type'] = detect_page_type(PAGE_TYPE_HTML);
-	$page['scripts'] = ['multiselect.js'];
-
-	$exportData = false;
-}
-
-require_once dirname(__FILE__).'/include/page_header.php';
-
-// VAR	TYPE	OPTIONAL	FLAGS	VALIDATION	EXCEPTION
-$fields = [
-	'hosts' =>			[T_ZBX_INT, O_OPT, P_SYS,			DB_ID,		null],
-	'groups' =>			[T_ZBX_INT, O_OPT, P_SYS,			DB_ID,		null],
-	'new_groups' =>		[T_ZBX_STR, O_OPT, P_SYS,			null,		null],
-	'hostids' =>		[T_ZBX_INT, O_OPT, P_SYS,			DB_ID,		null],
-	'groupids' =>		[T_ZBX_INT, O_OPT, P_SYS,			DB_ID,		null],
-	'applications' =>	[T_ZBX_INT, O_OPT, P_SYS,			DB_ID,		null],
-	'groupid' =>		[T_ZBX_INT, O_OPT, P_SYS,			DB_ID,		null],
-	'hostid' =>			[T_ZBX_INT, O_OPT, P_SYS,			DB_ID,		'isset({form}) && {form} == "update"'],
-	'clone_hostid' =>	[T_ZBX_INT, O_OPT, P_SYS,			DB_ID,		'isset({form}) && {form} == "full_clone"'],
-	'host' =>			[T_ZBX_STR, O_OPT, null,			NOT_EMPTY,	'isset({add}) || isset({update})', _('Host name')],
-	'visiblename' =>	[T_ZBX_STR, O_OPT, null,			null,		'isset({add}) || isset({update})'],
-	'description' =>	[T_ZBX_STR, O_OPT, null,			null,		null],
-	'proxy_hostid' =>	[T_ZBX_INT, O_OPT, P_SYS,		    DB_ID,		null],
-	'status' =>			[T_ZBX_INT, O_OPT, null,			IN([HOST_STATUS_MONITORED, HOST_STATUS_NOT_MONITORED]), null],
-	'newgroup' =>		[T_ZBX_STR, O_OPT, null,			null,		null],
-	'interfaces' =>		[T_ZBX_STR, O_OPT, null,			NOT_EMPTY,	'isset({add}) || isset({update})', _('Agent or SNMP or JMX or IPMI interface')],
-	'mainInterfaces' =>	[T_ZBX_INT, O_OPT, null,			DB_ID,		null],
-	'templates' =>		[T_ZBX_INT, O_OPT, null,			DB_ID,		null],
-	'add_template' =>	[T_ZBX_STR, O_OPT, null,			null,		null],
-	'add_templates' => [T_ZBX_INT, O_OPT, null,			DB_ID,		null],
-	'templates_rem' =>	[T_ZBX_STR, O_OPT, P_SYS|P_ACT,	null,		null],
-	'clear_templates' => [T_ZBX_INT, O_OPT, null,			DB_ID,		null],
-	'ipmi_authtype' =>	[T_ZBX_INT, O_OPT, null,			BETWEEN(-1, 6), null],
-	'ipmi_privilege' =>	[T_ZBX_INT, O_OPT, null,			BETWEEN(0, 5), null],
-	'ipmi_username' =>	[T_ZBX_STR, O_OPT, null,			null,		null],
-	'ipmi_password' =>	[T_ZBX_STR, O_OPT, null,			null,		null],
-	'tls_connect' =>	[T_ZBX_INT, O_OPT, null,
-		IN([HOST_ENCRYPTION_NONE, HOST_ENCRYPTION_PSK, HOST_ENCRYPTION_CERTIFICATE]), null],
-	'tls_accept' =>		[T_ZBX_INT, O_OPT, null,
-		BETWEEN(0, (HOST_ENCRYPTION_NONE | HOST_ENCRYPTION_PSK | HOST_ENCRYPTION_CERTIFICATE)), null],
-	'tls_subject' =>	[T_ZBX_STR, O_OPT, null,		null,		null],
-	'tls_issuer' =>		[T_ZBX_STR, O_OPT, null,		null,		null],
-	'tls_psk_identity' =>	[T_ZBX_STR, O_OPT, null,		null,		null],
-	'tls_psk' =>		[T_ZBX_STR, O_OPT, null,			null,		null],
-	'flags' =>			[T_ZBX_INT, O_OPT, null,
-		IN([ZBX_FLAG_DISCOVERY_NORMAL, ZBX_FLAG_DISCOVERY_CREATED]), null],
-	'mass_replace_tpls' => [T_ZBX_STR, O_OPT, null,		null,		null],
-	'mass_clear_tpls' => [T_ZBX_STR, O_OPT, null,			null,		null],
-	'inventory_mode' => [T_ZBX_INT, O_OPT, null,
-		IN(HOST_INVENTORY_DISABLED.','.HOST_INVENTORY_MANUAL.','.HOST_INVENTORY_AUTOMATIC), null],
-	'host_inventory' =>	[T_ZBX_STR, O_OPT, P_UNSET_EMPTY,	null,		null],
-	'macros' =>			[T_ZBX_STR, O_OPT, P_SYS,			null,		null],
-	'visible' =>		[T_ZBX_STR, O_OPT, null,			null,		null],
-	'show_inherited_macros' => [T_ZBX_INT, O_OPT, null, IN([0,1]), null],
-	// actions
-	'action' =>			[T_ZBX_STR, O_OPT, P_SYS|P_ACT,
-							IN('"host.export","host.massdelete","host.massdisable","host.massenable","host.massupdate"'.
-								',"host.massupdateform"'
-							),
-							null
-						],
-	'add_to_group' =>	[T_ZBX_INT, O_OPT, P_SYS|P_ACT,	DB_ID,		null],
-	'delete_from_group' => [T_ZBX_INT, O_OPT, P_SYS|P_ACT,	DB_ID,		null],
-	'unlink' =>			[T_ZBX_STR, O_OPT, P_SYS|P_ACT,	null,		null],
-	'unlink_and_clear' => [T_ZBX_STR, O_OPT, P_SYS|P_ACT,	null,		null],
-	'add' =>			[T_ZBX_STR, O_OPT, P_SYS|P_ACT,	null,		null],
-	'update' =>			[T_ZBX_STR, O_OPT, P_SYS|P_ACT,	null,		null],
-	'masssave' =>		[T_ZBX_STR, O_OPT, P_SYS|P_ACT,	null,		null],
-	'clone' =>			[T_ZBX_STR, O_OPT, P_SYS|P_ACT,	null,		null],
-	'full_clone' =>		[T_ZBX_STR, O_OPT, P_SYS|P_ACT,	null,		null],
-	'delete' =>			[T_ZBX_STR, O_OPT, P_SYS|P_ACT,	null,		null],
-	'cancel' =>			[T_ZBX_STR, O_OPT, P_SYS,		null,			null],
-	'form' =>			[T_ZBX_STR, O_OPT, P_SYS,		null,			null],
-	'form_refresh' =>	[T_ZBX_INT, O_OPT, null,		null,			null],
-	// filter
-	'filter_set' =>		[T_ZBX_STR, O_OPT, P_SYS,		null,			null],
-	'filter_rst' =>		[T_ZBX_STR, O_OPT, P_SYS,		null,			null],
-	'filter_host' =>	[T_ZBX_STR, O_OPT, null,		null,			null],
-	'filter_ip' =>		[T_ZBX_STR, O_OPT, null,		null,			null],
-	'filter_dns' =>		[T_ZBX_STR, O_OPT, null,		null,			null],
-	'filter_port' =>	[T_ZBX_STR, O_OPT, null,		null,			null],
-	// sort and sortorder
-	'sort' =>			[T_ZBX_STR, O_OPT, P_SYS, IN('"name","status"'),						null],
-	'sortorder' =>		[T_ZBX_STR, O_OPT, P_SYS, IN('"'.ZBX_SORT_DOWN.'","'.ZBX_SORT_UP.'"'),	null]
-];
-check_fields($fields);
-
-/*
- * Permissions
- */
-if (getRequest('groupid') && !API::HostGroup()->isWritable([$_REQUEST['groupid']])) {
-	access_deny();
-}
-if (getRequest('hostid') && !API::Host()->isWritable([$_REQUEST['hostid']])) {
-	access_deny();
-}
-
-$hostIds = getRequest('hosts', []);
-
-/*
- * Export
- */
-if ($exportData) {
-	$export = new CConfigurationExport(['hosts' => $hostIds]);
-	$export->setBuilder(new CConfigurationExportBuilder());
-	$export->setWriter(CExportWriterFactory::getWriter(CExportWriterFactory::XML));
-	$exportData = $export->export();
-
-	if (hasErrorMesssages()) {
-		show_messages();
-	}
-	else {
-		print($exportData);
-	}
-
-	exit;
-}
-
-/*
- * Filter
- */
-if (hasRequest('filter_set')) {
-	CProfile::update('web.hosts.filter_ip', getRequest('filter_ip', ''), PROFILE_TYPE_STR);
-	CProfile::update('web.hosts.filter_dns', getRequest('filter_dns', ''), PROFILE_TYPE_STR);
-	CProfile::update('web.hosts.filter_host', getRequest('filter_host', ''), PROFILE_TYPE_STR);
-	CProfile::update('web.hosts.filter_port', getRequest('filter_port', ''), PROFILE_TYPE_STR);
-}
-elseif (hasRequest('filter_rst')) {
-	DBStart();
-	CProfile::delete('web.hosts.filter_ip');
-	CProfile::delete('web.hosts.filter_dns');
-	CProfile::delete('web.hosts.filter_host');
-	CProfile::delete('web.hosts.filter_port');
-	DBend();
-}
-
-$filter['ip'] = CProfile::get('web.hosts.filter_ip', '');
-$filter['dns'] = CProfile::get('web.hosts.filter_dns', '');
-$filter['host'] = CProfile::get('web.hosts.filter_host', '');
-$filter['port'] = CProfile::get('web.hosts.filter_port', '');
-
-// remove inherited macros data (actions: 'add', 'update' and 'form')
-$macros = cleanInheritedMacros(getRequest('macros', []));
-
-// remove empty new macro lines
-foreach ($macros as $idx => $macro) {
-	if (!array_key_exists('hostmacroid', $macro) && $macro['macro'] === '' && $macro['value'] === '') {
-		unset($macros[$idx]);
-	}
-}
-
-/*
- * Actions
- */
-if (isset($_REQUEST['add_template']) && isset($_REQUEST['add_templates'])) {
-	$_REQUEST['templates'] = getRequest('templates', []);
-	$_REQUEST['templates'] = array_merge($_REQUEST['templates'], $_REQUEST['add_templates']);
-}
-if (isset($_REQUEST['unlink']) || isset($_REQUEST['unlink_and_clear'])) {
-	$_REQUEST['clear_templates'] = getRequest('clear_templates', []);
-
-	$unlinkTemplates = [];
-
-	if (isset($_REQUEST['unlink'])) {
-		// templates_rem for old style removal in massupdate form
-		if (isset($_REQUEST['templates_rem'])) {
-			$unlinkTemplates = array_keys($_REQUEST['templates_rem']);
-		}
-		elseif (is_array($_REQUEST['unlink'])) {
-			$unlinkTemplates = array_keys($_REQUEST['unlink']);
-		}
-	}
-	else {
-		$unlinkTemplates = array_keys($_REQUEST['unlink_and_clear']);
-
-		$_REQUEST['clear_templates'] = array_merge($_REQUEST['clear_templates'], $unlinkTemplates);
-	}
-
-	foreach ($unlinkTemplates as $templateId) {
-		unset($_REQUEST['templates'][array_search($templateId, $_REQUEST['templates'])]);
-	}
-}
-elseif ((hasRequest('clone') || hasRequest('full_clone')) && hasRequest('hostid')) {
-	$_REQUEST['form'] = hasRequest('clone') ? 'clone' : 'full_clone';
-
-	$groupids = getRequest('groups', []);
-	if ($groupids) {
-		// leave only writable groups
-		$_REQUEST['groups'] = array_keys(API::HostGroup()->get([
-			'output' => [],
-			'groupids' => $groupids,
-			'editable' => true,
-			'preservekeys' => true
-		]));
-	}
-
-	if (hasRequest('interfaces')) {
-		$interfaceid = 1;
-		foreach ($_REQUEST['interfaces'] as &$interface) {
-			$interface['interfaceid'] = (string) $interfaceid++;
-			unset($interface['locked'], $interface['items']);
-		}
-		unset($interface);
-	}
-
-	if (hasRequest('full_clone')) {
-		$_REQUEST['clone_hostid'] = $_REQUEST['hostid'];
-	}
-
-	unset($_REQUEST['hostid'], $_REQUEST['flags']);
-}
-elseif (hasRequest('action') && getRequest('action') == 'host.massupdate' && hasRequest('masssave')) {
-	$hostIds = getRequest('hosts', []);
-	$visible = getRequest('visible', []);
-	$_REQUEST['proxy_hostid'] = getRequest('proxy_hostid', 0);
-	$_REQUEST['templates'] = getRequest('templates', []);
-
-	try {
-		DBstart();
-
-		// filter only normal and discovery created hosts
-		$hosts = API::Host()->get([
-			'output' => ['hostid'],
-			'hostids' => $hostIds,
-			'filter' => ['flags' => [ZBX_FLAG_DISCOVERY_NORMAL, ZBX_FLAG_DISCOVERY_CREATED]]
-		]);
-		$hosts = ['hosts' => $hosts];
-
-		$properties = [
-			'proxy_hostid', 'ipmi_authtype', 'ipmi_privilege', 'ipmi_username', 'ipmi_password', 'description'
-		];
-
-		$newValues = [];
-		foreach ($properties as $property) {
-			if (isset($visible[$property])) {
-				$newValues[$property] = $_REQUEST[$property];
-			}
-		}
-
-		if (isset($visible['status'])) {
-			$newValues['status'] = getRequest('status', HOST_STATUS_NOT_MONITORED);
-		}
-
-		if (isset($visible['inventory_mode'])) {
-			$newValues['inventory_mode'] = getRequest('inventory_mode', HOST_INVENTORY_DISABLED);
-			$newValues['inventory'] = ($newValues['inventory_mode'] == HOST_INVENTORY_DISABLED)
-				? []
-				: getRequest('host_inventory', []);
-		}
-
-		if (array_key_exists('encryption', $visible)) {
-			$newValues['tls_connect'] = getRequest('tls_connect', HOST_ENCRYPTION_NONE);
-			$newValues['tls_accept'] = getRequest('tls_accept', HOST_ENCRYPTION_NONE);
-			$newValues['tls_issuer'] = getRequest('tls_issuer', '');
-			$newValues['tls_subject'] = getRequest('tls_subject', '');
-			$newValues['tls_psk_identity'] = getRequest('tls_psk_identity', '');
-			$newValues['tls_psk'] = getRequest('tls_psk', '');
-		}
-
-		$templateIds = [];
-		if (isset($visible['templates'])) {
-			$templateIds = $_REQUEST['templates'];
-		}
-
-		// add new or existing host groups
-		$newHostGroupIds = [];
-		if (isset($visible['new_groups']) && !empty($_REQUEST['new_groups'])) {
-			if (CWebUser::getType() == USER_TYPE_SUPER_ADMIN) {
-				foreach ($_REQUEST['new_groups'] as $newGroup) {
-					if (is_array($newGroup) && isset($newGroup['new'])) {
-						$newGroups[] = ['name' => $newGroup['new']];
-					}
-					else {
-						$newHostGroupIds[] = $newGroup;
-					}
-				}
-
-				if (isset($newGroups)) {
-					if (!$createdGroups = API::HostGroup()->create($newGroups)) {
-						throw new Exception();
-					}
-
-					$newHostGroupIds = $newHostGroupIds
-						? array_merge($newHostGroupIds, $createdGroups['groupids'])
-						: $createdGroups['groupids'];
-				}
-			}
-			else {
-				$newHostGroupIds = getRequest('new_groups');
-			}
-		}
-
-		if (isset($visible['groups'])) {
-			if (isset($_REQUEST['groups'])) {
-				$replaceHostGroupsIds = $newHostGroupIds
-					? array_unique(array_merge(getRequest('groups'), $newHostGroupIds))
-					: $_REQUEST['groups'];
-			}
-			elseif ($newHostGroupIds) {
-				$replaceHostGroupsIds = $newHostGroupIds;
-			}
-
-			if (isset($replaceHostGroupsIds)) {
-				$hosts['groups'] = API::HostGroup()->get([
-					'groupids' => $replaceHostGroupsIds,
-					'editable' => true,
-					'output' => ['groupid']
-				]);
-			}
-			else {
-				$hosts['groups'] = [];
-			}
-		}
-		elseif ($newHostGroupIds) {
-			$newHostGroups = API::HostGroup()->get([
-				'groupids' => $newHostGroupIds,
-				'editable' => true,
-				'output' => ['groupid']
-			]);
-		}
-
-		if (isset($_REQUEST['mass_replace_tpls'])) {
-			if (isset($_REQUEST['mass_clear_tpls'])) {
-				$hostTemplates = API::Template()->get([
-					'output' => ['templateid'],
-					'hostids' => $hostIds
-				]);
-
-				$hostTemplateIds = zbx_objectValues($hostTemplates, 'templateid');
-				$templatesToDelete = array_diff($hostTemplateIds, $templateIds);
-
-				$hosts['templates_clear'] = zbx_toObject($templatesToDelete, 'templateid');
-			}
-
-			$hosts['templates'] = $templateIds;
-		}
-
-		$result = API::Host()->massUpdate(array_merge($hosts, $newValues));
-		if ($result === false) {
-			throw new Exception();
-		}
-
-		$add = [];
-		if ($templateIds && isset($visible['templates'])) {
-			$add['templates'] = $templateIds;
-		}
-
-		// add new host groups
-		if ($newHostGroupIds && (!isset($visible['groups']) || !isset($replaceHostGroups))) {
-			$add['groups'] = zbx_toObject($newHostGroupIds, 'groupid');
-		}
-
-		if ($add) {
-			$add['hosts'] = $hosts['hosts'];
-
-			$result = API::Host()->massAdd($add);
-
-			if ($result === false) {
-				throw new Exception();
-			}
-		}
-
-		DBend(true);
-
-		uncheckTableRows();
-		show_message(_('Hosts updated'));
-
-		unset($_REQUEST['massupdate'], $_REQUEST['form'], $_REQUEST['hosts']);
-	}
-	catch (Exception $e) {
-		DBend(false);
-		show_error_message(_('Cannot update hosts'));
-	}
-}
-elseif (hasRequest('add') || hasRequest('update')) {
-	try {
-		DBstart();
-
-		$hostId = getRequest('hostid', 0);
-
-		if ($hostId != 0) {
-			$create = false;
-
-			$msgOk = _('Host updated');
-			$msgFail = _('Cannot update host');
-
-			$dbHost = API::Host()->get([
-				'output' => API_OUTPUT_EXTEND,
-				'hostids' => $hostId,
-				'editable' => true
-			]);
-			$dbHost = reset($dbHost);
-		}
-		else {
-			$create = true;
-
-			$msgOk = _('Host added');
-			$msgFail = _('Cannot add host');
-		}
-
-		// host data
-		if (!$create && $dbHost['flags'] == ZBX_FLAG_DISCOVERY_CREATED) {
-			$host = [
-				'hostid' => $hostId,
-				'status' => getRequest('status', HOST_STATUS_NOT_MONITORED),
-				'description' => getRequest('description', ''),
-				'inventory' => (getRequest('inventory_mode') == HOST_INVENTORY_DISABLED)
-					? []
-					: getRequest('host_inventory', [])
-			];
-		}
-		else {
-			// templates
-			$templates = [];
-
-			foreach (getRequest('templates', []) as $templateId) {
-				$templates[] = ['templateid' => $templateId];
-			}
-
-			// interfaces
-			$interfaces = getRequest('interfaces', []);
-
-			foreach ($interfaces as $key => $interface) {
-				if (zbx_empty($interface['ip']) && zbx_empty($interface['dns'])) {
-					unset($interface[$key]);
-					continue;
-				}
-
-				if ($interface['type'] == INTERFACE_TYPE_SNMP && !isset($interface['bulk'])) {
-					$interfaces[$key]['bulk'] = SNMP_BULK_DISABLED;
-				}
-				else {
-					$interfaces[$key]['bulk'] = SNMP_BULK_ENABLED;
-				}
-
-				if ($interface['isNew']) {
-					unset($interfaces[$key]['interfaceid']);
-				}
-
-				unset($interfaces[$key]['isNew']);
-				$interfaces[$key]['main'] = 0;
-			}
-
-			$mainInterfaces = getRequest('mainInterfaces', []);
-			foreach ([INTERFACE_TYPE_AGENT, INTERFACE_TYPE_SNMP, INTERFACE_TYPE_JMX, INTERFACE_TYPE_IPMI] as $type) {
-				if (array_key_exists($type, $mainInterfaces)) {
-					$interfaces[$mainInterfaces[$type]]['main'] = INTERFACE_PRIMARY;
-				}
-			}
-
-			// new group
-			$groups = getRequest('groups', []);
-			$newGroup = getRequest('newgroup');
-
-			if (!zbx_empty($newGroup)) {
-				$newGroup = API::HostGroup()->create(['name' => $newGroup]);
-
-				if (!$newGroup) {
-					throw new Exception();
-				}
-
-				$groups[] = reset($newGroup['groupids']);
-			}
-
-			$groups = zbx_toObject($groups, 'groupid');
-
-			// host data
-			$host = [
-				'host' => getRequest('host'),
-				'name' => getRequest('visiblename'),
-				'status' => getRequest('status', HOST_STATUS_NOT_MONITORED),
-				'description' => getRequest('description'),
-				'proxy_hostid' => getRequest('proxy_hostid', 0),
-				'ipmi_authtype' => getRequest('ipmi_authtype'),
-				'ipmi_privilege' => getRequest('ipmi_privilege'),
-				'ipmi_username' => getRequest('ipmi_username'),
-				'ipmi_password' => getRequest('ipmi_password'),
-				'tls_connect' => getRequest('tls_connect', HOST_ENCRYPTION_NONE),
-				'tls_accept' => getRequest('tls_accept', HOST_ENCRYPTION_NONE),
-				'tls_issuer' => getRequest('tls_issuer'),
-				'tls_subject' => getRequest('tls_subject'),
-				'tls_psk_identity' => getRequest('tls_psk_identity'),
-				'tls_psk' => getRequest('tls_psk'),
-				'groups' => $groups,
-				'templates' => $templates,
-				'interfaces' => $interfaces,
-				'macros' => $macros,
-				'inventory_mode' => getRequest('inventory_mode'),
-				'inventory' => (getRequest('inventory_mode') == HOST_INVENTORY_DISABLED)
-					? []
-					: getRequest('host_inventory', [])
-			];
-
-			if (!$create) {
-				$host['templates_clear'] = zbx_toObject(getRequest('clear_templates', []), 'templateid');
-			}
-		}
-
-		if ($create) {
-			$hostIds = API::Host()->create($host);
-
-			if ($hostIds) {
-				$hostId = reset($hostIds['hostids']);
-			}
-			else {
-				throw new Exception();
-			}
-
-			add_audit_ext(AUDIT_ACTION_ADD, AUDIT_RESOURCE_HOST, $hostId, $host['host'], null, null, null);
-		}
-		else {
-			$host['hostid'] = $hostId;
-
-			if (!API::Host()->update($host)) {
-				throw new Exception();
-			}
-
-			$dbHostNew = API::Host()->get([
-				'output' => API_OUTPUT_EXTEND,
-				'hostids' => $hostId,
-				'editable' => true
-			]);
-			$dbHostNew = reset($dbHostNew);
-
-			add_audit_ext(AUDIT_ACTION_UPDATE, AUDIT_RESOURCE_HOST, $dbHostNew['hostid'], $dbHostNew['host'], 'hosts',
-				$dbHost, $dbHostNew);
-		}
-
-		// full clone
-		if (getRequest('form', '') === 'full_clone' && getRequest('clone_hostid', 0) != 0) {
-			$srcHostId = getRequest('clone_hostid');
-
-			// copy applications
-			if (!copyApplications($srcHostId, $hostId)) {
-				throw new Exception();
-			}
-
-			// copy items
-			if (!copyItems($srcHostId, $hostId)) {
-				throw new Exception();
-			}
-
-			// copy web scenarios
-			if (!copyHttpTests($srcHostId, $hostId)) {
-				throw new Exception();
-			}
-
-			// copy triggers
-			$dbTriggers = API::Trigger()->get([
-				'output' => ['triggerid'],
-				'hostids' => $srcHostId,
-				'inherited' => false
-			]);
-
-			if ($dbTriggers) {
-				if (!copyTriggersToHosts(zbx_objectValues($dbTriggers, 'triggerid'), $hostId, $srcHostId)) {
-					throw new Exception();
-				}
-			}
-
-			// copy discovery rules
-			$dbDiscoveryRules = API::DiscoveryRule()->get([
-				'output' => ['itemid'],
-				'hostids' => $srcHostId,
-				'inherited' => false
-			]);
-
-			if ($dbDiscoveryRules) {
-				$copyDiscoveryRules = API::DiscoveryRule()->copy([
-					'discoveryids' => zbx_objectValues($dbDiscoveryRules, 'itemid'),
-					'hostids' => [$hostId]
-				]);
-
-				if (!$copyDiscoveryRules) {
-					throw new Exception();
-				}
-			}
-
-			// copy graphs
-			$dbGraphs = API::Graph()->get([
-				'output' => API_OUTPUT_EXTEND,
-				'selectHosts' => ['hostid'],
-				'selectItems' => ['type'],
-				'hostids' => $srcHostId,
-				'filter' => ['flags' => ZBX_FLAG_DISCOVERY_NORMAL],
-				'inherited' => false
-			]);
-
-			foreach ($dbGraphs as $dbGraph) {
-				if (count($dbGraph['hosts']) > 1) {
-					continue;
-				}
-
-				if (httpItemExists($dbGraph['items'])) {
-					continue;
-				}
-
-				if (!copyGraphToHost($dbGraph['graphid'], $hostId)) {
-					throw new Exception();
-				}
-			}
-		}
-
-		$result = DBend(true);
-
-		if ($result) {
-			uncheckTableRows();
-		}
-		show_messages($result, $msgOk, $msgFail);
-
-		unset($_REQUEST['form'], $_REQUEST['hostid']);
-	}
-	catch (Exception $e) {
-		DBend(false);
-		show_messages(false, $msgOk, $msgFail);
-	}
-}
-elseif (hasRequest('delete') && hasRequest('hostid')) {
-	DBstart();
-
-	$result = API::Host()->delete([getRequest('hostid')]);
-	$result = DBend($result);
-
-	if ($result) {
-		unset($_REQUEST['form'], $_REQUEST['hostid']);
-		uncheckTableRows();
-	}
-	show_messages($result, _('Host deleted'), _('Cannot delete host'));
-
-	unset($_REQUEST['delete']);
-}
-elseif (hasRequest('action') && getRequest('action') == 'host.massdelete' && hasRequest('hosts')) {
-	DBstart();
-
-	$result = API::Host()->delete(getRequest('hosts'));
-	$result = DBend($result);
-
-	if ($result) {
-		uncheckTableRows();
-	}
-	show_messages($result, _('Host deleted'), _('Cannot delete host'));
-}
-elseif (hasRequest('action') && str_in_array(getRequest('action'), ['host.massenable', 'host.massdisable']) && hasRequest('hosts')) {
-	$enable =(getRequest('action') == 'host.massenable');
-	$status = $enable ? TRIGGER_STATUS_ENABLED : TRIGGER_STATUS_DISABLED;
-
-	$actHosts = API::Host()->get([
-		'hostids' => getRequest('hosts'),
-		'editable' => true,
-		'templated_hosts' => true,
-		'output' => ['hostid']
-	]);
-	$actHosts = zbx_objectValues($actHosts, 'hostid');
-
-	if ($actHosts) {
-		DBstart();
-
-		$result = updateHostStatus($actHosts, $status);
-		$result = DBend($result);
-
-		if ($result) {
-			uncheckTableRows();
-		}
-
-		$updated = count($actHosts);
-
-		$messageSuccess = $enable
-			? _n('Host enabled', 'Hosts enabled', $updated)
-			: _n('Host disabled', 'Hosts disabled', $updated);
-		$messageFailed = $enable
-			? _n('Cannot enable host', 'Cannot enable hosts', $updated)
-			: _n('Cannot disable host', 'Cannot disable hosts', $updated);
-
-		show_messages($result, $messageSuccess, $messageFailed);
-	}
-}
-
-/*
- * Display
- */
-$pageFilter = new CPageFilter([
-	'groups' => [
-		'real_hosts' => true,
-		'editable' => true
-	],
-	'groupid' => getRequest('groupid')
-]);
-
-$_REQUEST['groupid'] = $pageFilter->groupid;
-$_REQUEST['hostid'] = getRequest('hostid', 0);
-
-$config = select_config();
-
-if (hasRequest('action') && getRequest('action') === 'host.massupdateform' && hasRequest('hosts')) {
-	$data = [
-		'hosts' => getRequest('hosts'),
-		'visible' => getRequest('visible', []),
-		'mass_replace_tpls' => getRequest('mass_replace_tpls'),
-		'mass_clear_tpls' => getRequest('mass_clear_tpls'),
-		'groups' => getRequest('groups', []),
-		'newgroup' => getRequest('newgroup', ''),
-		'status' => getRequest('status', HOST_STATUS_MONITORED),
-		'description' => getRequest('description'),
-		'proxy_hostid' => getRequest('proxy_hostid', ''),
-		'ipmi_authtype' => getRequest('ipmi_authtype', IPMI_AUTHTYPE_DEFAULT),
-		'ipmi_privilege' => getRequest('ipmi_privilege', IPMI_PRIVILEGE_USER),
-		'ipmi_username' => getRequest('ipmi_username', ''),
-		'ipmi_password' => getRequest('ipmi_password', ''),
-		'inventory_mode' => getRequest('inventory_mode', HOST_INVENTORY_DISABLED),
-		'host_inventory' => getRequest('host_inventory', []),
-		'templates' => getRequest('templates', []),
-		'inventories' => zbx_toHash(getHostInventories(), 'db_field'),
-		'tls_connect' => getRequest('tls_connect', HOST_ENCRYPTION_NONE),
-		'tls_accept' => getRequest('tls_accept', HOST_ENCRYPTION_NONE),
-		'tls_issuer' => getRequest('tls_issuer', ''),
-		'tls_subject' => getRequest('tls_subject', ''),
-		'tls_psk_identity' => getRequest('tls_psk_identity', ''),
-		'tls_psk' => getRequest('tls_psk', '')
-	];
-
-	// sort templates
-	natsort($data['templates']);
-
-	// get groups
-	$data['all_groups'] = API::HostGroup()->get([
-		'output' => API_OUTPUT_EXTEND,
-		'editable' => true
-	]);
-	order_result($data['all_groups'], 'name');
-
-	// get proxies
-	$data['proxies'] = DBfetchArray(DBselect(
-		'SELECT h.hostid,h.host'.
-		' FROM hosts h'.
-		' WHERE h.status IN ('.HOST_STATUS_PROXY_ACTIVE.','.HOST_STATUS_PROXY_PASSIVE.')'
-	));
-	order_result($data['proxies'], 'host');
-
-	// get templates data
-	$data['linkedTemplates'] = null;
-	if (!empty($data['templates'])) {
-		$getLinkedTemplates = API::Template()->get([
-			'templateids' => $data['templates'],
-			'output' => ['templateid', 'name']
-		]);
-
-		foreach ($getLinkedTemplates as $getLinkedTemplate) {
-			$data['linkedTemplates'][] = [
-				'id' => $getLinkedTemplate['templateid'],
-				'name' => $getLinkedTemplate['name']
-			];
-		}
-	}
-
-	$hostView = new CView('configuration.host.massupdate', $data);
-}
-elseif (hasRequest('form')) {
-	$data = [
-		// Common & auxiliary
-		'form' => getRequest('form', ''),
-		'hostid' => getRequest('hostid', 0),
-		'clone_hostid' => getRequest('clone_hostid', 0),
-		'groupid' => getRequest('groupid', 0),
-		'flags' => getRequest('flags', ZBX_FLAG_DISCOVERY_NORMAL),
-
-		// Host
-		'host' => getRequest('host', ''),
-		'visiblename' => getRequest('visiblename', ''),
-		'groups' => getRequest('groups', []),
-		'newgroup' => getRequest('newgroup', ''),
-		'interfaces' => getRequest('interfaces', []),
-		'mainInterfaces' => getRequest('mainInterfaces', []),
-		'description' => getRequest('description', ''),
-		'proxy_hostid' => getRequest('proxy_hostid', 0),
-		'status' => getRequest('status', HOST_STATUS_NOT_MONITORED),
-
-		// Templates
-		'templates' => getRequest('templates', []),
-		'clear_templates' => getRequest('clear_templates', []),
-		'original_templates' => [],
-		'linked_templates' => [],
-
-		// IPMI
-		'ipmi_authtype' => getRequest('ipmi_authtype', IPMI_AUTHTYPE_DEFAULT),
-		'ipmi_privilege' => getRequest('ipmi_privilege', IPMI_PRIVILEGE_USER),
-		'ipmi_username' => getRequest('ipmi_username', ''),
-		'ipmi_password' => getRequest('ipmi_password', ''),
-
-		// Macros
-		'macros' => $macros,
-		'show_inherited_macros' => getRequest('show_inherited_macros', 0),
-
-		// Host inventory
-		'inventory_mode' => getRequest('inventory_mode', $config['default_inventory_mode']),
-		'host_inventory' => getRequest('host_inventory', []),
-		'inventory_items' => [],
-
-		// Encryption
-		'tls_connect' => getRequest('tls_connect', HOST_ENCRYPTION_NONE),
-		'tls_accept' => getRequest('tls_accept', HOST_ENCRYPTION_NONE),
-		'tls_issuer' => getRequest('tls_issuer', ''),
-		'tls_subject' => getRequest('tls_subject', ''),
-		'tls_psk_identity' => getRequest('tls_psk_identity', ''),
-		'tls_psk' => getRequest('tls_psk', '')
-	];
-
-	if (!hasRequest('form_refresh')) {
-		if ($data['hostid'] != 0) {
-			$dbHosts = API::Host()->get([
-				'output' => ['hostid', 'proxy_hostid', 'host', 'name', 'status', 'ipmi_authtype', 'ipmi_privilege',
-					'ipmi_username', 'ipmi_password', 'flags', 'description', 'tls_connect', 'tls_accept', 'tls_issuer',
-					'tls_subject', 'tls_psk_identity', 'tls_psk'
-				],
-				'selectGroups' => ['groupid'],
-				'selectParentTemplates' => ['templateid'],
-				'selectMacros' => ['hostmacroid', 'macro', 'value'],
-				'selectDiscoveryRule' => ['itemid', 'name'],
-				'selectInventory' => true,
-				'hostids' => [$data['hostid']]
-			]);
-			$dbHost = reset($dbHosts);
-
-			$data['flags'] = $dbHost['flags'];
-			if ($data['flags'] == ZBX_FLAG_DISCOVERY_CREATED) {
-				$data['discoveryRule'] = $dbHost['discoveryRule'];
-			}
-
-			// Host
-			$data['host'] = $dbHost['host'];
-			$data['visiblename'] = $dbHost['name'];
-			$data['groups'] = zbx_objectValues($dbHost['groups'], 'groupid');
-			$data['interfaces'] = API::HostInterface()->get([
-				'output' => ['interfaceid', 'main', 'type', 'useip', 'ip', 'dns', 'port', 'bulk'],
-				'selectItems' => ['type'],
-				'hostids' => [$data['hostid']],
-				'sortfield' => 'interfaceid'
-			]);
-			$data['description'] = $dbHost['description'];
-			$data['proxy_hostid'] = $dbHost['proxy_hostid'];
-			$data['status'] = $dbHost['status'];
-
-			// Templates
-			$data['templates'] = zbx_objectValues($dbHost['parentTemplates'], 'templateid');
-			$data['original_templates'] = array_combine($data['templates'], $data['templates']);
-
-			// IPMI
-			$data['ipmi_authtype'] = $dbHost['ipmi_authtype'];
-			$data['ipmi_privilege'] = $dbHost['ipmi_privilege'];
-			$data['ipmi_username'] = $dbHost['ipmi_username'];
-			$data['ipmi_password'] = $dbHost['ipmi_password'];
-
-			// Macros
-			$data['macros'] = $dbHost['macros'];
-
-			// Interfaces
-			foreach ($data['interfaces'] as &$interface) {
-				if ($data['flags'] == ZBX_FLAG_DISCOVERY_CREATED) {
-					$interface['locked'] = true;
-				}
-				else {
-					// check if interface has items that require specific interface type, if so type cannot be changed
-					$interface['locked'] = false;
-					foreach ($interface['items'] as $item) {
-						$type = itemTypeInterface($item['type']);
-						if ($type !== false && $type != INTERFACE_TYPE_ANY) {
-							$interface['locked'] = true;
-							break;
-						}
-					}
-				}
-
-				$interface['items'] = (bool) $interface['items'];
-			}
-			unset($interface);
-
-			// Host inventory
-			$data['inventory_mode'] = array_key_exists('inventory_mode', $dbHost['inventory'])
-				? $dbHost['inventory']['inventory_mode']
-				: HOST_INVENTORY_DISABLED;
-			$data['host_inventory'] = $dbHost['inventory'];
-			unset($data['host_inventory']['inventory_mode']);
-
-			// Encryption
-			$data['tls_connect'] = $dbHost['tls_connect'];
-			$data['tls_accept'] = $dbHost['tls_accept'];
-			$data['tls_issuer'] = $dbHost['tls_issuer'];
-			$data['tls_subject'] = $dbHost['tls_subject'];
-			$data['tls_psk_identity'] = $dbHost['tls_psk_identity'];
-			$data['tls_psk'] = $dbHost['tls_psk'];
-
-			// display empty visible name if equal to host name
-			if ($data['host'] === $data['visiblename']) {
-				$data['visiblename'] = '';
-			}
-		}
-		else {
-			$data['status'] = HOST_STATUS_MONITORED;
-		}
-
-		if (!$data['groups'] && $data['groupid'] != 0) {
-			$data['groups'][] = $data['groupid'];
-		}
-	}
-	else {
-		if ($data['hostid'] != 0) {
-			$dbHosts = API::Host()->get([
-				'output' => ['flags'],
-				'selectParentTemplates' => ['templateid'],
-				'selectDiscoveryRule' => ['itemid', 'name'],
-				'hostids' => [$data['hostid']]
-			]);
-			$dbHost = reset($dbHosts);
-
-			$data['flags'] = $dbHost['flags'];
-			if ($data['flags'] == ZBX_FLAG_DISCOVERY_CREATED) {
-				$data['discoveryRule'] = $dbHost['discoveryRule'];
-			}
-
-			$templateids = zbx_objectValues($dbHost['parentTemplates'], 'templateid');
-			$data['original_templates'] = array_combine($templateids, $templateids);
-		}
-
-		foreach ([INTERFACE_TYPE_AGENT, INTERFACE_TYPE_SNMP, INTERFACE_TYPE_JMX, INTERFACE_TYPE_IPMI] as $type) {
-			if (array_key_exists($type, $data['mainInterfaces'])) {
-				$interfaceid = $data['mainInterfaces'][$type];
-				$data['interfaces'][$interfaceid]['main'] = '1';
-			}
-		}
-		$data['interfaces'] = array_values($data['interfaces']);
-	}
-
-	if ($data['hostid'] != 0) {
-		// get items that populate host inventory fields
-		$data['inventory_items'] = API::Item()->get([
-			'output' => ['inventory_link', 'itemid', 'hostid', 'name', 'key_'],
-			'hostids' => [$dbHost['hostid']],
-			'filter' => ['inventory_link' => array_keys(getHostInventories())]
-		]);
-		$data['inventory_items'] = zbx_toHash($data['inventory_items'], 'inventory_link');
-		$data['inventory_items'] = CMacrosResolverHelper::resolveItemNames($data['inventory_items']);
-	}
-
-	if ($data['flags'] == ZBX_FLAG_DISCOVERY_CREATED) {
-		if ($data['proxy_hostid'] != 0) {
-			$data['proxies'] = API::Proxy()->get([
-				'output' => ['host'],
-				'proxyids' => [$data['proxy_hostid']],
-				'preservekeys' => true
-			]);
-		}
-		else {
-			$data['proxies'] = [];
-		}
-	}
-	else {
-		$data['proxies'] = API::Proxy()->get([
-			'output' => ['host'],
-			'preservekeys' => true
-		]);
-		order_result($proxies, 'host');
-	}
-
-	foreach ($data['proxies'] as &$proxy) {
-		$proxy = $proxy['host'];
-	}
-	unset($proxy);
-
-	if ($data['show_inherited_macros']) {
-		$data['macros'] = mergeInheritedMacros($data['macros'], getInheritedMacros($data['templates']));
-	}
-	$data['macros'] = array_values(order_macros($data['macros'], 'macro'));
-
-	if (!$data['macros'] && $data['flags'] != ZBX_FLAG_DISCOVERY_CREATED) {
-		$macro = ['macro' => '', 'value' => ''];
-		if ($data['show_inherited_macros']) {
-			$macro['type'] = MACRO_TYPE_HOSTMACRO;
-		}
-		$data['macros'][] = $macro;
-	}
-
-	// groups with RW permissions
-	$data['groupsAllowed'] = API::HostGroup()->get([
-		'output' => [],
-		'editable' => true,
-		'preservekeys' => true
-	]);
-
-	// all available groups
-	$data['groupsAll'] = API::HostGroup()->get(['output' => ['groupid', 'name']]);
-	CArrayHelper::sort($data['groupsAll'], ['name']);
-
-	if ($data['templates']) {
-		$data['linked_templates'] = API::Template()->get([
-			'output' => ['templateid', 'name'],
-			'templateids' => $data['templates']
-		]);
-		CArrayHelper::sort($data['linked_templates'], ['name']);
-	}
-
-	$hostView = new CView('configuration.host.edit', $data);
-}
-else {
-	$sortField = getRequest('sort', CProfile::get('web.'.$page['file'].'.sort', 'name'));
-	$sortOrder = getRequest('sortorder', CProfile::get('web.'.$page['file'].'.sortorder', ZBX_SORT_UP));
-
-	CProfile::update('web.'.$page['file'].'.sort', $sortField, PROFILE_TYPE_STR);
-	CProfile::update('web.'.$page['file'].'.sortorder', $sortOrder, PROFILE_TYPE_STR);
-
-	// get Hosts
-	$hosts = [];
-	if ($pageFilter->groupsSelected) {
-		$hosts = API::Host()->get([
-			'output' => ['hostid', $sortField],
-			'groupids' => ($pageFilter->groupid > 0) ? $pageFilter->groupid : null,
-			'editable' => true,
-			'sortfield' => $sortField,
-			'limit' => $config['search_limit'] + 1,
-			'search' => [
-				'name' => ($filter['host'] === '') ? null : $filter['host'],
-				'ip' => ($filter['ip'] === '') ? null : $filter['ip'],
-				'dns' => ($filter['dns'] === '') ? null : $filter['dns']
-			],
-			'filter' => [
-				'port' => ($filter['port'] === '') ? null : $filter['port']
-			]
-		]);
-	}
-	order_result($hosts, $sortField, $sortOrder);
-
-	$pagingLine = getPagingLine($hosts, $sortOrder);
-
-	$hosts = API::Host()->get([
-		'hostids' => zbx_objectValues($hosts, 'hostid'),
-		'output' => API_OUTPUT_EXTEND,
-		'selectParentTemplates' => ['hostid', 'name'],
-		'selectInterfaces' => API_OUTPUT_EXTEND,
-		'selectItems' => API_OUTPUT_COUNT,
-		'selectDiscoveries' => API_OUTPUT_COUNT,
-		'selectTriggers' => API_OUTPUT_COUNT,
-		'selectGraphs' => API_OUTPUT_COUNT,
-		'selectApplications' => API_OUTPUT_COUNT,
-		'selectHttpTests' => API_OUTPUT_COUNT,
-		'selectDiscoveryRule' => ['itemid', 'name'],
-		'selectHostDiscovery' => ['ts_delete']
-	]);
-	order_result($hosts, $sortField, $sortOrder);
-
-	// selecting linked templates to templates linked to hosts
-	$templateIds = [];
-	foreach ($hosts as $host) {
-		$templateIds = array_merge($templateIds, zbx_objectValues($host['parentTemplates'], 'templateid'));
-	}
-	$templateIds = array_unique($templateIds);
-
-	$templates = API::Template()->get([
-		'output' => ['templateid', 'name'],
-		'templateids' => $templateIds,
-		'selectParentTemplates' => ['hostid', 'name'],
-		'preservekeys' => true
-	]);
-
-	// get proxy host IDs that that are not 0
-	$proxyHostIds = [];
-	foreach ($hosts as $host) {
-		if ($host['proxy_hostid']) {
-			$proxyHostIds[$host['proxy_hostid']] = $host['proxy_hostid'];
-		}
-	}
-	$proxies = [];
-	if ($proxyHostIds) {
-		$proxies = API::Proxy()->get([
-			'proxyids' => $proxyHostIds,
-			'output' => ['host'],
-			'preservekeys' => true
-		]);
-	}
-
-	$data = [
-		'pageFilter' => $pageFilter,
-		'hosts' => $hosts,
-		'paging' => $pagingLine,
-		'filter' => $filter,
-		'sortField' => $sortField,
-		'sortOrder' => $sortOrder,
-		'groupId' => $pageFilter->groupid,
-		'config' => $config,
-		'templates' => $templates,
-		'proxies' => $proxies
-	];
+    /*
+    ** Zabbix
+    ** Copyright (C) 2001-2016 Zabbix SIA
+    **
+    ** This program is free software; you can redistribute it and/or modify
+    ** it under the terms of the GNU General Public License as published by
+    ** the Free Software Foundation; either version 2 of the License, or
+    ** (at your option) any later version.
+    **
+    ** This program is distributed in the hope that it will be useful,
+    ** but WITHOUT ANY WARRANTY; without even the implied warranty of
+    ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+    ** GNU General Public License for more details.
+    **
+    ** You should have received a copy of the GNU General Public License
+    ** along with this program; if not, write to the Free Software
+    ** Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+    **/
+
+
+    require_once dirname(__FILE__) . '/include/config.inc.php';
+    require_once dirname(__FILE__) . '/include/forms.inc.php';
+
+    if (hasRequest('action') && getRequest('action') == 'host.export' && hasRequest('hosts')) {
+        $page['file'] = 'zbx_export_hosts.xml';
+        $page['type'] = detect_page_type(PAGE_TYPE_XML);
+
+        $exportData = true;
+    } else {
+        $page['title'] = _('Configuration of hosts');
+        $page['file'] = 'hosts.php';
+        $page['type'] = detect_page_type(PAGE_TYPE_HTML);
+        $page['scripts'] = ['multiselect.js'];
+
+        $exportData = false;
+    }
+
+    require_once dirname(__FILE__) . '/include/page_header.php';
+
+    // VAR	TYPE	OPTIONAL	FLAGS	VALIDATION	EXCEPTION
+    $fields = [
+        'hosts'                 => [T_ZBX_INT, O_OPT, P_SYS, DB_ID, null],
+        'groups'                => [T_ZBX_INT, O_OPT, P_SYS, DB_ID, null],
+        'new_groups'            => [T_ZBX_STR, O_OPT, P_SYS, null, null],
+        'hostids'               => [T_ZBX_INT, O_OPT, P_SYS, DB_ID, null],
+        'groupids'              => [T_ZBX_INT, O_OPT, P_SYS, DB_ID, null],
+        'applications'          => [T_ZBX_INT, O_OPT, P_SYS, DB_ID, null],
+        'groupid'               => [T_ZBX_INT, O_OPT, P_SYS, DB_ID, null],
+        'hostid'                => [T_ZBX_INT, O_OPT, P_SYS, DB_ID, 'isset({form}) && {form} == "update"'],
+        'clone_hostid'          => [T_ZBX_INT, O_OPT, P_SYS, DB_ID, 'isset({form}) && {form} == "full_clone"'],
+        'host'                  => [
+            T_ZBX_STR,
+            O_OPT,
+            null,
+            NOT_EMPTY,
+            'isset({add}) || isset({update})',
+            _('Host name')
+        ],
+        'visiblename'           => [T_ZBX_STR, O_OPT, null, null, 'isset({add}) || isset({update})'],
+        'description'           => [T_ZBX_STR, O_OPT, null, null, null],
+        'proxy_hostid'          => [T_ZBX_INT, O_OPT, P_SYS, DB_ID, null],
+        'status'                => [
+            T_ZBX_INT,
+            O_OPT,
+            null,
+            IN([HOST_STATUS_MONITORED, HOST_STATUS_NOT_MONITORED]),
+            null
+        ],
+        'newgroup'              => [T_ZBX_STR, O_OPT, null, null, null],
+        'interfaces'            => [
+            T_ZBX_STR,
+            O_OPT,
+            null,
+            NOT_EMPTY,
+            'isset({add}) || isset({update})',
+            _('Agent or SNMP or JMX or IPMI interface')
+        ],
+        'mainInterfaces'        => [T_ZBX_INT, O_OPT, null, DB_ID, null],
+        'templates'             => [T_ZBX_INT, O_OPT, null, DB_ID, null],
+        'add_template'          => [T_ZBX_STR, O_OPT, null, null, null],
+        'add_templates'         => [T_ZBX_INT, O_OPT, null, DB_ID, null],
+        'templates_rem'         => [T_ZBX_STR, O_OPT, P_SYS | P_ACT, null, null],
+        'clear_templates'       => [T_ZBX_INT, O_OPT, null, DB_ID, null],
+        'ipmi_authtype'         => [T_ZBX_INT, O_OPT, null, BETWEEN(-1, 6), null],
+        'ipmi_privilege'        => [T_ZBX_INT, O_OPT, null, BETWEEN(0, 5), null],
+        'ipmi_username'         => [T_ZBX_STR, O_OPT, null, null, null],
+        'ipmi_password'         => [T_ZBX_STR, O_OPT, null, null, null],
+        'tls_connect'           => [
+            T_ZBX_INT,
+            O_OPT,
+            null,
+            IN([HOST_ENCRYPTION_NONE, HOST_ENCRYPTION_PSK, HOST_ENCRYPTION_CERTIFICATE]),
+            null
+        ],
+        'tls_accept'            => [
+            T_ZBX_INT,
+            O_OPT,
+            null,
+            BETWEEN(0, (HOST_ENCRYPTION_NONE | HOST_ENCRYPTION_PSK | HOST_ENCRYPTION_CERTIFICATE)),
+            null
+        ],
+        'tls_subject'           => [T_ZBX_STR, O_OPT, null, null, null],
+        'tls_issuer'            => [T_ZBX_STR, O_OPT, null, null, null],
+        'tls_psk_identity'      => [T_ZBX_STR, O_OPT, null, null, null],
+        'tls_psk'               => [T_ZBX_STR, O_OPT, null, null, null],
+        'flags'                 => [
+            T_ZBX_INT,
+            O_OPT,
+            null,
+            IN([ZBX_FLAG_DISCOVERY_NORMAL, ZBX_FLAG_DISCOVERY_CREATED]),
+            null
+        ],
+        'mass_replace_tpls'     => [T_ZBX_STR, O_OPT, null, null, null],
+        'mass_clear_tpls'       => [T_ZBX_STR, O_OPT, null, null, null],
+        'inventory_mode'        => [
+            T_ZBX_INT,
+            O_OPT,
+            null,
+            IN(HOST_INVENTORY_DISABLED . ',' . HOST_INVENTORY_MANUAL . ',' . HOST_INVENTORY_AUTOMATIC),
+            null
+        ],
+        'host_inventory'        => [T_ZBX_STR, O_OPT, P_UNSET_EMPTY, null, null],
+        'macros'                => [T_ZBX_STR, O_OPT, P_SYS, null, null],
+        'visible'               => [T_ZBX_STR, O_OPT, null, null, null],
+        'show_inherited_macros' => [T_ZBX_INT, O_OPT, null, IN([0, 1]), null],
+        // actions
+        'action'                => [
+            T_ZBX_STR,
+            O_OPT,
+            P_SYS | P_ACT,
+            IN('"host.export","host.massdelete","host.massdisable","host.massenable","host.massupdate"' . ',"host.massupdateform"'),
+            null
+        ],
+        'add_to_group'          => [T_ZBX_INT, O_OPT, P_SYS | P_ACT, DB_ID, null],
+        'delete_from_group'     => [T_ZBX_INT, O_OPT, P_SYS | P_ACT, DB_ID, null],
+        'unlink'                => [T_ZBX_STR, O_OPT, P_SYS | P_ACT, null, null],
+        'unlink_and_clear'      => [T_ZBX_STR, O_OPT, P_SYS | P_ACT, null, null],
+        'add'                   => [T_ZBX_STR, O_OPT, P_SYS | P_ACT, null, null],
+        'update'                => [T_ZBX_STR, O_OPT, P_SYS | P_ACT, null, null],
+        'masssave'              => [T_ZBX_STR, O_OPT, P_SYS | P_ACT, null, null],
+        'clone'                 => [T_ZBX_STR, O_OPT, P_SYS | P_ACT, null, null],
+        'full_clone'            => [T_ZBX_STR, O_OPT, P_SYS | P_ACT, null, null],
+        'delete'                => [T_ZBX_STR, O_OPT, P_SYS | P_ACT, null, null],
+        'cancel'                => [T_ZBX_STR, O_OPT, P_SYS, null, null],
+        'form'                  => [T_ZBX_STR, O_OPT, P_SYS, null, null],
+        'form_refresh'          => [T_ZBX_INT, O_OPT, null, null, null],
+        // filter
+        'filter_set'            => [T_ZBX_STR, O_OPT, P_SYS, null, null],
+        'filter_rst'            => [T_ZBX_STR, O_OPT, P_SYS, null, null],
+        'filter_host'           => [T_ZBX_STR, O_OPT, null, null, null],
+        'filter_ip'             => [T_ZBX_STR, O_OPT, null, null, null],
+        'filter_dns'            => [T_ZBX_STR, O_OPT, null, null, null],
+        'filter_port'           => [T_ZBX_STR, O_OPT, null, null, null],
+        // sort and sortorder
+        'sort'                  => [T_ZBX_STR, O_OPT, P_SYS, IN('"name","status"'), null],
+        'sortorder'             => [T_ZBX_STR, O_OPT, P_SYS, IN('"' . ZBX_SORT_DOWN . '","' . ZBX_SORT_UP . '"'), null]
+    ];
+    check_fields($fields);
+
+    /*
+     * Permissions
+     */
+    if (getRequest('groupid') && !API::HostGroup()->isWritable([$_REQUEST['groupid']])) {
+        access_deny();
+    }
+    if (getRequest('hostid') && !API::Host()->isWritable([$_REQUEST['hostid']])) {
+        access_deny();
+    }
+
+    $hostIds = getRequest('hosts', []);
+
+    /*
+     * Export
+     */
+    if ($exportData) {
+        $export = new CConfigurationExport(['hosts' => $hostIds]);
+        $export->setBuilder(new CConfigurationExportBuilder());
+        $export->setWriter(CExportWriterFactory::getWriter(CExportWriterFactory::XML));
+        $exportData = $export->export();
+
+        if (hasErrorMesssages()) {
+            show_messages();
+        } else {
+            print($exportData);
+        }
+
+        exit;
+    }
+
+    /*
+     * Filter
+     */
+    if (hasRequest('filter_set')) {
+        CProfile::update('web.hosts.filter_ip', getRequest('filter_ip', ''), PROFILE_TYPE_STR);
+        CProfile::update('web.hosts.filter_dns', getRequest('filter_dns', ''), PROFILE_TYPE_STR);
+        CProfile::update('web.hosts.filter_host', getRequest('filter_host', ''), PROFILE_TYPE_STR);
+        CProfile::update('web.hosts.filter_port', getRequest('filter_port', ''), PROFILE_TYPE_STR);
+    } elseif (hasRequest('filter_rst')) {
+        DBStart();
+        CProfile::delete('web.hosts.filter_ip');
+        CProfile::delete('web.hosts.filter_dns');
+        CProfile::delete('web.hosts.filter_host');
+        CProfile::delete('web.hosts.filter_port');
+        DBend();
+    }
+
+    $filter['ip'] = CProfile::get('web.hosts.filter_ip', '');
+    $filter['dns'] = CProfile::get('web.hosts.filter_dns', '');
+    $filter['host'] = CProfile::get('web.hosts.filter_host', '');
+    $filter['port'] = CProfile::get('web.hosts.filter_port', '');
+
+    // remove inherited macros data (actions: 'add', 'update' and 'form')
+    $macros = cleanInheritedMacros(getRequest('macros', []));
+
+    // remove empty new macro lines
+    foreach ($macros as $idx => $macro) {
+        if (!array_key_exists('hostmacroid', $macro) && $macro['macro'] === '' && $macro['value'] === '') {
+            unset($macros[$idx]);
+        }
+    }
+
+    /*
+     * Actions
+     */
+    if (isset($_REQUEST['add_template']) && isset($_REQUEST['add_templates'])) {
+        $_REQUEST['templates'] = getRequest('templates', []);
+        $_REQUEST['templates'] = array_merge($_REQUEST['templates'], $_REQUEST['add_templates']);
+    }
+    if (isset($_REQUEST['unlink']) || isset($_REQUEST['unlink_and_clear'])) {
+        $_REQUEST['clear_templates'] = getRequest('clear_templates', []);
+
+        $unlinkTemplates = [];
+
+        if (isset($_REQUEST['unlink'])) {
+            // templates_rem for old style removal in massupdate form
+            if (isset($_REQUEST['templates_rem'])) {
+                $unlinkTemplates = array_keys($_REQUEST['templates_rem']);
+            } elseif (is_array($_REQUEST['unlink'])) {
+                $unlinkTemplates = array_keys($_REQUEST['unlink']);
+            }
+        } else {
+            $unlinkTemplates = array_keys($_REQUEST['unlink_and_clear']);
+
+            $_REQUEST['clear_templates'] = array_merge($_REQUEST['clear_templates'], $unlinkTemplates);
+        }
+
+        foreach ($unlinkTemplates as $templateId) {
+            unset($_REQUEST['templates'][array_search($templateId, $_REQUEST['templates'])]);
+        }
+    } elseif ((hasRequest('clone') || hasRequest('full_clone')) && hasRequest('hostid')) {
+        $_REQUEST['form'] = hasRequest('clone') ? 'clone' : 'full_clone';
+
+        $groupids = getRequest('groups', []);
+        if ($groupids) {
+            // leave only writable groups
+            $_REQUEST['groups'] = array_keys(API::HostGroup()->get([
+                'output'       => [],
+                'groupids'     => $groupids,
+                'editable'     => true,
+                'preservekeys' => true
+            ]));
+        }
+
+        if (hasRequest('interfaces')) {
+            $interfaceid = 1;
+            foreach ($_REQUEST['interfaces'] as &$interface) {
+                $interface['interfaceid'] = (string) $interfaceid++;
+                unset($interface['locked'], $interface['items']);
+            }
+            unset($interface);
+        }
+
+        if (hasRequest('full_clone')) {
+            $_REQUEST['clone_hostid'] = $_REQUEST['hostid'];
+        }
+
+        unset($_REQUEST['hostid'], $_REQUEST['flags']);
+    } elseif (hasRequest('action') && getRequest('action') == 'host.massupdate' && hasRequest('masssave')) {
+        $hostIds = getRequest('hosts', []);
+        $visible = getRequest('visible', []);
+        $_REQUEST['proxy_hostid'] = getRequest('proxy_hostid', 0);
+        $_REQUEST['templates'] = getRequest('templates', []);
+
+        try {
+            DBstart();
+
+            // filter only normal and discovery created hosts
+            $hosts = API::Host()->get([
+                'output'  => ['hostid'],
+                'hostids' => $hostIds,
+                'filter'  => ['flags' => [ZBX_FLAG_DISCOVERY_NORMAL, ZBX_FLAG_DISCOVERY_CREATED]]
+            ]);
+            $hosts = ['hosts' => $hosts];
+
+            $properties = [
+                'proxy_hostid',
+                'ipmi_authtype',
+                'ipmi_privilege',
+                'ipmi_username',
+                'ipmi_password',
+                'description'
+            ];
+
+            $newValues = [];
+            foreach ($properties as $property) {
+                if (isset($visible[$property])) {
+                    $newValues[$property] = $_REQUEST[$property];
+                }
+            }
+
+            if (isset($visible['status'])) {
+                $newValues['status'] = getRequest('status', HOST_STATUS_NOT_MONITORED);
+            }
+
+            if (isset($visible['inventory_mode'])) {
+                $newValues['inventory_mode'] = getRequest('inventory_mode', HOST_INVENTORY_DISABLED);
+                $newValues['inventory'] = ($newValues['inventory_mode'] == HOST_INVENTORY_DISABLED) ? [] : getRequest('host_inventory', []);
+            }
+
+            if (array_key_exists('encryption', $visible)) {
+                $newValues['tls_connect'] = getRequest('tls_connect', HOST_ENCRYPTION_NONE);
+                $newValues['tls_accept'] = getRequest('tls_accept', HOST_ENCRYPTION_NONE);
+                $newValues['tls_issuer'] = getRequest('tls_issuer', '');
+                $newValues['tls_subject'] = getRequest('tls_subject', '');
+                $newValues['tls_psk_identity'] = getRequest('tls_psk_identity', '');
+                $newValues['tls_psk'] = getRequest('tls_psk', '');
+            }
+
+            $templateIds = [];
+            if (isset($visible['templates'])) {
+                $templateIds = $_REQUEST['templates'];
+            }
+
+            // add new or existing host groups
+            $newHostGroupIds = [];
+            if (isset($visible['new_groups']) && !empty($_REQUEST['new_groups'])) {
+                if (CWebUser::getType() == USER_TYPE_SUPER_ADMIN) {
+                    foreach ($_REQUEST['new_groups'] as $newGroup) {
+                        if (is_array($newGroup) && isset($newGroup['new'])) {
+                            $newGroups[] = ['name' => $newGroup['new']];
+                        } else {
+                            $newHostGroupIds[] = $newGroup;
+                        }
+                    }
+
+                    if (isset($newGroups)) {
+                        if (!$createdGroups = API::HostGroup()->create($newGroups)) {
+                            throw new Exception();
+                        }
+
+                        $newHostGroupIds = $newHostGroupIds ? array_merge($newHostGroupIds, $createdGroups['groupids']) : $createdGroups['groupids'];
+                    }
+                } else {
+                    $newHostGroupIds = getRequest('new_groups');
+                }
+            }
+
+            if (isset($visible['groups'])) {
+                if (isset($_REQUEST['groups'])) {
+                    $replaceHostGroupsIds = $newHostGroupIds ? array_unique(array_merge(getRequest('groups'), $newHostGroupIds)) : $_REQUEST['groups'];
+                } elseif ($newHostGroupIds) {
+                    $replaceHostGroupsIds = $newHostGroupIds;
+                }
+
+                if (isset($replaceHostGroupsIds)) {
+                    $hosts['groups'] = API::HostGroup()->get([
+                        'groupids' => $replaceHostGroupsIds,
+                        'editable' => true,
+                        'output'   => ['groupid']
+                    ]);
+                } else {
+                    $hosts['groups'] = [];
+                }
+            } elseif ($newHostGroupIds) {
+                $newHostGroups = API::HostGroup()->get([
+                    'groupids' => $newHostGroupIds,
+                    'editable' => true,
+                    'output'   => ['groupid']
+                ]);
+            }
+
+            if (isset($_REQUEST['mass_replace_tpls'])) {
+                if (isset($_REQUEST['mass_clear_tpls'])) {
+                    $hostTemplates = API::Template()->get([
+                        'output'  => ['templateid'],
+                        'hostids' => $hostIds
+                    ]);
+
+                    $hostTemplateIds = zbx_objectValues($hostTemplates, 'templateid');
+                    $templatesToDelete = array_diff($hostTemplateIds, $templateIds);
+
+                    $hosts['templates_clear'] = zbx_toObject($templatesToDelete, 'templateid');
+                }
+
+                $hosts['templates'] = $templateIds;
+            }
+
+            $result = API::Host()->massUpdate(array_merge($hosts, $newValues));
+            if ($result === false) {
+                throw new Exception();
+            }
+
+            $add = [];
+            if ($templateIds && isset($visible['templates'])) {
+                $add['templates'] = $templateIds;
+            }
+
+            // add new host groups
+            if ($newHostGroupIds && (!isset($visible['groups']) || !isset($replaceHostGroups))) {
+                $add['groups'] = zbx_toObject($newHostGroupIds, 'groupid');
+            }
+
+            if ($add) {
+                $add['hosts'] = $hosts['hosts'];
+
+                $result = API::Host()->massAdd($add);
+
+                if ($result === false) {
+                    throw new Exception();
+                }
+            }
+
+            DBend(true);
+
+            uncheckTableRows();
+            show_message(_('Hosts updated'));
+
+            unset($_REQUEST['massupdate'], $_REQUEST['form'], $_REQUEST['hosts']);
+        } catch (Exception $e) {
+            DBend(false);
+            show_error_message(_('Cannot update hosts'));
+        }
+    } elseif (hasRequest('add') || hasRequest('update')) {
+        try {
+            DBstart();
+
+            $hostId = getRequest('hostid', 0);
+
+            if ($hostId != 0) {
+                $create = false;
+
+                $msgOk = _('Host updated');
+                $msgFail = _('Cannot update host');
+
+                $dbHost = API::Host()->get([
+                    'output'   => API_OUTPUT_EXTEND,
+                    'hostids'  => $hostId,
+                    'editable' => true
+                ]);
+                $dbHost = reset($dbHost);
+            } else {
+                $create = true;
+
+                $msgOk = _('Host added');
+                $msgFail = _('Cannot add host');
+            }
+
+            // host data
+            if (!$create && $dbHost['flags'] == ZBX_FLAG_DISCOVERY_CREATED) {
+                $host = [
+                    'hostid'      => $hostId,
+                    'status'      => getRequest('status', HOST_STATUS_NOT_MONITORED),
+                    'description' => getRequest('description', ''),
+                    'inventory'   => (getRequest('inventory_mode') == HOST_INVENTORY_DISABLED) ? [] : getRequest('host_inventory', [])
+                ];
+            } else {
+                // templates
+                $templates = [];
+
+                foreach (getRequest('templates', []) as $templateId) {
+                    $templates[] = ['templateid' => $templateId];
+                }
+
+                // interfaces
+                $interfaces = getRequest('interfaces', []);
+
+                foreach ($interfaces as $key => $interface) {
+                    if (zbx_empty($interface['ip']) && zbx_empty($interface['dns'])) {
+                        unset($interface[$key]);
+                        continue;
+                    }
+
+                    if ($interface['type'] == INTERFACE_TYPE_SNMP && !isset($interface['bulk'])) {
+                        $interfaces[$key]['bulk'] = SNMP_BULK_DISABLED;
+                    } else {
+                        $interfaces[$key]['bulk'] = SNMP_BULK_ENABLED;
+                    }
+
+                    if ($interface['isNew']) {
+                        unset($interfaces[$key]['interfaceid']);
+                    }
+
+                    unset($interfaces[$key]['isNew']);
+                    $interfaces[$key]['main'] = 0;
+                }
+
+                $mainInterfaces = getRequest('mainInterfaces', []);
+                foreach ([INTERFACE_TYPE_AGENT, INTERFACE_TYPE_SNMP, INTERFACE_TYPE_JMX, INTERFACE_TYPE_IPMI] as $type)
+                {
+                    if (array_key_exists($type, $mainInterfaces)) {
+                        $interfaces[$mainInterfaces[$type]]['main'] = INTERFACE_PRIMARY;
+                    }
+                }
+
+                // new group
+                $groups = getRequest('groups', []);
+                $newGroup = getRequest('newgroup');
+
+                if (!zbx_empty($newGroup)) {
+                    $newGroup = API::HostGroup()->create(['name' => $newGroup]);
+
+                    if (!$newGroup) {
+                        throw new Exception();
+                    }
+
+                    $groups[] = reset($newGroup['groupids']);
+                }
+
+                $groups = zbx_toObject($groups, 'groupid');
+
+                // host data
+                $host = [
+                    'host'             => getRequest('host'),
+                    'name'             => getRequest('visiblename'),
+                    'status'           => getRequest('status', HOST_STATUS_NOT_MONITORED),
+                    'description'      => getRequest('description'),
+                    'proxy_hostid'     => getRequest('proxy_hostid', 0),
+                    'ipmi_authtype'    => getRequest('ipmi_authtype'),
+                    'ipmi_privilege'   => getRequest('ipmi_privilege'),
+                    'ipmi_username'    => getRequest('ipmi_username'),
+                    'ipmi_password'    => getRequest('ipmi_password'),
+                    'tls_connect'      => getRequest('tls_connect', HOST_ENCRYPTION_NONE),
+                    'tls_accept'       => getRequest('tls_accept', HOST_ENCRYPTION_NONE),
+                    'tls_issuer'       => getRequest('tls_issuer'),
+                    'tls_subject'      => getRequest('tls_subject'),
+                    'tls_psk_identity' => getRequest('tls_psk_identity'),
+                    'tls_psk'          => getRequest('tls_psk'),
+                    'groups'           => $groups,
+                    'templates'        => $templates,
+                    'interfaces'       => $interfaces,
+                    'macros'           => $macros,
+                    'inventory_mode'   => getRequest('inventory_mode'),
+                    'inventory'        => (getRequest('inventory_mode') == HOST_INVENTORY_DISABLED) ? [] : getRequest('host_inventory', [])
+                ];
+
+                if (!$create) {
+                    $host['templates_clear'] = zbx_toObject(getRequest('clear_templates', []), 'templateid');
+                }
+            }
+
+            if ($create) {
+                $hostIds = API::Host()->create($host);
+
+                if ($hostIds) {
+                    $hostId = reset($hostIds['hostids']);
+                } else {
+                    throw new Exception();
+                }
+
+                add_audit_ext(AUDIT_ACTION_ADD, AUDIT_RESOURCE_HOST, $hostId, $host['host'], null, null, null);
+            } else {
+                $host['hostid'] = $hostId;
+
+                if (!API::Host()->update($host)) {
+                    throw new Exception();
+                }
+
+                $dbHostNew = API::Host()->get([
+                    'output'   => API_OUTPUT_EXTEND,
+                    'hostids'  => $hostId,
+                    'editable' => true
+                ]);
+                $dbHostNew = reset($dbHostNew);
+
+                add_audit_ext(AUDIT_ACTION_UPDATE, AUDIT_RESOURCE_HOST, $dbHostNew['hostid'], $dbHostNew['host'], 'hosts', $dbHost, $dbHostNew);
+            }
+
+            // full clone
+            if (getRequest('form', '') === 'full_clone' && getRequest('clone_hostid', 0) != 0) {
+                $srcHostId = getRequest('clone_hostid');
+
+                // copy applications
+                if (!copyApplications($srcHostId, $hostId)) {
+                    throw new Exception();
+                }
+
+                // copy items
+                if (!copyItems($srcHostId, $hostId)) {
+                    throw new Exception();
+                }
+
+                // copy web scenarios
+                if (!copyHttpTests($srcHostId, $hostId)) {
+                    throw new Exception();
+                }
+
+                // copy triggers
+                $dbTriggers = API::Trigger()->get([
+                    'output'    => ['triggerid'],
+                    'hostids'   => $srcHostId,
+                    'inherited' => false
+                ]);
+
+                if ($dbTriggers) {
+                    if (!copyTriggersToHosts(zbx_objectValues($dbTriggers, 'triggerid'), $hostId, $srcHostId)) {
+                        throw new Exception();
+                    }
+                }
+
+                // copy discovery rules
+                $dbDiscoveryRules = API::DiscoveryRule()->get([
+                    'output'    => ['itemid'],
+                    'hostids'   => $srcHostId,
+                    'inherited' => false
+                ]);
+
+                if ($dbDiscoveryRules) {
+                    $copyDiscoveryRules = API::DiscoveryRule()->copy([
+                        'discoveryids' => zbx_objectValues($dbDiscoveryRules, 'itemid'),
+                        'hostids'      => [$hostId]
+                    ]);
+
+                    if (!$copyDiscoveryRules) {
+                        throw new Exception();
+                    }
+                }
+
+                // copy graphs
+                $dbGraphs = API::Graph()->get([
+                    'output'      => API_OUTPUT_EXTEND,
+                    'selectHosts' => ['hostid'],
+                    'selectItems' => ['type'],
+                    'hostids'     => $srcHostId,
+                    'filter'      => ['flags' => ZBX_FLAG_DISCOVERY_NORMAL],
+                    'inherited'   => false
+                ]);
+
+                foreach ($dbGraphs as $dbGraph) {
+                    if (count($dbGraph['hosts']) > 1) {
+                        continue;
+                    }
+
+                    if (httpItemExists($dbGraph['items'])) {
+                        continue;
+                    }
+
+                    if (!copyGraphToHost($dbGraph['graphid'], $hostId)) {
+                        throw new Exception();
+                    }
+                }
+            }
+
+            $result = DBend(true);
+
+            if ($result) {
+                uncheckTableRows();
+            }
+            show_messages($result, $msgOk, $msgFail);
+
+            unset($_REQUEST['form'], $_REQUEST['hostid']);
+        } catch (Exception $e) {
+            DBend(false);
+            show_messages(false, $msgOk, $msgFail);
+        }
+    } elseif (hasRequest('delete') && hasRequest('hostid')) {
+        DBstart();
+
+        $result = API::Host()->delete([getRequest('hostid')]);
+        $result = DBend($result);
+
+        if ($result) {
+            unset($_REQUEST['form'], $_REQUEST['hostid']);
+            uncheckTableRows();
+        }
+        show_messages($result, _('Host deleted'), _('Cannot delete host'));
+
+        unset($_REQUEST['delete']);
+    } elseif (hasRequest('action') && getRequest('action') == 'host.massdelete' && hasRequest('hosts')) {
+        DBstart();
+
+        $result = API::Host()->delete(getRequest('hosts'));
+        $result = DBend($result);
+
+        if ($result) {
+            uncheckTableRows();
+        }
+        show_messages($result, _('Host deleted'), _('Cannot delete host'));
+    } elseif (hasRequest('action') && str_in_array(getRequest('action'), [
+            'host.massenable',
+            'host.massdisable'
+        ]) && hasRequest('hosts')
+    ) {
+        $enable = (getRequest('action') == 'host.massenable');
+        $status = $enable ? TRIGGER_STATUS_ENABLED : TRIGGER_STATUS_DISABLED;
+
+        $actHosts = API::Host()->get([
+            'hostids'         => getRequest('hosts'),
+            'editable'        => true,
+            'templated_hosts' => true,
+            'output'          => ['hostid']
+        ]);
+        $actHosts = zbx_objectValues($actHosts, 'hostid');
+
+        if ($actHosts) {
+            DBstart();
+
+            $result = updateHostStatus($actHosts, $status);
+            $result = DBend($result);
+
+            if ($result) {
+                uncheckTableRows();
+            }
+
+            $updated = count($actHosts);
+
+            $messageSuccess = $enable ? _n('Host enabled', 'Hosts enabled', $updated) : _n('Host disabled', 'Hosts disabled', $updated);
+            $messageFailed = $enable ? _n('Cannot enable host', 'Cannot enable hosts', $updated) : _n('Cannot disable host', 'Cannot disable hosts', $updated);
+
+            show_messages($result, $messageSuccess, $messageFailed);
+        }
+    }
+
+    /*
+     * Display
+     */
+    $pageFilter = new CPageFilter([
+        'groups'  => [
+            'real_hosts' => true,
+            'editable'   => true
+        ],
+        'groupid' => getRequest('groupid')
+    ]);
+
+    $_REQUEST['groupid'] = $pageFilter->groupid;
+    $_REQUEST['hostid'] = getRequest('hostid', 0);
+
+    $config = select_config();
+
+    if (hasRequest('action') && getRequest('action') === 'host.massupdateform' && hasRequest('hosts')) {
+        $data = [
+            'hosts'             => getRequest('hosts'),
+            'visible'           => getRequest('visible', []),
+            'mass_replace_tpls' => getRequest('mass_replace_tpls'),
+            'mass_clear_tpls'   => getRequest('mass_clear_tpls'),
+            'groups'            => getRequest('groups', []),
+            'newgroup'          => getRequest('newgroup', ''),
+            'status'            => getRequest('status', HOST_STATUS_MONITORED),
+            'description'       => getRequest('description'),
+            'proxy_hostid'      => getRequest('proxy_hostid', ''),
+            'ipmi_authtype'     => getRequest('ipmi_authtype', IPMI_AUTHTYPE_DEFAULT),
+            'ipmi_privilege'    => getRequest('ipmi_privilege', IPMI_PRIVILEGE_USER),
+            'ipmi_username'     => getRequest('ipmi_username', ''),
+            'ipmi_password'     => getRequest('ipmi_password', ''),
+            'inventory_mode'    => getRequest('inventory_mode', HOST_INVENTORY_DISABLED),
+            'host_inventory'    => getRequest('host_inventory', []),
+            'templates'         => getRequest('templates', []),
+            'inventories'       => zbx_toHash(getHostInventories(), 'db_field'),
+            'tls_connect'       => getRequest('tls_connect', HOST_ENCRYPTION_NONE),
+            'tls_accept'        => getRequest('tls_accept', HOST_ENCRYPTION_NONE),
+            'tls_issuer'        => getRequest('tls_issuer', ''),
+            'tls_subject'       => getRequest('tls_subject', ''),
+            'tls_psk_identity'  => getRequest('tls_psk_identity', ''),
+            'tls_psk'           => getRequest('tls_psk', '')
+        ];
+
+        // sort templates
+        natsort($data['templates']);
+
+        // get groups
+        $data['all_groups'] = API::HostGroup()->get([
+            'output'   => API_OUTPUT_EXTEND,
+            'editable' => true
+        ]);
+        order_result($data['all_groups'], 'name');
+
+        // get proxies
+        $data['proxies'] = DBfetchArray(DBselect('SELECT h.hostid,h.host' . ' FROM hosts h' . ' WHERE h.status IN (' . HOST_STATUS_PROXY_ACTIVE . ',' . HOST_STATUS_PROXY_PASSIVE . ')'));
+        order_result($data['proxies'], 'host');
+
+        // get templates data
+        $data['linkedTemplates'] = null;
+        if (!empty($data['templates'])) {
+            $getLinkedTemplates = API::Template()->get([
+                'templateids' => $data['templates'],
+                'output'      => ['templateid', 'name']
+            ]);
+
+            foreach ($getLinkedTemplates as $getLinkedTemplate) {
+                $data['linkedTemplates'][] = [
+                    'id'   => $getLinkedTemplate['templateid'],
+                    'name' => $getLinkedTemplate['name']
+                ];
+            }
+        }
+
+        $hostView = new CView('configuration.host.massupdate', $data);
+    } elseif (hasRequest('form')) {
+        $data = [
+            // Common & auxiliary
+            'form'                  => getRequest('form', ''),
+            'hostid'                => getRequest('hostid', 0),
+            'clone_hostid'          => getRequest('clone_hostid', 0),
+            'groupid'               => getRequest('groupid', 0),
+            'flags'                 => getRequest('flags', ZBX_FLAG_DISCOVERY_NORMAL),
+
+            // Host
+            'host'                  => getRequest('host', ''),
+            'visiblename'           => getRequest('visiblename', ''),
+            'groups'                => getRequest('groups', []),
+            'newgroup'              => getRequest('newgroup', ''),
+            'interfaces'            => getRequest('interfaces', []),
+            'mainInterfaces'        => getRequest('mainInterfaces', []),
+            'description'           => getRequest('description', ''),
+            'proxy_hostid'          => getRequest('proxy_hostid', 0),
+            'status'                => getRequest('status', HOST_STATUS_NOT_MONITORED),
+
+            // Templates
+            'templates'             => getRequest('templates', []),
+            'clear_templates'       => getRequest('clear_templates', []),
+            'original_templates'    => [],
+            'linked_templates'      => [],
+
+            // IPMI
+            'ipmi_authtype'         => getRequest('ipmi_authtype', IPMI_AUTHTYPE_DEFAULT),
+            'ipmi_privilege'        => getRequest('ipmi_privilege', IPMI_PRIVILEGE_USER),
+            'ipmi_username'         => getRequest('ipmi_username', ''),
+            'ipmi_password'         => getRequest('ipmi_password', ''),
+
+            // Macros
+            'macros'                => $macros,
+            'show_inherited_macros' => getRequest('show_inherited_macros', 0),
+
+            // Host inventory
+            'inventory_mode'        => getRequest('inventory_mode', $config['default_inventory_mode']),
+            'host_inventory'        => getRequest('host_inventory', []),
+            'inventory_items'       => [],
+
+            // Encryption
+            'tls_connect'           => getRequest('tls_connect', HOST_ENCRYPTION_NONE),
+            'tls_accept'            => getRequest('tls_accept', HOST_ENCRYPTION_NONE),
+            'tls_issuer'            => getRequest('tls_issuer', ''),
+            'tls_subject'           => getRequest('tls_subject', ''),
+            'tls_psk_identity'      => getRequest('tls_psk_identity', ''),
+            'tls_psk'               => getRequest('tls_psk', '')
+        ];
+
+        if (!hasRequest('form_refresh')) {
+            if ($data['hostid'] != 0) {
+                $dbHosts = API::Host()->get([
+                    'output'                => [
+                        'hostid',
+                        'proxy_hostid',
+                        'host',
+                        'name',
+                        'status',
+                        'ipmi_authtype',
+                        'ipmi_privilege',
+                        'ipmi_username',
+                        'ipmi_password',
+                        'flags',
+                        'description',
+                        'tls_connect',
+                        'tls_accept',
+                        'tls_issuer',
+                        'tls_subject',
+                        'tls_psk_identity',
+                        'tls_psk'
+                    ],
+                    'selectGroups'          => ['groupid'],
+                    'selectParentTemplates' => ['templateid'],
+                    'selectMacros'          => ['hostmacroid', 'macro', 'value'],
+                    'selectDiscoveryRule'   => ['itemid', 'name'],
+                    'selectInventory'       => true,
+                    'hostids'               => [$data['hostid']]
+                ]);
+                $dbHost = reset($dbHosts);
+
+                $data['flags'] = $dbHost['flags'];
+                if ($data['flags'] == ZBX_FLAG_DISCOVERY_CREATED) {
+                    $data['discoveryRule'] = $dbHost['discoveryRule'];
+                }
+
+                // Host
+                $data['host'] = $dbHost['host'];
+                $data['visiblename'] = $dbHost['name'];
+                $data['groups'] = zbx_objectValues($dbHost['groups'], 'groupid');
+                $data['interfaces'] = API::HostInterface()->get([
+                    'output'      => ['interfaceid', 'main', 'type', 'useip', 'ip', 'dns', 'port', 'bulk'],
+                    'selectItems' => ['type'],
+                    'hostids'     => [$data['hostid']],
+                    'sortfield'   => 'interfaceid'
+                ]);
+                $data['description'] = $dbHost['description'];
+                $data['proxy_hostid'] = $dbHost['proxy_hostid'];
+                $data['status'] = $dbHost['status'];
+
+                // Templates
+                $data['templates'] = zbx_objectValues($dbHost['parentTemplates'], 'templateid');
+                $data['original_templates'] = array_combine($data['templates'], $data['templates']);
+
+                // IPMI
+                $data['ipmi_authtype'] = $dbHost['ipmi_authtype'];
+                $data['ipmi_privilege'] = $dbHost['ipmi_privilege'];
+                $data['ipmi_username'] = $dbHost['ipmi_username'];
+                $data['ipmi_password'] = $dbHost['ipmi_password'];
+
+                // Macros
+                $data['macros'] = $dbHost['macros'];
+
+                // Interfaces
+                foreach ($data['interfaces'] as &$interface) {
+                    if ($data['flags'] == ZBX_FLAG_DISCOVERY_CREATED) {
+                        $interface['locked'] = true;
+                    } else {
+                        // check if interface has items that require specific interface type, if so type cannot be changed
+                        $interface['locked'] = false;
+                        foreach ($interface['items'] as $item) {
+                            $type = itemTypeInterface($item['type']);
+                            if ($type !== false && $type != INTERFACE_TYPE_ANY) {
+                                $interface['locked'] = true;
+                                break;
+                            }
+                        }
+                    }
+
+                    $interface['items'] = (bool) $interface['items'];
+                }
+                unset($interface);
+
+                // Host inventory
+                $data['inventory_mode'] = array_key_exists('inventory_mode', $dbHost['inventory']) ? $dbHost['inventory']['inventory_mode'] : HOST_INVENTORY_DISABLED;
+                $data['host_inventory'] = $dbHost['inventory'];
+                unset($data['host_inventory']['inventory_mode']);
+
+                // Encryption
+                $data['tls_connect'] = $dbHost['tls_connect'];
+                $data['tls_accept'] = $dbHost['tls_accept'];
+                $data['tls_issuer'] = $dbHost['tls_issuer'];
+                $data['tls_subject'] = $dbHost['tls_subject'];
+                $data['tls_psk_identity'] = $dbHost['tls_psk_identity'];
+                $data['tls_psk'] = $dbHost['tls_psk'];
+
+                // display empty visible name if equal to host name
+                if ($data['host'] === $data['visiblename']) {
+                    $data['visiblename'] = '';
+                }
+            } else {
+                $data['status'] = HOST_STATUS_MONITORED;
+            }
+
+            if (!$data['groups'] && $data['groupid'] != 0) {
+                $data['groups'][] = $data['groupid'];
+            }
+        } else {
+            if ($data['hostid'] != 0) {
+                $dbHosts = API::Host()->get([
+                    'output'                => ['flags'],
+                    'selectParentTemplates' => ['templateid'],
+                    'selectDiscoveryRule'   => ['itemid', 'name'],
+                    'hostids'               => [$data['hostid']]
+                ]);
+                $dbHost = reset($dbHosts);
+
+                $data['flags'] = $dbHost['flags'];
+                if ($data['flags'] == ZBX_FLAG_DISCOVERY_CREATED) {
+                    $data['discoveryRule'] = $dbHost['discoveryRule'];
+                }
+
+                $templateids = zbx_objectValues($dbHost['parentTemplates'], 'templateid');
+                $data['original_templates'] = array_combine($templateids, $templateids);
+            }
+
+            foreach ([INTERFACE_TYPE_AGENT, INTERFACE_TYPE_SNMP, INTERFACE_TYPE_JMX, INTERFACE_TYPE_IPMI] as $type) {
+                if (array_key_exists($type, $data['mainInterfaces'])) {
+                    $interfaceid = $data['mainInterfaces'][$type];
+                    $data['interfaces'][$interfaceid]['main'] = '1';
+                }
+            }
+            $data['interfaces'] = array_values($data['interfaces']);
+        }
+
+        if ($data['hostid'] != 0) {
+            // get items that populate host inventory fields
+            $data['inventory_items'] = API::Item()->get([
+                'output'  => ['inventory_link', 'itemid', 'hostid', 'name', 'key_'],
+                'hostids' => [$dbHost['hostid']],
+                'filter'  => ['inventory_link' => array_keys(getHostInventories())]
+            ]);
+            $data['inventory_items'] = zbx_toHash($data['inventory_items'], 'inventory_link');
+            $data['inventory_items'] = CMacrosResolverHelper::resolveItemNames($data['inventory_items']);
+        }
+
+        if ($data['flags'] == ZBX_FLAG_DISCOVERY_CREATED) {
+            if ($data['proxy_hostid'] != 0) {
+                $data['proxies'] = API::Proxy()->get([
+                    'output'       => ['host'],
+                    'proxyids'     => [$data['proxy_hostid']],
+                    'preservekeys' => true
+                ]);
+            } else {
+                $data['proxies'] = [];
+            }
+        } else {
+            $data['proxies'] = API::Proxy()->get([
+                'output'       => ['host'],
+                'preservekeys' => true
+            ]);
+            order_result($proxies, 'host');
+        }
+
+        foreach ($data['proxies'] as &$proxy) {
+            $proxy = $proxy['host'];
+        }
+        unset($proxy);
+
+        if ($data['show_inherited_macros']) {
+            $data['macros'] = mergeInheritedMacros($data['macros'], getInheritedMacros($data['templates']));
+        }
+        $data['macros'] = array_values(order_macros($data['macros'], 'macro'));
+
+        if (!$data['macros'] && $data['flags'] != ZBX_FLAG_DISCOVERY_CREATED) {
+            $macro = ['macro' => '', 'value' => ''];
+            if ($data['show_inherited_macros']) {
+                $macro['type'] = MACRO_TYPE_HOSTMACRO;
+            }
+            $data['macros'][] = $macro;
+        }
+
+        // groups with RW permissions
+        $data['groupsAllowed'] = API::HostGroup()->get([
+            'output'       => [],
+            'editable'     => true,
+            'preservekeys' => true
+        ]);
+
+        // all available groups
+        $data['groupsAll'] = API::HostGroup()->get(['output' => ['groupid', 'name']]);
+        CArrayHelper::sort($data['groupsAll'], ['name']);
+
+        if ($data['templates']) {
+            $data['linked_templates'] = API::Template()->get([
+                'output'      => ['templateid', 'name'],
+                'templateids' => $data['templates']
+            ]);
+            CArrayHelper::sort($data['linked_templates'], ['name']);
+        }
+
+        $hostView = new CView('configuration.host.edit', $data);
+    } else {
+        $sortField = getRequest('sort', CProfile::get('web.' . $page['file'] . '.sort', 'name'));
+        $sortOrder = getRequest('sortorder', CProfile::get('web.' . $page['file'] . '.sortorder', ZBX_SORT_UP));
+
+        CProfile::update('web.' . $page['file'] . '.sort', $sortField, PROFILE_TYPE_STR);
+        CProfile::update('web.' . $page['file'] . '.sortorder', $sortOrder, PROFILE_TYPE_STR);
+
+        // get Hosts
+        $hosts = [];
+        if ($pageFilter->groupsSelected) {
+            $hosts = API::Host()->get([
+                'output'    => ['hostid', $sortField],
+                'groupids'  => ($pageFilter->groupid > 0) ? $pageFilter->groupid : null,
+                'editable'  => true,
+                'sortfield' => $sortField,
+                'limit'     => $config['search_limit'] + 1,
+                'search'    => [
+                    'name' => ($filter['host'] === '') ? null : $filter['host'],
+                    'ip'   => ($filter['ip'] === '') ? null : $filter['ip'],
+                    'dns'  => ($filter['dns'] === '') ? null : $filter['dns']
+                ],
+                'filter'    => [
+                    'port' => ($filter['port'] === '') ? null : $filter['port']
+                ]
+            ]);
+        }
+        order_result($hosts, $sortField, $sortOrder);
+
+        $pagingLine = getPagingLine($hosts, $sortOrder);
+
+        $hosts = API::Host()->get([
+            'hostids'               => zbx_objectValues($hosts, 'hostid'),
+            'output'                => API_OUTPUT_EXTEND,
+            'selectParentTemplates' => ['hostid', 'name'],
+            'selectInterfaces'      => API_OUTPUT_EXTEND,
+            'selectItems'           => API_OUTPUT_COUNT,
+            'selectDiscoveries'     => API_OUTPUT_COUNT,
+            'selectTriggers'        => API_OUTPUT_COUNT,
+            'selectGraphs'          => API_OUTPUT_COUNT,
+            'selectApplications'    => API_OUTPUT_COUNT,
+            'selectHttpTests'       => API_OUTPUT_COUNT,
+            'selectDiscoveryRule'   => ['itemid', 'name'],
+            'selectHostDiscovery'   => ['ts_delete']
+        ]);
+        order_result($hosts, $sortField, $sortOrder);
+
+        // selecting linked templates to templates linked to hosts
+        $templateIds = [];
+        foreach ($hosts as $host) {
+            $templateIds = array_merge($templateIds, zbx_objectValues($host['parentTemplates'], 'templateid'));
+        }
+        $templateIds = array_unique($templateIds);
+
+        $templates = API::Template()->get([
+            'output'                => ['templateid', 'name'],
+            'templateids'           => $templateIds,
+            'selectParentTemplates' => ['hostid', 'name'],
+            'preservekeys'          => true
+        ]);
+
+        // get proxy host IDs that that are not 0
+        $proxyHostIds = [];
+        foreach ($hosts as $host) {
+            if ($host['proxy_hostid']) {
+                $proxyHostIds[$host['proxy_hostid']] = $host['proxy_hostid'];
+            }
+        }
+        $proxies = [];
+        if ($proxyHostIds) {
+            $proxies = API::Proxy()->get([
+                'proxyids'     => $proxyHostIds,
+                'output'       => ['host'],
+                'preservekeys' => true
+            ]);
+        }
+
+        $data = [
+            'pageFilter' => $pageFilter,
+            'hosts'      => $hosts,
+            'paging'     => $pagingLine,
+            'filter'     => $filter,
+            'sortField'  => $sortField,
+            'sortOrder'  => $sortOrder,
+            'groupId'    => $pageFilter->groupid,
+            'config'     => $config,
+            'templates'  => $templates,
+            'proxies'    => $proxies
+        ];
 
-	$hostView = new CView('configuration.host.list', $data);
-}
+        $hostView = new CView('configuration.host.list', $data);
+    }
 
-$hostView->render();
-$hostView->show();
+    $hostView->render();
+    $hostView->show();
 
-require_once dirname(__FILE__).'/include/page_footer.php';
+    require_once dirname(__FILE__) . '/include/page_footer.php';
diff -x graphtree -Naru ./img/icon-sprite.svg graphtree/img/icon-sprite.svg
--- ./img/icon-sprite.svg	2016-02-26 17:45:47.000000000 +0800
+++ graphtree/img/icon-sprite.svg	2016-04-18 18:46:02.000000000 +0800
@@ -1,71 +1,71 @@
-<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" width="114" height="928" viewBox="0 0 114 928" xml:space="preserve" style="enable-background:new 0 0 114 928;overflow:visible">
-  <rect y="903" width="95" height="25" fill="#FFF"/>
-  <rect y="864" width="114" height="30" fill="#FFF"/>
-  <path d="M20.91 19.85l-0.26 0.27 -0.73-0.73c1.49-1.77 1.43-4.4-0.24-6.07 -1.76-1.76-4.61-1.76-6.36 0 -1.76 1.76-1.75 4.6 0 6.36 1.67 1.67 4.31 1.74 6.07 0.24l0.73 0.73 -0.27 0.27L22.94 24l1.06-1.06L20.91 19.85zM14.38 18.62c-1.17-1.17-1.17-3.07 0-4.24 1.17-1.17 3.07-1.17 4.24 0s1.17 3.07 0 4.24C17.45 19.79 15.55 19.79 14.38 18.62z" fill="#3C5563"/>
-  <path d="M18.39 56.56c-0.06-0.13-0.12-0.29-0.18-0.48 -0.06-0.19-0.09-0.4-0.09-0.63 0-0.28 0.07-0.53 0.21-0.76 0.14-0.23 0.32-0.45 0.54-0.66 0.21-0.21 0.45-0.42 0.69-0.63 0.25-0.21 0.48-0.45 0.69-0.73 0.22-0.27 0.39-0.57 0.54-0.9C20.93 51.45 21 51.08 21 50.66c0-0.44-0.08-0.82-0.25-1.15 -0.17-0.33-0.4-0.61-0.69-0.83 -0.29-0.22-0.64-0.39-1.03-0.51C18.63 48.06 18.22 48 17.77 48c-0.96 0-1.88 0.26-2.77 0.78v1.88c0.74-0.72 1.51-1.08 2.32-1.08 0.25 0 0.49 0.03 0.71 0.09 0.22 0.06 0.42 0.15 0.59 0.27 0.17 0.12 0.31 0.28 0.41 0.46 0.1 0.18 0.15 0.4 0.15 0.64 0 0.27-0.07 0.52-0.2 0.75 -0.13 0.23-0.3 0.44-0.5 0.65 -0.2 0.21-0.41 0.42-0.64 0.63 -0.23 0.22-0.45 0.44-0.64 0.68 -0.2 0.23-0.36 0.48-0.5 0.75 -0.13 0.27-0.2 0.57-0.2 0.9 0 0.21 0.02 0.43 0.06 0.64 0.04 0.22 0.08 0.4 0.13 0.53H18.39zM18.41 59.68c0.23-0.21 0.34-0.46 0.34-0.76 0-0.31-0.11-0.56-0.34-0.76 -0.23-0.22-0.51-0.32-0.82-0.32 -0.32 0-0.59 0.11-0.82 0.33 -0.23 0.2-0.34 0.46-0.34 0.76 0 0.3 0.11 0.56 0.34 0.77C17.01 59.9 17.29 60 17.6 60 17.9 60 18.17 59.9 18.41 59.68L18.41 59.68z" fill="#3C5563"/>
-  <path d="M18 128c-2.28 0-4.36 0.8-6 2.14V132h12v-1.86C22.36 128.8 20.28 128 18 128zM18 126c1.66 0 3-1.34 3-3 0-1.66-1.34-3-3-3 -1.66 0-3 1.34-3 3C15 124.66 16.34 126 18 126z" fill="#3C5563"/>
-  <path d="M24.89 193.23l-2.01 2.01 -2.12-2.12 2.01-2.01C22.52 191.05 22.27 191 22 191c-1.66 0-3 1.34-3 3 0 0.27 0.05 0.52 0.11 0.77l-4.34 4.34C14.52 199.05 14.27 199 14 199c-1.66 0-3 1.34-3 3 0 0.27 0.05 0.52 0.11 0.77l2.01-2.01 2.12 2.12 -2.01 2.01C13.48 204.95 13.73 205 14 205c1.66 0 3-1.34 3-3 0-0.27-0.04-0.52-0.11-0.77l4.35-4.34C21.48 196.96 21.73 197 22 197c1.66 0 3-1.34 3-3C25 193.73 24.95 193.48 24.89 193.23z" fill="#FFF"/>
-  <polygon points="25 341 11 341 11 343 25 343 " fill="#FFF"/>
-  <path d="M11 372v2h14v-2H11zM11 379h14v-2H11V379zM11 384h14v-2H11V384z" fill="#FFF"/>
-  <polygon points="25 305 19 305 19 299 17 299 17 305 11 305 11 307 17 307 17 313 19 313 19 307 25 307 " fill="#FFF"/>
-  <path d="M18.7 409.25c0.18 0.22 0.48 0.33 0.9 0.33 0.44 0 0.79-0.16 1.04-0.47 0.25-0.31 0.37-0.66 0.37-1.05 0-0.32-0.1-0.57-0.31-0.77C20.49 407.1 20.21 407 19.85 407c-0.42 0-0.76 0.14-1.03 0.42s-0.4 0.61-0.4 1C18.43 408.76 18.52 409.03 18.7 409.25zM15.35 414.17c0.93-0.61 1.52-0.91 1.79-0.91 0.16 0 0.24 0.09 0.24 0.27 0 0.36-0.29 1.55-0.86 3.58 -0.26 0.91-0.43 1.55-0.51 1.92 -0.08 0.37-0.12 0.7-0.12 0.99 0 0.29 0.06 0.53 0.2 0.71 0.13 0.18 0.33 0.27 0.59 0.27 0.21 0 0.46-0.05 0.74-0.15 0.28-0.1 0.76-0.35 1.42-0.76 0.66-0.41 1.23-0.77 1.71-1.08l0.04-0.12 -0.23-0.38 -0.12-0.01c-0.89 0.59-1.44 0.88-1.64 0.88 -0.07 0-0.14-0.03-0.2-0.1 -0.06-0.07-0.09-0.14-0.09-0.23 0-0.32 0.3-1.5 0.89-3.53 0.34-1.18 0.56-1.98 0.67-2.41 0.11-0.42 0.16-0.77 0.16-1.05 0-0.21-0.06-0.38-0.18-0.52s-0.27-0.2-0.44-0.2c-0.38 0-0.9 0.18-1.58 0.54 -0.67 0.36-1.61 0.97-2.82 1.84L15 413.83l0.2 0.33L15.35 414.17z" fill="#FFF"/>
-  <path d="M22 486c0-1.48-0.81-2.74-2-3.44v6.87C21.19 488.75 22 487.48 22 486z" fill="#768D99"/>
-  <polygon points="11 483.38 11 488.63 13.56 488.63 18 493 18 479 13.56 483.38 " fill="#768D99"/>
-  <path d="M20 479.31v1.58c2.05 0.8 3.5 2.78 3.5 5.11 0 2.33-1.45 4.31-3.5 5.11v1.58C22.89 491.83 25 489.17 25 486 25 482.83 22.89 480.17 20 479.31z" fill="#768D99"/>
-  <path d="M23.5 522c0 0.39-0.05 0.77-0.13 1.14l1.22 1.22C24.85 523.62 25 522.83 25 522c0-3.17-2.11-5.83-5-6.69v1.58C22.05 517.69 23.5 519.67 23.5 522zM20 518.56v1.21l1.98 1.98C21.9 520.39 21.13 519.22 20 518.56zM24.7 527.3l-12.01-12.01 -1.41 1.41 2.48 2.48 -0.2 0.2H11v5.25h2.56L18 529v-5.59l2 2v0.02c0 0 0.01-0.01 0.01-0.01l1.09 1.09c-0.34 0.24-0.71 0.44-1.1 0.6v1.58c0.8-0.24 1.52-0.62 2.17-1.1l1.13 1.13 1.41-1.41 -0.01-0.01L24.7 527.3zM18 515l-1.4 1.38L18 517.77V515z" fill="#768D99"/>
-  <path d="M18 565c1.11 0 2-0.9 2-2h-4C16 564.1 16.9 565 18 565zM22 559.63v-3c0-1.86-1.28-3.41-3-3.86V552c0-0.55-0.45-1-1-1s-1 0.45-1 1v0.77c-1.72 0.45-3 2-3 3.86v3l-2 2h12L22 559.63z" fill="#768D99"/>
-  <path d="M22 592.63c0-1.86-1.28-3.41-3-3.86V588c0-0.55-0.45-1-1-1s-1 0.45-1 1v0.77c-0.01 0-0.02 0.01-0.03 0.01L22 593.81V592.63zM18 601c1.11 0 2-0.9 2-2h-4C16 600.1 16.9 601 18 601zM24.99 599.59l-0.01 0.01 -12.59-12.6L11 588.4l3.16 3.16c-0.09 0.34-0.16 0.69-0.16 1.06v3l-2 2h8.22L23.6 601 25 599.6 24.99 599.59z" fill="#768D99"/>
-  <path d="M24 628c-1.1 0-2 0.9-2 2s0.9 2 2 2 2-0.9 2-2S25.1 628 24 628zM12 628c-1.1 0-2 0.9-2 2s0.9 2 2 2 2-0.9 2-2S13.1 628 12 628zM18 628c-1.1 0-2 0.9-2 2s0.9 2 2 2 2-0.9 2-2S19.1 628 18 628z" fill="#768D99"/>
-  <path d="M24.14 667.97L18 662l-6.14 5.97c-0.48 0.46-0.48 1.22 0 1.68 0.48 0.46 1.25 0.46 1.73 0L18 665.36l4.42 4.3c0.48 0.46 1.25 0.46 1.73 0S24.62 668.44 24.14 667.97z" fill="#768D99"/>
-  <path d="M11.86 700.03L18 706l6.14-5.97c0.48-0.46 0.48-1.22 0-1.68 -0.48-0.46-1.25-0.46-1.73 0L18 702.64l-4.42-4.3c-0.48-0.46-1.25-0.46-1.73 0S11.38 699.56 11.86 700.03z" fill="#768D99"/>
-  <path d="M18 729c-4.97 0-9 4.03-9 9 0 4.97 4.03 9 9 9 4.97 0 9-4.03 9-9C27 733.03 22.97 729 18 729zM19 743h-2v-6h2V743zM19 735h-2v-2h2V735z" fill="#ACBBC2"/>
-  <rect x="17" y="811" width="2" height="2" fill="#ACBBC2"/>
-  <rect x="13" y="811" width="2" height="2" fill="#ACBBC2"/>
-  <rect x="13" y="807" width="2" height="2" fill="#ACBBC2"/>
-  <rect x="21" y="807" width="2" height="2" fill="#ACBBC2"/>
-  <rect x="21" y="811" width="2" height="2" fill="#ACBBC2"/>
-  <rect x="17" y="807" width="2" height="2" fill="#ACBBC2"/>
-  <path d="M19 783v-2h2v2H19zM19 777h2v2h-2V777zM19 773h2v2h-2V773zM19 769h2v2h-2V769zM19 765h2v2h-2V765zM15 781h2v2h-2V781zM15 777h2v2h-2V777zM15 773h2v2h-2V773zM15 769h2v2h-2V769zM15 765h2v2h-2V765z" fill="#ACBBC2"/>
-  <path d="M23.77 841.74c-0.31-0.32-0.81-0.32-1.12 0l-6.51 6.78 -2.79-2.9c-0.31-0.32-0.81-0.32-1.12 0 -0.31 0.32-0.31 0.84 0 1.16l3.35 3.49c0.31 0.32 0.81 0.32 1.12 0l7.07-7.36C24.08 842.58 24.08 842.06 23.77 841.74z" fill="#768D99"/>
-  <path d="M57.02 876.4c0.68-0.51 1.02-1.3 1.02-2.37 0-1.05-0.34-1.84-1.02-2.36 -0.68-0.52-1.71-0.78-3.1-0.78h-4.2v6.29h4.21C55.31 877.18 56.34 876.92 57.02 876.4z" fill="#D40000"/>
-  <path d="M54.27 879.47h-4.56v7.64h4.56c1.53 0 2.66-0.31 3.4-0.94 0.73-0.63 1.1-1.59 1.1-2.89 0-1.3-0.37-2.27-1.1-2.88C56.93 879.78 55.8 879.47 54.27 879.47z" fill="#D40000"/>
-  <path d="M76.08 876.4c0.68-0.51 1.02-1.3 1.02-2.37 0-1.05-0.34-1.84-1.02-2.36 -0.68-0.52-1.71-0.78-3.1-0.78h-4.2v6.29h4.2C74.36 877.18 75.4 876.92 76.08 876.4z" fill="#D40000"/>
-  <polygon points="30.28 881.73 37.99 881.73 34.13 871.35 " fill="#D40000"/>
-  <path d="M0 864v30h114v-30H0zM21.68 889.43H4.55v-2.15l13.27-16.33H4.87v-2.37H21.36v2.15L8.09 887.05h13.59V889.43zM40.79 889.43l-1.91-5.35H29.42l-1.91 5.35h-2.99l8.01-20.85h3.22l8 20.85H40.79zM59.85 887.91c-1.27 1.01-3.09 1.52-5.44 1.52H46.88v-20.85h7.25c2.16 0 3.83 0.45 5 1.34 1.17 0.89 1.76 2.17 1.76 3.81 0 1.27-0.3 2.29-0.9 3.05 -0.6 0.75-1.48 1.22-2.64 1.41 1.4 0.3 2.48 0.92 3.26 1.86 0.77 0.95 1.16 2.13 1.16 3.54C61.76 885.45 61.13 886.89 59.85 887.91zM78.91 887.91c-1.27 1.01-3.09 1.52-5.44 1.52h-7.53v-20.85h7.25c2.16 0 3.83 0.45 5 1.34 1.17 0.89 1.76 2.17 1.76 3.81 0 1.27-0.3 2.29-0.9 3.05 -0.6 0.75-1.48 1.22-2.64 1.41 1.4 0.3 2.48 0.92 3.25 1.86 0.78 0.95 1.16 2.13 1.16 3.54C80.82 885.45 80.18 886.89 78.91 887.91zM88.16 889.43h-2.84v-20.85h2.84V889.43zM106.33 889.43l-5.75-8.73 -5.8 8.73h-3.02l7.32-11.01 -6.49-9.85h3.12l4.94 7.49 4.98-7.49h3.02l-6.5 9.77 7.31 11.09H106.33z" fill="#D40000"/>
-  <path d="M73.33 879.47h-4.55v7.64h4.56c1.53 0 2.66-0.31 3.4-0.94 0.73-0.63 1.1-1.59 1.1-2.89 0-1.3-0.37-2.27-1.1-2.88C75.99 879.78 74.86 879.47 73.33 879.47z" fill="#D40000"/>
-  <polygon points="108.64 868.57 105.63 868.57 100.65 876.06 95.71 868.57 92.59 868.57 99.08 878.42 91.76 889.43 94.77 889.43 100.58 880.7 106.33 889.43 109.45 889.43 102.15 878.34 " fill="#FFF"/>
-  <polygon points="21.36 870.72 21.36 868.57 4.87 868.57 4.87 870.95 17.82 870.95 4.55 887.28 4.55 889.43 21.68 889.43 21.68 887.05 8.09 887.05 " fill="#FFF"/>
-  <path d="M32.53 868.57l-8.01 20.85h2.99l1.91-5.35h9.46l1.91 5.35h2.95l-8-20.85H32.53zM30.28 881.73l3.85-10.38 3.86 10.38H30.28z" fill="#FFF"/>
-  <path d="M57.35 878.18c1.16-0.19 2.04-0.66 2.64-1.41 0.6-0.76 0.9-1.77 0.9-3.05 0-1.65-0.59-2.92-1.76-3.81 -1.17-0.89-2.84-1.34-5-1.34H46.88v20.85h7.53c2.35 0 4.17-0.51 5.44-1.52 1.28-1.02 1.91-2.45 1.91-4.32 0-1.42-0.38-2.6-1.16-3.54C59.83 879.1 58.75 878.48 57.35 878.18zM49.72 870.89h4.21c1.39 0 2.42 0.26 3.1 0.78 0.68 0.52 1.02 1.31 1.02 2.36 0 1.06-0.34 1.85-1.02 2.37 -0.68 0.52-1.71 0.78-3.1 0.78h-4.2V870.89zM57.67 886.17c-0.73 0.63-1.87 0.94-3.39 0.94h-4.56v-7.64h4.56c1.53 0 2.66 0.31 3.4 0.93 0.73 0.62 1.1 1.58 1.1 2.89C58.77 884.57 58.4 885.54 57.67 886.17z" fill="#FFF"/>
-  <rect x="85.33" y="868.57" width="2.84" height="20.85" fill="#FFF"/>
-  <path d="M76.41 878.18c1.16-0.19 2.04-0.66 2.64-1.41 0.6-0.76 0.9-1.77 0.9-3.05 0-1.65-0.59-2.92-1.76-3.81 -1.17-0.89-2.84-1.34-5-1.34h-7.25v20.85h7.53c2.35 0 4.17-0.51 5.44-1.52 1.27-1.02 1.91-2.45 1.91-4.32 0-1.42-0.38-2.6-1.16-3.54C78.89 879.1 77.8 878.48 76.41 878.18zM68.77 870.89h4.2c1.39 0 2.42 0.26 3.1 0.78 0.68 0.52 1.02 1.31 1.02 2.36 0 1.06-0.34 1.85-1.02 2.37 -0.68 0.52-1.71 0.78-3.1 0.78h-4.2V870.89zM76.72 886.17c-0.74 0.63-1.87 0.94-3.4 0.94h-4.55v-7.64h4.56c1.53 0 2.66 0.31 3.4 0.93 0.73 0.62 1.1 1.58 1.1 2.89C77.83 884.57 77.46 885.54 76.72 886.17z" fill="#FFF"/>
-  <path d="M47.52 913.34c0.56-0.44 0.84-1.1 0.84-1.98 0-0.89-0.28-1.54-0.84-1.97 -0.57-0.43-1.44-0.65-2.59-0.65h-3.5v5.25h3.5C46.09 913.99 46.95 913.77 47.52 913.34z" fill="#D40000"/>
-  <path d="M45.23 915.89h-3.79v6.36h3.8c1.28 0 2.22-0.26 2.83-0.77 0.61-0.52 0.92-1.33 0.92-2.4 0-1.09-0.3-1.89-0.92-2.4C47.44 916.14 46.5 915.89 45.23 915.89z" fill="#D40000"/>
-  <path d="M63.4 913.34c0.57-0.44 0.85-1.1 0.85-1.98 0-0.89-0.28-1.54-0.85-1.97 -0.56-0.43-1.43-0.65-2.58-0.65h-3.5v5.25h3.5C61.97 913.99 62.83 913.77 63.4 913.34z" fill="#D40000"/>
-  <polygon points="25.23 917.78 31.66 917.78 28.44 909.13 " fill="#D40000"/>
-  <path d="M0 903v25h95v-25H0zM18.07 924.2H3.79v-1.8l11.06-13.6H4.06v-1.98h13.74v1.8l-11.05 13.6h11.32V924.2zM33.99 924.2l-1.59-4.46h-7.89l-1.59 4.46h-2.49l6.68-17.38h2.68l6.66 17.38H33.99zM49.88 922.92c-1.06 0.85-2.58 1.28-4.53 1.28h-6.27v-17.38h6.04c1.8 0 3.19 0.37 4.17 1.12 0.97 0.74 1.46 1.8 1.46 3.18 0 1.05-0.25 1.9-0.75 2.53 -0.5 0.63-1.23 1.02-2.2 1.19 1.16 0.24 2.06 0.75 2.71 1.55 0.64 0.78 0.96 1.77 0.96 2.95C51.47 920.87 50.94 922.07 49.88 922.92zM65.75 922.92c-1.06 0.85-2.57 1.28-4.53 1.28h-6.28v-17.38h6.04c1.8 0 3.19 0.37 4.17 1.12 0.97 0.74 1.47 1.8 1.47 3.18 0 1.05-0.25 1.9-0.75 2.53 -0.5 0.63-1.23 1.02-2.21 1.19 1.16 0.24 2.07 0.75 2.71 1.55 0.65 0.78 0.97 1.77 0.97 2.95C67.35 920.87 66.82 922.07 65.75 922.92zM73.47 924.2h-2.37v-17.38h2.37V924.2zM88.61 924.2l-4.79-7.28 -4.84 7.28h-2.51l6.1-9.18 -5.4-8.2h2.6l4.11 6.24 4.15-6.24h2.51l-5.41 8.14 6.09 9.25H88.61z" fill="#D40000"/>
-  <path d="M61.11 915.89h-3.8v6.36h3.8c1.27 0 2.21-0.26 2.83-0.77 0.61-0.52 0.92-1.33 0.92-2.4 0-1.09-0.31-1.89-0.92-2.4C63.32 916.14 62.38 915.89 61.11 915.89z" fill="#D40000"/>
-  <polygon points="90.53 906.81 88.02 906.81 83.87 913.06 79.76 906.81 77.16 906.81 82.56 915.01 76.47 924.2 78.97 924.2 83.82 916.92 88.61 924.2 91.21 924.2 85.12 914.95 " fill="#FFF"/>
-  <polygon points="17.8 908.61 17.8 906.81 4.06 906.81 4.06 908.8 14.85 908.8 3.79 922.4 3.79 924.2 18.07 924.2 18.07 922.21 6.75 922.21 " fill="#FFF"/>
-  <path d="M27.11 906.81l-6.68 17.38h2.49l1.59-4.46H32.4l1.59 4.46h2.46l-6.66-17.38H27.11zM25.23 917.78l3.21-8.65 3.21 8.65H25.23z" fill="#FFF"/>
-  <path d="M47.8 914.83c0.96-0.17 1.7-0.56 2.2-1.19 0.5-0.63 0.75-1.47 0.75-2.53 0-1.38-0.48-2.44-1.46-3.18 -0.98-0.75-2.37-1.12-4.17-1.12h-6.04v17.38h6.28c1.96 0 3.48-0.43 4.53-1.28 1.06-0.85 1.59-2.05 1.59-3.59 0-1.17-0.32-2.17-0.96-2.95C49.86 915.58 48.96 915.07 47.8 914.83zM41.43 908.74h3.5c1.15 0 2.02 0.22 2.59 0.65 0.56 0.43 0.84 1.08 0.84 1.97 0 0.88-0.28 1.54-0.84 1.98 -0.57 0.43-1.44 0.65-2.59 0.65h-3.5V908.74zM48.06 921.47c-0.61 0.52-1.55 0.78-2.83 0.78h-3.79v-6.36h3.8c1.28 0 2.22 0.26 2.83 0.78 0.61 0.51 0.92 1.31 0.92 2.4C48.97 920.14 48.67 920.95 48.06 921.47z" fill="#FFF"/>
-  <rect x="71.1" y="906.81" width="2.37" height="17.38" fill="#FFF"/>
-  <path d="M63.67 914.83c0.97-0.17 1.71-0.56 2.21-1.19 0.5-0.63 0.75-1.47 0.75-2.53 0-1.38-0.49-2.44-1.47-3.18 -0.98-0.75-2.37-1.12-4.17-1.12h-6.04v17.38h6.28c1.96 0 3.47-0.43 4.53-1.28 1.07-0.85 1.6-2.05 1.6-3.59 0-1.17-0.32-2.17-0.97-2.95C65.74 915.58 64.83 915.07 63.67 914.83zM57.31 908.74h3.5c1.16 0 2.02 0.22 2.58 0.65 0.57 0.43 0.85 1.08 0.85 1.97 0 0.88-0.28 1.54-0.85 1.98 -0.56 0.43-1.43 0.65-2.58 0.65h-3.5V908.74zM63.94 921.47c-0.62 0.52-1.56 0.78-2.83 0.78h-3.8v-6.36h3.8c1.27 0 2.21 0.26 2.83 0.78 0.61 0.51 0.92 1.31 0.92 2.4C64.86 920.14 64.55 920.95 63.94 921.47z" fill="#FFF"/>
-  <path d="M23 84H13C12.45 84 12 84.45 12 85v10c0 0.55 0.45 1 1 1h10c0.55 0 1-0.45 1-1V85C24 84.45 23.55 84 23 84zM21.02 93.82h-6.03v-1.23l3.54-4.81h-3.33V86.18h5.7v1.35l-3.44 4.69h3.57V93.82z" fill="#3C5563"/>
-  <polygon points="25 227 19.63 227 21.63 229.01 19 231.64 20.36 233 22.99 230.37 25 232.37 " fill="#FFF"/>
-  <polygon points="15.64 235 13.01 237.63 11 235.63 11 241 16.37 241 14.37 239 17 236.36 " fill="#FFF"/>
-  <polygon points="25 264.36 23.64 263 21.01 265.63 19 263.63 19 269 24.37 269 22.37 267 " fill="#FFF"/>
-  <polygon points="13.63 273.01 11 275.64 12.36 277 14.99 274.37 17 276.37 17 271 11.63 271 " fill="#FFF"/>
-  <path d="M22.35 158.06l-1.06 1.06c0.74 0.79 1.21 1.82 1.21 2.98 0 2.44-2.02 4.42-4.5 4.42s-4.5-1.98-4.5-4.42c0-1.16 0.47-2.19 1.21-2.98l-1.06-1.06c-1.02 1.05-1.65 2.47-1.65 4.04 0 3.26 2.69 5.9 6 5.9 3.31 0 6-2.64 6-5.9C24 160.54 23.37 159.12 22.35 158.06zM19 156h-2v6h2V156z" fill="#3C5563"/>
-  <path d="M96.39 56.56c-0.06-0.13-0.12-0.29-0.18-0.48 -0.06-0.19-0.09-0.4-0.09-0.63 0-0.28 0.07-0.53 0.21-0.76 0.14-0.23 0.32-0.45 0.54-0.66 0.21-0.21 0.45-0.42 0.69-0.63 0.25-0.21 0.48-0.45 0.69-0.73 0.22-0.27 0.39-0.57 0.54-0.9C98.93 51.45 99 51.08 99 50.66c0-0.44-0.08-0.82-0.25-1.15 -0.17-0.33-0.4-0.61-0.69-0.83 -0.29-0.22-0.64-0.39-1.03-0.51C96.63 48.06 96.22 48 95.78 48c-0.96 0-1.88 0.26-2.77 0.78v1.88c0.74-0.72 1.51-1.08 2.32-1.08 0.25 0 0.49 0.03 0.71 0.09 0.22 0.06 0.42 0.15 0.59 0.27 0.17 0.12 0.31 0.28 0.41 0.46 0.1 0.18 0.15 0.4 0.15 0.64 0 0.27-0.07 0.52-0.2 0.75 -0.13 0.23-0.3 0.44-0.5 0.65 -0.2 0.21-0.41 0.42-0.64 0.63 -0.23 0.22-0.45 0.44-0.64 0.68 -0.2 0.23-0.36 0.48-0.5 0.75 -0.13 0.27-0.2 0.57-0.2 0.9 0 0.21 0.02 0.43 0.06 0.64 0.04 0.22 0.08 0.4 0.13 0.53H96.39zM96.41 59.68c0.23-0.21 0.34-0.46 0.34-0.76 0-0.31-0.11-0.56-0.34-0.76 -0.23-0.22-0.51-0.32-0.82-0.32 -0.32 0-0.59 0.11-0.82 0.33 -0.23 0.2-0.34 0.46-0.34 0.76 0 0.3 0.11 0.56 0.34 0.77C95.01 59.9 95.29 60 95.6 60 95.9 60 96.17 59.9 96.41 59.68L96.41 59.68z" fill="#FFF"/>
-  <path d="M96 128c-2.28 0-4.36 0.8-6 2.14V132h12v-1.86C100.36 128.8 98.28 128 96 128zM96 126c1.66 0 3-1.34 3-3 0-1.66-1.34-3-3-3 -1.66 0-3 1.34-3 3C93 124.66 94.34 126 96 126z" fill="#FFF"/>
-  <path d="M101 84H91C90.45 84 90 84.45 90 85v10c0 0.55 0.45 1 1 1h10c0.55 0 1-0.45 1-1V85C102 84.45 101.55 84 101 84zM99.02 93.82h-6.03v-1.23l3.54-4.81h-3.33V86.18h5.7v1.35l-3.44 4.69h3.57V93.82z" fill="#FFF"/>
-  <path d="M100.35 158.06l-1.06 1.06c0.74 0.79 1.21 1.82 1.21 2.98 0 2.44-2.02 4.42-4.5 4.42s-4.5-1.98-4.5-4.42c0-1.16 0.47-2.19 1.21-2.98l-1.06-1.06c-1.02 1.05-1.65 2.47-1.65 4.04 0 3.26 2.69 5.9 6 5.9 3.31 0 6-2.64 6-5.9C102 160.54 101.37 159.12 100.35 158.06zM97 156h-2v6h2V156z" fill="#FFF"/>
-  <path d="M22.76 452.13c-0.82 1.83-2.62 3.13-4.76 3.13 -2.9 0-5.25-2.35-5.25-5.25 0-2.9 2.35-5.25 5.25-5.25 1.45 0 2.75 0.6 3.69 1.56l0 0 -2.82 2.82L25 449.13V443l-2.06 2.06c0 0-0.01 0.01-0.02 0.01C21.66 443.8 19.93 443 18 443c-3.86 0-7 3.14-7 7 0 3.87 3.14 7 7 7 3.12 0 5.74-2.05 6.64-4.87H22.76z" fill="#FFF"/>
-  <path d="M61.5 837h-15c-0.83 0-1.5 0.67-1.5 1.5v15c0 0.83 0.67 1.5 1.5 1.5h15c0.83 0 1.5-0.67 1.5-1.5v-15C63 837.67 62.33 837 61.5 837zM61 853H47v-12h14V853zM51 844h-2v2h2V844zM59 844h-2v2h2V844zM55 844h-2v2h2V844zM55 848h-2v2h2V848zM51 848h-2v2h2V848zM59 848h-2v2h2V848z" fill="#ACBBC2"/>
-  <path d="M58.79 807.22l-2.19 2.19 -2.01-2.01 2.19-2.18c-1.21-0.45-2.62-0.19-3.59 0.78 -1.02 1.02-1.25 2.52-0.71 3.77L49 813.23 50.77 815l3.48-3.48c1.25 0.54 2.74 0.3 3.76-0.71C58.98 809.84 59.23 808.43 58.79 807.22z" fill="#F3A914"/>
-  <path d="M55 777v-5.21c0.88-0.39 1.5-1.26 1.5-2.29 0-1.38-1.12-2.5-2.5-2.5 -1.38 0-2.5 1.12-2.5 2.5 0 1.02 0.62 1.9 1.5 2.29V777h-3l4 4 4-4H55z" fill="#768D99"/>
-  <path d="M53 735v5.21c-0.88 0.39-1.5 1.26-1.5 2.29 0 1.38 1.12 2.5 2.5 2.5 1.38 0 2.5-1.12 2.5-2.5 0-1.02-0.62-1.9-1.5-2.29V735h3l-4-4 -4 4H53z" fill="#768D99"/>
-  <path d="M61.68 695.71c-0.42-0.45-1.11-0.45-1.53 0l-8.45 8.91 -3.84-4.05c-0.42-0.45-1.11-0.45-1.53 0 -0.42 0.45-0.43 1.17 0 1.62l4.6 4.86c0.21 0.22 0.49 0.33 0.77 0.33 0.28 0 0.56-0.11 0.77-0.33l9.21-9.71C62.11 696.88 62.11 696.16 61.68 695.71z" fill="#768D99"/>
-  <path d="M98.91 19.85l-0.26 0.27 -0.73-0.73c1.49-1.77 1.43-4.4-0.24-6.07 -1.76-1.76-4.61-1.76-6.36 0 -1.76 1.76-1.75 4.6 0 6.36 1.67 1.67 4.31 1.74 6.07 0.24l0.73 0.73 -0.27 0.27L100.94 24l1.06-1.06L98.91 19.85zM92.38 18.62c-1.17-1.17-1.17-3.07 0-4.24 1.17-1.17 3.07-1.17 4.24 0s1.17 3.07 0 4.24C95.45 19.79 93.55 19.79 92.38 18.62z" fill="#FFF"/>
-</svg>
+<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" width="114" height="928" viewBox="0 0 114 928" xml:space="preserve" style="enable-background:new 0 0 114 928;overflow:visible">
+  <rect y="903" width="95" height="25" fill="#FFF"/>
+  <rect y="864" width="114" height="30" fill="#FFF"/>
+  <path d="M20.91 19.85l-0.26 0.27 -0.73-0.73c1.49-1.77 1.43-4.4-0.24-6.07 -1.76-1.76-4.61-1.76-6.36 0 -1.76 1.76-1.75 4.6 0 6.36 1.67 1.67 4.31 1.74 6.07 0.24l0.73 0.73 -0.27 0.27L22.94 24l1.06-1.06L20.91 19.85zM14.38 18.62c-1.17-1.17-1.17-3.07 0-4.24 1.17-1.17 3.07-1.17 4.24 0s1.17 3.07 0 4.24C17.45 19.79 15.55 19.79 14.38 18.62z" fill="#3C5563"/>
+  <path d="M18.39 56.56c-0.06-0.13-0.12-0.29-0.18-0.48 -0.06-0.19-0.09-0.4-0.09-0.63 0-0.28 0.07-0.53 0.21-0.76 0.14-0.23 0.32-0.45 0.54-0.66 0.21-0.21 0.45-0.42 0.69-0.63 0.25-0.21 0.48-0.45 0.69-0.73 0.22-0.27 0.39-0.57 0.54-0.9C20.93 51.45 21 51.08 21 50.66c0-0.44-0.08-0.82-0.25-1.15 -0.17-0.33-0.4-0.61-0.69-0.83 -0.29-0.22-0.64-0.39-1.03-0.51C18.63 48.06 18.22 48 17.77 48c-0.96 0-1.88 0.26-2.77 0.78v1.88c0.74-0.72 1.51-1.08 2.32-1.08 0.25 0 0.49 0.03 0.71 0.09 0.22 0.06 0.42 0.15 0.59 0.27 0.17 0.12 0.31 0.28 0.41 0.46 0.1 0.18 0.15 0.4 0.15 0.64 0 0.27-0.07 0.52-0.2 0.75 -0.13 0.23-0.3 0.44-0.5 0.65 -0.2 0.21-0.41 0.42-0.64 0.63 -0.23 0.22-0.45 0.44-0.64 0.68 -0.2 0.23-0.36 0.48-0.5 0.75 -0.13 0.27-0.2 0.57-0.2 0.9 0 0.21 0.02 0.43 0.06 0.64 0.04 0.22 0.08 0.4 0.13 0.53H18.39zM18.41 59.68c0.23-0.21 0.34-0.46 0.34-0.76 0-0.31-0.11-0.56-0.34-0.76 -0.23-0.22-0.51-0.32-0.82-0.32 -0.32 0-0.59 0.11-0.82 0.33 -0.23 0.2-0.34 0.46-0.34 0.76 0 0.3 0.11 0.56 0.34 0.77C17.01 59.9 17.29 60 17.6 60 17.9 60 18.17 59.9 18.41 59.68L18.41 59.68z" fill="#3C5563"/>
+  <path d="M18 128c-2.28 0-4.36 0.8-6 2.14V132h12v-1.86C22.36 128.8 20.28 128 18 128zM18 126c1.66 0 3-1.34 3-3 0-1.66-1.34-3-3-3 -1.66 0-3 1.34-3 3C15 124.66 16.34 126 18 126z" fill="#3C5563"/>
+  <path d="M24.89 193.23l-2.01 2.01 -2.12-2.12 2.01-2.01C22.52 191.05 22.27 191 22 191c-1.66 0-3 1.34-3 3 0 0.27 0.05 0.52 0.11 0.77l-4.34 4.34C14.52 199.05 14.27 199 14 199c-1.66 0-3 1.34-3 3 0 0.27 0.05 0.52 0.11 0.77l2.01-2.01 2.12 2.12 -2.01 2.01C13.48 204.95 13.73 205 14 205c1.66 0 3-1.34 3-3 0-0.27-0.04-0.52-0.11-0.77l4.35-4.34C21.48 196.96 21.73 197 22 197c1.66 0 3-1.34 3-3C25 193.73 24.95 193.48 24.89 193.23z" fill="#FFF"/>
+  <polygon points="25 341 11 341 11 343 25 343 " fill="#FFF"/>
+  <path d="M11 372v2h14v-2H11zM11 379h14v-2H11V379zM11 384h14v-2H11V384z" fill="#FFF"/>
+  <polygon points="25 305 19 305 19 299 17 299 17 305 11 305 11 307 17 307 17 313 19 313 19 307 25 307 " fill="#FFF"/>
+  <path d="M18.7 409.25c0.18 0.22 0.48 0.33 0.9 0.33 0.44 0 0.79-0.16 1.04-0.47 0.25-0.31 0.37-0.66 0.37-1.05 0-0.32-0.1-0.57-0.31-0.77C20.49 407.1 20.21 407 19.85 407c-0.42 0-0.76 0.14-1.03 0.42s-0.4 0.61-0.4 1C18.43 408.76 18.52 409.03 18.7 409.25zM15.35 414.17c0.93-0.61 1.52-0.91 1.79-0.91 0.16 0 0.24 0.09 0.24 0.27 0 0.36-0.29 1.55-0.86 3.58 -0.26 0.91-0.43 1.55-0.51 1.92 -0.08 0.37-0.12 0.7-0.12 0.99 0 0.29 0.06 0.53 0.2 0.71 0.13 0.18 0.33 0.27 0.59 0.27 0.21 0 0.46-0.05 0.74-0.15 0.28-0.1 0.76-0.35 1.42-0.76 0.66-0.41 1.23-0.77 1.71-1.08l0.04-0.12 -0.23-0.38 -0.12-0.01c-0.89 0.59-1.44 0.88-1.64 0.88 -0.07 0-0.14-0.03-0.2-0.1 -0.06-0.07-0.09-0.14-0.09-0.23 0-0.32 0.3-1.5 0.89-3.53 0.34-1.18 0.56-1.98 0.67-2.41 0.11-0.42 0.16-0.77 0.16-1.05 0-0.21-0.06-0.38-0.18-0.52s-0.27-0.2-0.44-0.2c-0.38 0-0.9 0.18-1.58 0.54 -0.67 0.36-1.61 0.97-2.82 1.84L15 413.83l0.2 0.33L15.35 414.17z" fill="#FFF"/>
+  <path d="M22 486c0-1.48-0.81-2.74-2-3.44v6.87C21.19 488.75 22 487.48 22 486z" fill="#768D99"/>
+  <polygon points="11 483.38 11 488.63 13.56 488.63 18 493 18 479 13.56 483.38 " fill="#768D99"/>
+  <path d="M20 479.31v1.58c2.05 0.8 3.5 2.78 3.5 5.11 0 2.33-1.45 4.31-3.5 5.11v1.58C22.89 491.83 25 489.17 25 486 25 482.83 22.89 480.17 20 479.31z" fill="#768D99"/>
+  <path d="M23.5 522c0 0.39-0.05 0.77-0.13 1.14l1.22 1.22C24.85 523.62 25 522.83 25 522c0-3.17-2.11-5.83-5-6.69v1.58C22.05 517.69 23.5 519.67 23.5 522zM20 518.56v1.21l1.98 1.98C21.9 520.39 21.13 519.22 20 518.56zM24.7 527.3l-12.01-12.01 -1.41 1.41 2.48 2.48 -0.2 0.2H11v5.25h2.56L18 529v-5.59l2 2v0.02c0 0 0.01-0.01 0.01-0.01l1.09 1.09c-0.34 0.24-0.71 0.44-1.1 0.6v1.58c0.8-0.24 1.52-0.62 2.17-1.1l1.13 1.13 1.41-1.41 -0.01-0.01L24.7 527.3zM18 515l-1.4 1.38L18 517.77V515z" fill="#768D99"/>
+  <path d="M18 565c1.11 0 2-0.9 2-2h-4C16 564.1 16.9 565 18 565zM22 559.63v-3c0-1.86-1.28-3.41-3-3.86V552c0-0.55-0.45-1-1-1s-1 0.45-1 1v0.77c-1.72 0.45-3 2-3 3.86v3l-2 2h12L22 559.63z" fill="#768D99"/>
+  <path d="M22 592.63c0-1.86-1.28-3.41-3-3.86V588c0-0.55-0.45-1-1-1s-1 0.45-1 1v0.77c-0.01 0-0.02 0.01-0.03 0.01L22 593.81V592.63zM18 601c1.11 0 2-0.9 2-2h-4C16 600.1 16.9 601 18 601zM24.99 599.59l-0.01 0.01 -12.59-12.6L11 588.4l3.16 3.16c-0.09 0.34-0.16 0.69-0.16 1.06v3l-2 2h8.22L23.6 601 25 599.6 24.99 599.59z" fill="#768D99"/>
+  <path d="M24 628c-1.1 0-2 0.9-2 2s0.9 2 2 2 2-0.9 2-2S25.1 628 24 628zM12 628c-1.1 0-2 0.9-2 2s0.9 2 2 2 2-0.9 2-2S13.1 628 12 628zM18 628c-1.1 0-2 0.9-2 2s0.9 2 2 2 2-0.9 2-2S19.1 628 18 628z" fill="#768D99"/>
+  <path d="M24.14 667.97L18 662l-6.14 5.97c-0.48 0.46-0.48 1.22 0 1.68 0.48 0.46 1.25 0.46 1.73 0L18 665.36l4.42 4.3c0.48 0.46 1.25 0.46 1.73 0S24.62 668.44 24.14 667.97z" fill="#768D99"/>
+  <path d="M11.86 700.03L18 706l6.14-5.97c0.48-0.46 0.48-1.22 0-1.68 -0.48-0.46-1.25-0.46-1.73 0L18 702.64l-4.42-4.3c-0.48-0.46-1.25-0.46-1.73 0S11.38 699.56 11.86 700.03z" fill="#768D99"/>
+  <path d="M18 729c-4.97 0-9 4.03-9 9 0 4.97 4.03 9 9 9 4.97 0 9-4.03 9-9C27 733.03 22.97 729 18 729zM19 743h-2v-6h2V743zM19 735h-2v-2h2V735z" fill="#ACBBC2"/>
+  <rect x="17" y="811" width="2" height="2" fill="#ACBBC2"/>
+  <rect x="13" y="811" width="2" height="2" fill="#ACBBC2"/>
+  <rect x="13" y="807" width="2" height="2" fill="#ACBBC2"/>
+  <rect x="21" y="807" width="2" height="2" fill="#ACBBC2"/>
+  <rect x="21" y="811" width="2" height="2" fill="#ACBBC2"/>
+  <rect x="17" y="807" width="2" height="2" fill="#ACBBC2"/>
+  <path d="M19 783v-2h2v2H19zM19 777h2v2h-2V777zM19 773h2v2h-2V773zM19 769h2v2h-2V769zM19 765h2v2h-2V765zM15 781h2v2h-2V781zM15 777h2v2h-2V777zM15 773h2v2h-2V773zM15 769h2v2h-2V769zM15 765h2v2h-2V765z" fill="#ACBBC2"/>
+  <path d="M23.77 841.74c-0.31-0.32-0.81-0.32-1.12 0l-6.51 6.78 -2.79-2.9c-0.31-0.32-0.81-0.32-1.12 0 -0.31 0.32-0.31 0.84 0 1.16l3.35 3.49c0.31 0.32 0.81 0.32 1.12 0l7.07-7.36C24.08 842.58 24.08 842.06 23.77 841.74z" fill="#768D99"/>
+  <path d="M57.02 876.4c0.68-0.51 1.02-1.3 1.02-2.37 0-1.05-0.34-1.84-1.02-2.36 -0.68-0.52-1.71-0.78-3.1-0.78h-4.2v6.29h4.21C55.31 877.18 56.34 876.92 57.02 876.4z" fill="#D40000"/>
+  <path d="M54.27 879.47h-4.56v7.64h4.56c1.53 0 2.66-0.31 3.4-0.94 0.73-0.63 1.1-1.59 1.1-2.89 0-1.3-0.37-2.27-1.1-2.88C56.93 879.78 55.8 879.47 54.27 879.47z" fill="#D40000"/>
+  <path d="M76.08 876.4c0.68-0.51 1.02-1.3 1.02-2.37 0-1.05-0.34-1.84-1.02-2.36 -0.68-0.52-1.71-0.78-3.1-0.78h-4.2v6.29h4.2C74.36 877.18 75.4 876.92 76.08 876.4z" fill="#D40000"/>
+  <polygon points="30.28 881.73 37.99 881.73 34.13 871.35 " fill="#D40000"/>
+  <path d="M0 864v30h114v-30H0zM21.68 889.43H4.55v-2.15l13.27-16.33H4.87v-2.37H21.36v2.15L8.09 887.05h13.59V889.43zM40.79 889.43l-1.91-5.35H29.42l-1.91 5.35h-2.99l8.01-20.85h3.22l8 20.85H40.79zM59.85 887.91c-1.27 1.01-3.09 1.52-5.44 1.52H46.88v-20.85h7.25c2.16 0 3.83 0.45 5 1.34 1.17 0.89 1.76 2.17 1.76 3.81 0 1.27-0.3 2.29-0.9 3.05 -0.6 0.75-1.48 1.22-2.64 1.41 1.4 0.3 2.48 0.92 3.26 1.86 0.77 0.95 1.16 2.13 1.16 3.54C61.76 885.45 61.13 886.89 59.85 887.91zM78.91 887.91c-1.27 1.01-3.09 1.52-5.44 1.52h-7.53v-20.85h7.25c2.16 0 3.83 0.45 5 1.34 1.17 0.89 1.76 2.17 1.76 3.81 0 1.27-0.3 2.29-0.9 3.05 -0.6 0.75-1.48 1.22-2.64 1.41 1.4 0.3 2.48 0.92 3.25 1.86 0.78 0.95 1.16 2.13 1.16 3.54C80.82 885.45 80.18 886.89 78.91 887.91zM88.16 889.43h-2.84v-20.85h2.84V889.43zM106.33 889.43l-5.75-8.73 -5.8 8.73h-3.02l7.32-11.01 -6.49-9.85h3.12l4.94 7.49 4.98-7.49h3.02l-6.5 9.77 7.31 11.09H106.33z" fill="#D40000"/>
+  <path d="M73.33 879.47h-4.55v7.64h4.56c1.53 0 2.66-0.31 3.4-0.94 0.73-0.63 1.1-1.59 1.1-2.89 0-1.3-0.37-2.27-1.1-2.88C75.99 879.78 74.86 879.47 73.33 879.47z" fill="#D40000"/>
+  <polygon points="108.64 868.57 105.63 868.57 100.65 876.06 95.71 868.57 92.59 868.57 99.08 878.42 91.76 889.43 94.77 889.43 100.58 880.7 106.33 889.43 109.45 889.43 102.15 878.34 " fill="#FFF"/>
+  <polygon points="21.36 870.72 21.36 868.57 4.87 868.57 4.87 870.95 17.82 870.95 4.55 887.28 4.55 889.43 21.68 889.43 21.68 887.05 8.09 887.05 " fill="#FFF"/>
+  <path d="M32.53 868.57l-8.01 20.85h2.99l1.91-5.35h9.46l1.91 5.35h2.95l-8-20.85H32.53zM30.28 881.73l3.85-10.38 3.86 10.38H30.28z" fill="#FFF"/>
+  <path d="M57.35 878.18c1.16-0.19 2.04-0.66 2.64-1.41 0.6-0.76 0.9-1.77 0.9-3.05 0-1.65-0.59-2.92-1.76-3.81 -1.17-0.89-2.84-1.34-5-1.34H46.88v20.85h7.53c2.35 0 4.17-0.51 5.44-1.52 1.28-1.02 1.91-2.45 1.91-4.32 0-1.42-0.38-2.6-1.16-3.54C59.83 879.1 58.75 878.48 57.35 878.18zM49.72 870.89h4.21c1.39 0 2.42 0.26 3.1 0.78 0.68 0.52 1.02 1.31 1.02 2.36 0 1.06-0.34 1.85-1.02 2.37 -0.68 0.52-1.71 0.78-3.1 0.78h-4.2V870.89zM57.67 886.17c-0.73 0.63-1.87 0.94-3.39 0.94h-4.56v-7.64h4.56c1.53 0 2.66 0.31 3.4 0.93 0.73 0.62 1.1 1.58 1.1 2.89C58.77 884.57 58.4 885.54 57.67 886.17z" fill="#FFF"/>
+  <rect x="85.33" y="868.57" width="2.84" height="20.85" fill="#FFF"/>
+  <path d="M76.41 878.18c1.16-0.19 2.04-0.66 2.64-1.41 0.6-0.76 0.9-1.77 0.9-3.05 0-1.65-0.59-2.92-1.76-3.81 -1.17-0.89-2.84-1.34-5-1.34h-7.25v20.85h7.53c2.35 0 4.17-0.51 5.44-1.52 1.27-1.02 1.91-2.45 1.91-4.32 0-1.42-0.38-2.6-1.16-3.54C78.89 879.1 77.8 878.48 76.41 878.18zM68.77 870.89h4.2c1.39 0 2.42 0.26 3.1 0.78 0.68 0.52 1.02 1.31 1.02 2.36 0 1.06-0.34 1.85-1.02 2.37 -0.68 0.52-1.71 0.78-3.1 0.78h-4.2V870.89zM76.72 886.17c-0.74 0.63-1.87 0.94-3.4 0.94h-4.55v-7.64h4.56c1.53 0 2.66 0.31 3.4 0.93 0.73 0.62 1.1 1.58 1.1 2.89C77.83 884.57 77.46 885.54 76.72 886.17z" fill="#FFF"/>
+  <path d="M47.52 913.34c0.56-0.44 0.84-1.1 0.84-1.98 0-0.89-0.28-1.54-0.84-1.97 -0.57-0.43-1.44-0.65-2.59-0.65h-3.5v5.25h3.5C46.09 913.99 46.95 913.77 47.52 913.34z" fill="#D40000"/>
+  <path d="M45.23 915.89h-3.79v6.36h3.8c1.28 0 2.22-0.26 2.83-0.77 0.61-0.52 0.92-1.33 0.92-2.4 0-1.09-0.3-1.89-0.92-2.4C47.44 916.14 46.5 915.89 45.23 915.89z" fill="#D40000"/>
+  <path d="M63.4 913.34c0.57-0.44 0.85-1.1 0.85-1.98 0-0.89-0.28-1.54-0.85-1.97 -0.56-0.43-1.43-0.65-2.58-0.65h-3.5v5.25h3.5C61.97 913.99 62.83 913.77 63.4 913.34z" fill="#D40000"/>
+  <polygon points="25.23 917.78 31.66 917.78 28.44 909.13 " fill="#D40000"/>
+  <path d="M0 903v25h95v-25H0zM18.07 924.2H3.79v-1.8l11.06-13.6H4.06v-1.98h13.74v1.8l-11.05 13.6h11.32V924.2zM33.99 924.2l-1.59-4.46h-7.89l-1.59 4.46h-2.49l6.68-17.38h2.68l6.66 17.38H33.99zM49.88 922.92c-1.06 0.85-2.58 1.28-4.53 1.28h-6.27v-17.38h6.04c1.8 0 3.19 0.37 4.17 1.12 0.97 0.74 1.46 1.8 1.46 3.18 0 1.05-0.25 1.9-0.75 2.53 -0.5 0.63-1.23 1.02-2.2 1.19 1.16 0.24 2.06 0.75 2.71 1.55 0.64 0.78 0.96 1.77 0.96 2.95C51.47 920.87 50.94 922.07 49.88 922.92zM65.75 922.92c-1.06 0.85-2.57 1.28-4.53 1.28h-6.28v-17.38h6.04c1.8 0 3.19 0.37 4.17 1.12 0.97 0.74 1.47 1.8 1.47 3.18 0 1.05-0.25 1.9-0.75 2.53 -0.5 0.63-1.23 1.02-2.21 1.19 1.16 0.24 2.07 0.75 2.71 1.55 0.65 0.78 0.97 1.77 0.97 2.95C67.35 920.87 66.82 922.07 65.75 922.92zM73.47 924.2h-2.37v-17.38h2.37V924.2zM88.61 924.2l-4.79-7.28 -4.84 7.28h-2.51l6.1-9.18 -5.4-8.2h2.6l4.11 6.24 4.15-6.24h2.51l-5.41 8.14 6.09 9.25H88.61z" fill="#D40000"/>
+  <path d="M61.11 915.89h-3.8v6.36h3.8c1.27 0 2.21-0.26 2.83-0.77 0.61-0.52 0.92-1.33 0.92-2.4 0-1.09-0.31-1.89-0.92-2.4C63.32 916.14 62.38 915.89 61.11 915.89z" fill="#D40000"/>
+  <polygon points="90.53 906.81 88.02 906.81 83.87 913.06 79.76 906.81 77.16 906.81 82.56 915.01 76.47 924.2 78.97 924.2 83.82 916.92 88.61 924.2 91.21 924.2 85.12 914.95 " fill="#FFF"/>
+  <polygon points="17.8 908.61 17.8 906.81 4.06 906.81 4.06 908.8 14.85 908.8 3.79 922.4 3.79 924.2 18.07 924.2 18.07 922.21 6.75 922.21 " fill="#FFF"/>
+  <path d="M27.11 906.81l-6.68 17.38h2.49l1.59-4.46H32.4l1.59 4.46h2.46l-6.66-17.38H27.11zM25.23 917.78l3.21-8.65 3.21 8.65H25.23z" fill="#FFF"/>
+  <path d="M47.8 914.83c0.96-0.17 1.7-0.56 2.2-1.19 0.5-0.63 0.75-1.47 0.75-2.53 0-1.38-0.48-2.44-1.46-3.18 -0.98-0.75-2.37-1.12-4.17-1.12h-6.04v17.38h6.28c1.96 0 3.48-0.43 4.53-1.28 1.06-0.85 1.59-2.05 1.59-3.59 0-1.17-0.32-2.17-0.96-2.95C49.86 915.58 48.96 915.07 47.8 914.83zM41.43 908.74h3.5c1.15 0 2.02 0.22 2.59 0.65 0.56 0.43 0.84 1.08 0.84 1.97 0 0.88-0.28 1.54-0.84 1.98 -0.57 0.43-1.44 0.65-2.59 0.65h-3.5V908.74zM48.06 921.47c-0.61 0.52-1.55 0.78-2.83 0.78h-3.79v-6.36h3.8c1.28 0 2.22 0.26 2.83 0.78 0.61 0.51 0.92 1.31 0.92 2.4C48.97 920.14 48.67 920.95 48.06 921.47z" fill="#FFF"/>
+  <rect x="71.1" y="906.81" width="2.37" height="17.38" fill="#FFF"/>
+  <path d="M63.67 914.83c0.97-0.17 1.71-0.56 2.21-1.19 0.5-0.63 0.75-1.47 0.75-2.53 0-1.38-0.49-2.44-1.47-3.18 -0.98-0.75-2.37-1.12-4.17-1.12h-6.04v17.38h6.28c1.96 0 3.47-0.43 4.53-1.28 1.07-0.85 1.6-2.05 1.6-3.59 0-1.17-0.32-2.17-0.97-2.95C65.74 915.58 64.83 915.07 63.67 914.83zM57.31 908.74h3.5c1.16 0 2.02 0.22 2.58 0.65 0.57 0.43 0.85 1.08 0.85 1.97 0 0.88-0.28 1.54-0.85 1.98 -0.56 0.43-1.43 0.65-2.58 0.65h-3.5V908.74zM63.94 921.47c-0.62 0.52-1.56 0.78-2.83 0.78h-3.8v-6.36h3.8c1.27 0 2.21 0.26 2.83 0.78 0.61 0.51 0.92 1.31 0.92 2.4C64.86 920.14 64.55 920.95 63.94 921.47z" fill="#FFF"/>
+  <path d="M23 84H13C12.45 84 12 84.45 12 85v10c0 0.55 0.45 1 1 1h10c0.55 0 1-0.45 1-1V85C24 84.45 23.55 84 23 84zM21.02 93.82h-6.03v-1.23l3.54-4.81h-3.33V86.18h5.7v1.35l-3.44 4.69h3.57V93.82z" fill="#3C5563"/>
+  <polygon points="25 227 19.63 227 21.63 229.01 19 231.64 20.36 233 22.99 230.37 25 232.37 " fill="#FFF"/>
+  <polygon points="15.64 235 13.01 237.63 11 235.63 11 241 16.37 241 14.37 239 17 236.36 " fill="#FFF"/>
+  <polygon points="25 264.36 23.64 263 21.01 265.63 19 263.63 19 269 24.37 269 22.37 267 " fill="#FFF"/>
+  <polygon points="13.63 273.01 11 275.64 12.36 277 14.99 274.37 17 276.37 17 271 11.63 271 " fill="#FFF"/>
+  <path d="M22.35 158.06l-1.06 1.06c0.74 0.79 1.21 1.82 1.21 2.98 0 2.44-2.02 4.42-4.5 4.42s-4.5-1.98-4.5-4.42c0-1.16 0.47-2.19 1.21-2.98l-1.06-1.06c-1.02 1.05-1.65 2.47-1.65 4.04 0 3.26 2.69 5.9 6 5.9 3.31 0 6-2.64 6-5.9C24 160.54 23.37 159.12 22.35 158.06zM19 156h-2v6h2V156z" fill="#3C5563"/>
+  <path d="M96.39 56.56c-0.06-0.13-0.12-0.29-0.18-0.48 -0.06-0.19-0.09-0.4-0.09-0.63 0-0.28 0.07-0.53 0.21-0.76 0.14-0.23 0.32-0.45 0.54-0.66 0.21-0.21 0.45-0.42 0.69-0.63 0.25-0.21 0.48-0.45 0.69-0.73 0.22-0.27 0.39-0.57 0.54-0.9C98.93 51.45 99 51.08 99 50.66c0-0.44-0.08-0.82-0.25-1.15 -0.17-0.33-0.4-0.61-0.69-0.83 -0.29-0.22-0.64-0.39-1.03-0.51C96.63 48.06 96.22 48 95.78 48c-0.96 0-1.88 0.26-2.77 0.78v1.88c0.74-0.72 1.51-1.08 2.32-1.08 0.25 0 0.49 0.03 0.71 0.09 0.22 0.06 0.42 0.15 0.59 0.27 0.17 0.12 0.31 0.28 0.41 0.46 0.1 0.18 0.15 0.4 0.15 0.64 0 0.27-0.07 0.52-0.2 0.75 -0.13 0.23-0.3 0.44-0.5 0.65 -0.2 0.21-0.41 0.42-0.64 0.63 -0.23 0.22-0.45 0.44-0.64 0.68 -0.2 0.23-0.36 0.48-0.5 0.75 -0.13 0.27-0.2 0.57-0.2 0.9 0 0.21 0.02 0.43 0.06 0.64 0.04 0.22 0.08 0.4 0.13 0.53H96.39zM96.41 59.68c0.23-0.21 0.34-0.46 0.34-0.76 0-0.31-0.11-0.56-0.34-0.76 -0.23-0.22-0.51-0.32-0.82-0.32 -0.32 0-0.59 0.11-0.82 0.33 -0.23 0.2-0.34 0.46-0.34 0.76 0 0.3 0.11 0.56 0.34 0.77C95.01 59.9 95.29 60 95.6 60 95.9 60 96.17 59.9 96.41 59.68L96.41 59.68z" fill="#FFF"/>
+  <path d="M96 128c-2.28 0-4.36 0.8-6 2.14V132h12v-1.86C100.36 128.8 98.28 128 96 128zM96 126c1.66 0 3-1.34 3-3 0-1.66-1.34-3-3-3 -1.66 0-3 1.34-3 3C93 124.66 94.34 126 96 126z" fill="#FFF"/>
+  <path d="M101 84H91C90.45 84 90 84.45 90 85v10c0 0.55 0.45 1 1 1h10c0.55 0 1-0.45 1-1V85C102 84.45 101.55 84 101 84zM99.02 93.82h-6.03v-1.23l3.54-4.81h-3.33V86.18h5.7v1.35l-3.44 4.69h3.57V93.82z" fill="#FFF"/>
+  <path d="M100.35 158.06l-1.06 1.06c0.74 0.79 1.21 1.82 1.21 2.98 0 2.44-2.02 4.42-4.5 4.42s-4.5-1.98-4.5-4.42c0-1.16 0.47-2.19 1.21-2.98l-1.06-1.06c-1.02 1.05-1.65 2.47-1.65 4.04 0 3.26 2.69 5.9 6 5.9 3.31 0 6-2.64 6-5.9C102 160.54 101.37 159.12 100.35 158.06zM97 156h-2v6h2V156z" fill="#FFF"/>
+  <path d="M22.76 452.13c-0.82 1.83-2.62 3.13-4.76 3.13 -2.9 0-5.25-2.35-5.25-5.25 0-2.9 2.35-5.25 5.25-5.25 1.45 0 2.75 0.6 3.69 1.56l0 0 -2.82 2.82L25 449.13V443l-2.06 2.06c0 0-0.01 0.01-0.02 0.01C21.66 443.8 19.93 443 18 443c-3.86 0-7 3.14-7 7 0 3.87 3.14 7 7 7 3.12 0 5.74-2.05 6.64-4.87H22.76z" fill="#FFF"/>
+  <path d="M61.5 837h-15c-0.83 0-1.5 0.67-1.5 1.5v15c0 0.83 0.67 1.5 1.5 1.5h15c0.83 0 1.5-0.67 1.5-1.5v-15C63 837.67 62.33 837 61.5 837zM61 853H47v-12h14V853zM51 844h-2v2h2V844zM59 844h-2v2h2V844zM55 844h-2v2h2V844zM55 848h-2v2h2V848zM51 848h-2v2h2V848zM59 848h-2v2h2V848z" fill="#ACBBC2"/>
+  <path d="M58.79 807.22l-2.19 2.19 -2.01-2.01 2.19-2.18c-1.21-0.45-2.62-0.19-3.59 0.78 -1.02 1.02-1.25 2.52-0.71 3.77L49 813.23 50.77 815l3.48-3.48c1.25 0.54 2.74 0.3 3.76-0.71C58.98 809.84 59.23 808.43 58.79 807.22z" fill="#F3A914"/>
+  <path d="M55 777v-5.21c0.88-0.39 1.5-1.26 1.5-2.29 0-1.38-1.12-2.5-2.5-2.5 -1.38 0-2.5 1.12-2.5 2.5 0 1.02 0.62 1.9 1.5 2.29V777h-3l4 4 4-4H55z" fill="#768D99"/>
+  <path d="M53 735v5.21c-0.88 0.39-1.5 1.26-1.5 2.29 0 1.38 1.12 2.5 2.5 2.5 1.38 0 2.5-1.12 2.5-2.5 0-1.02-0.62-1.9-1.5-2.29V735h3l-4-4 -4 4H53z" fill="#768D99"/>
+  <path d="M61.68 695.71c-0.42-0.45-1.11-0.45-1.53 0l-8.45 8.91 -3.84-4.05c-0.42-0.45-1.11-0.45-1.53 0 -0.42 0.45-0.43 1.17 0 1.62l4.6 4.86c0.21 0.22 0.49 0.33 0.77 0.33 0.28 0 0.56-0.11 0.77-0.33l9.21-9.71C62.11 696.88 62.11 696.16 61.68 695.71z" fill="#768D99"/>
+  <path d="M98.91 19.85l-0.26 0.27 -0.73-0.73c1.49-1.77 1.43-4.4-0.24-6.07 -1.76-1.76-4.61-1.76-6.36 0 -1.76 1.76-1.75 4.6 0 6.36 1.67 1.67 4.31 1.74 6.07 0.24l0.73 0.73 -0.27 0.27L100.94 24l1.06-1.06L98.91 19.85zM92.38 18.62c-1.17-1.17-1.17-3.07 0-4.24 1.17-1.17 3.07-1.17 4.24 0s1.17 3.07 0 4.24C95.45 19.79 93.55 19.79 92.38 18.62z" fill="#FFF"/>
+</svg>
diff -x graphtree -Naru ./img/oneoaas-wechat.jpg graphtree/img/oneoaas-wechat.jpg
--- ./img/oneoaas-wechat.jpg	1970-01-01 08:00:00.000000000 +0800
+++ graphtree/img/oneoaas-wechat.jpg	2016-04-18 18:46:02.000000000 +0800
@@ -0,0 +1,73 @@
+ JFIF       C 
+
+
+ C		 "            	
+    } !1AQa"q2#BR$3br	
+%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz        	
+   w !1AQaq"2B	#3Rbr
+$4%&'()*56789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz   ? S( "I3@E&h -dPIZ (ȥLZ ( ( ( (ȥ)3@E&h -4 QE QE -![σ|a%E_ao+r93N L  Q >& 3 MvK◆>xS񗌵?W~,_*D$Jr N3	z?; E3 (g #Q GL jT _S?5ًoP5OFʿz?; E3 (g #WJ_ڏw) G?"} Qnϕ6LOo?i_* oo_k79ޛYdX,/#X8 (o_kx7^9ޥdXyv
+g<(`kޥ^ kyv?,Tgh`kx^ޛ k'/"9<h _ٯw+; [;''ۏ6O8	we-OcĚ۾{x<U4(2y$_\I o l+υ߰Oo<eloR~{a?,Tg 
+~;|i|xcz۾ec\J<P+<hxa`Hq_ ?.៌<3 w}WZ}پk-?Yt'ȇp3cI m ¸7$ؾG .|;ěIs# ߷c7?~K/2W停sg~ oo?w7^9&}"/̉%O(RD<1ppA.~ b?|7ڿu}YeMq|q'
+	 4WW ' #./!m _o%v|[ާi$|})2$>x$CgE OQ_ Usw(~¸$ؿڟo O|y_Mq
+  w|eOĚg~{xxYRGr9 : g 3 k?  i_߰Oh/j$߳D$J0Fq&+ u' q
+~xĚo۾e?_J<P2xcoo>'/'x^ I}엿g/̿IU$qʜg#~@  i)@?U? b KJSc 5@+ i)@?z?; E3 (g #WO~I_kȿ"ISCqErًoP5OFʿz?; E3 (g #Q GL jQ1? \x?_# VOy_Mq*?gҀ? ( )-!/*?gҿU? b? ;J  |M g+S
+ &'7t(? b KJSe 5_U Q & 3 Nkg?=W  5v7ÏU b&}bW_n<ݿxnxWOo?iG=  3 .o_x W?K
+|3 _I; oH | Z>w 7gʏgxNz߷o< cxoM~ea?J,/#X8 
+ P~ B]i 3/ L>f yn~a m &?a?a7 M߻<~V.?>O Mwuڀ>  ҟ|M#_f g# j|X [ݟ+wݎqWI0~Moj| W7g7g`k~޿oߵ| coM,,gy_s,q ~_o?/ lxoRw쿲,`<Sq3	5  m &?a_a7 M߻<~VQ &3 M+>(?~4xS񗌼MK]gD$S$h8Qdh>:6|	7_H~ ϵ󮢃nۏ7w9ێ3_ |m O!}bnO> LbٷA|Q;|h&xgz/<.T>xWx8$W)35 m ¸7#^G -n'qq җԵ GL j~(x7S&^)2'%VC*q@4W;h ¿+3_S?#kk_$ݟ*?m9   ɉM g-+O!}W G  p:ZWʟC  [
+ '3lk*?gҾU?!| G  p5W?C [
+ '7k(
+(
+CKHzPOo?i_ًoP5OF* ҟM#_e g# j|X [ݟ+wݎq_jm }U G T j? j_*Ì ݴÌ ݴ޿?w| lxR,/<y_A,3H oX   v?3 _ 	<m 	$b O~iwG6 T>ω ]z-O;xg/O _j־k}oZkmeg5I!($}UQ )>;x?-G? G6AI>V1'b? ;J S     o/k?ٿ7^>les߲I.ៃ<M wď}WEپu-?X_t7?p?C>vgV  L g-(O/|&/j|Y2T>HAg' _?lg}{ac_ Omc++ _ҟ|Mw#_e $j| UTݟ+oݞq_?b M _W?f??鄻y< } -ԟ?b>7|Hڿt_]_}RCXCqq`	^ޛ}^/̕"O)^D)rp5~ >;x?'#_e g6Abnϕn8 J|
+7ÏUm}&}nWSv|xcvyʿ?eߴ+ G}>+|>Tw823|R[;-3Ěo/E?D2xc?aۛo1 ?پa.hayGdw&4 k+Sd @ :3<k~v Q~;|&/xzo{	2T>Hg9ypC.?v o j?*4|8 ] g 	ڼ&) }7g7g`W5s m O&?ba7 L%߻< ~|QާxĚo/2$>xd9IW'j~2񗁿7_kװ%Hvs
+q Mr'?iO& ٿYy>MP؛n2jOMoj| U7g7g`~|'~ҟ<3 	/ [_'<R}o8)KoSoiW_J<Lr!3"t ago1 ?
+پo.hʿj?%/4o|G  ٿY  ڼ&(?7gF7cdzLOo?i_ )?j??_-X& sk/W^w7DOl{pqR| o m}&dWE?>V߼1<qV?> _S5ًoP5OF?_[? ?CgZ@U f/)@  oo>X^ <7엿g3˰IU\aqʌ#} 2   v 2   vQ@Q@Q@ O~I_kȿ"ISCqE~+~?|1_7e coLw~,_aq|+9ȃ8O  ) ~fǉם _Ǜ'ws}Q?Ə;2MOk<Py]ID	g<k[
+Q1?W¸7$_ؿڟo @|y_Mq(((x7S&^)2'%VC*q@5 J?M 	/_?-m|;~ov|qdտ j^3cJm ¸7$ؾG .|;ěIs# \/MO2?<7y_kDy\*|2ƇA"'࿎??$|d_$!H8">~?|Mo߉1_ eh`OQE
+mWgnX@< k   ? oSc?ٿ}^/^'O^2 <Iy_k<Py\I|*FO$~ R˟fZ?3 _?n'~o_n<3?;/ cxMe?D)"88  /G:b e S kxG7L&Y}(<.WeA,3H  L  T \~_LM~ UKoSoiW_J<Lr!3"W	Ꮒ e-Ozg۾{ygY^D)rxJ_s) G?"}կ} Q*nϕ6|-[Ꮒ<3zoK/K?J+3yc` +W    ϶ o/k?ٿ7^>lesKoSoiW_J<Lr!3"?U?o_+Oo;>2oI엿~eOK;!H8G %/  ?b e> 7gʏgxN|qN 3  4î?i&_?&?U?/]WG  d?4ϰO?*9Sr	] w-3Ěg۾eS牙RD<1pyW: g 3 h  ӿS?5~~?|ON7e lxSw~gq|*FO$ 	K.|N h #_` O󼟵%}c3 } J  *G;k?\xO ZyO<>y}gw9ǫQ & 3 Nkg?>V ӿS?5{ zvX2ǆ/}"3˰>xWx8_QާxĚo/2$>xd9IQ{|.?Ə;>nMO?dDPy]ʃ	Xg( *G;k ] 
+ mj}~͓;> ӿS?5wWI)|-?~M7]""IS牙RD<1pyPEPEPHzR   |L g-+Z
+ '7kS	]Ꮝ-3cz۾e`<S牕4<00x$PW??m w#_b O۾xm=9d? ݵ o5W sk}ם__n<>3c[~;||szo~ec?X[ <3ycp  eρҟ3oj|Yg U7g7g` (^Xe;? |3 mwߵ'.o3 wď}+Z}پu߹X_t7·0WJb7$ؾ?-m|;DGc' IS㷉# b;o}^Okv&[s? /e쿶}>|鼽k?նxY_˟' G㷆~|d7&?K]?i=P(M[ #ʒ߰  	 'F 1_}h l|| SJ|u7Z?m}%mboړv|tcv9O_?eφ?` \xg# W^wy}dso[σ|a%E_ao+r93?JjO͟M?_ĳe먠 YNv|๘]^U.~ԟ m57/ڿt_ZCX6o3*H'k\c5 ® qG>uuy?dqq *ԟ >;x?'#_f g6Abnϕn8 ejm~UQ{|Q?;>2nM3?d<S~eOJ)#T9hab M O'?f??鼻}{* ҟ|M#_f g# j|X [ݟ+wݎq)j?ߴ-X& /O7DI>T{82sc7?~K/2W停sg ~ԟ ?'$_ؿe gyQAcǛg  (C~}ųo9_*?ҿ~ԟfW& skםWn<>3`R ?_ҟ3w#_j $j|Yg UTݟ+oݞq=  3  \|2 Oዿ	 'I~ 1o g lm>V  Gm 
+O>?7 Vwn\ 
+	q &'tT>I	7ÏG ?}nVݟ+oݞq{^Y? 7|{|Q?;>2nM3?d<S~eOJ)#T9kc6O 	4w\_C> 0i 'Kq?'?iO& ٿYy>MP؛n2:uoo/X?7}_h/̰yYsgE4 /*?gҿM~Q >& 3 MvEPEPHiiJ   |M g+  }? J y_?ڏ my ` @/ QǛwqu_~)xcO4x7SޥyrOJTg ~	 o l+ʿe*3_8 ] 	/ڿg 	|:Y }v | Q23k<~eID/"9<k1L  8gZG8gZ@U  f/)@? ?`>/X^2 7}wg/̰>HAg'M} 2[? ?۟6O G3\_C> 0 f 'K{ϫ~˟ػO~|e7!<5]WfEԷP)a}D #n  ٟ| G  p5P#	_Kjǀ&$zE 'qU5J>o~-r *J2pO\~|iׯ<3z)hf^\9JwgvfbĖf9,OROs_W59qDӥJd fkW_ÿ>"k676_\y2r `G_3߱/G~"i Nw}eͼq'm,,#R
++ ?r>"63|Ggӿg߶G! ڿa#lM}co1W~¯෇~|Em4o쾹"9$eF@¾C ?_܃"63|Gg I\ <ƾ? ~ j+S0x)u7-FQgfҠp'9\;?O\Y+o	]1|Qf%k]O$ׅpr?6|73g+Qm6o{x࿎?L&}O$̇)"8<+`>/X^2 7}wg/̰>HAg'M} 1 '  &-ej}Co'v(D~ԟi1 ¸7$ؾG .|; ěIs#?߷Ocx7ԾK{<.'%\aqʌ#x1s m W&?ba7 L%߻<~~g?'#_i g7Rbnϕn8 ~iscĚ~e <*$nya`r@oSoǆ#>kkgTݟ*Om ejm_ >o 6_Ż S	] w-3Ěg۾eS牙RD<1pyW-O;xg/O _j־k}oZkmeg5I!($~ g?'#_i g7Rbnϕn8?j?Mk m}&dWE?>V߼1<۟6O G3\_C> 0 f 'K{/'/O2?I_kDS~dI*|3!H8 *? _ >o 6_Ż??º eO>|| d?ծy۸~QE QE QE 'OƏ~2񗁿|Iy_k׿HuA
+3M~@  i)@?~(ccoxSޙY2$"Vs
+q4s>'~ҟ؟M 	/[_'&QoϕW3cJoǉ#>ukg$ݟ*OmW  |M g(  ӿS?5} '~ҟc/_쿰Z>w&Qoڿ)xcශ5?xSޛ}ID/"98 ~~iOW& կyWv|>qddW~;||szo~ec?X[ <3ycp j+_z? E7 ( #PʟC [
+ '3kڏ'Soǉ#>ukg$ݟ*Om~(~SosM7]E_J<P2xc(+? gEY|jv6iٽ
+|g5S^EhIvC+¯'mҷ+z|;Ҝ*&N?#LgV卵ޞSqFy¾mr[}7̴mgKK<gwrw#sW^_~M#VWZ6VBţ
+ 5KInrpKVK W1W]t!>!kKKHAqp-ciPi1x!ol.R[p9ϥ_M)׺m[C7x朩K-/Iz+&cCLqOzv^ԬNMv;]>L<|*K HIlwoϠ>dvәmdrCtEx9iOTwG[$(_wN_sශ47?|߲YdX98 _/_?Wo?w<elxoReװ-Y728  ?d7gǉ5?Ayw+*$nya`r@OWq13  5 ~cශ47Lޛ/#X8 
+	K.|N h #_` O󼟵%}c3 } J ? i_TM᣿ /hOxf [ ݍ.2[ <wx7gǉ5/7_h3ˉVTH8_J_sw G?}ם Q+Ǜwq }o>xLoto,,_+ <r93 z?; E3 (g #W޿Wo?|elxoR/`<xuq*35@loh}ac_> >G 7cgˌJ-oin7%%%y_留^G<p0  c쿰]]yO>ygw |h|s/K߳[ $0Fq?(
+(
+CҖ  5u7ÏU b&}bW_n<ݿxnxE`?<w^&}^3ˉ"O)4(2rI5 î?f/&__?&?* aۛo1 _پa.hayGdw&4 k+Sc @ :3<k~v>W Z>\xgO ]yO<y}gw9ǀ|.;|&zoK/	2Wy`g9y PI3OOm ;o^Ou 귦[~*abo1 _
+پm.h(x7S&^)2'%VC*q@5 GL j 5iOq gOy>M ޛm0}WN L  	_zgooio/Ȟ'%$qʜg#@1 m &?a_a7 M߻<~VQ >&3 M?O;e/lR{đ'	g9$ [	exbI^Y\C&32qߐ+ڼGPC7)5Ưk%oO	Br >ZsZq#OwG5+O>?\j#H|3_9֍f&<<t] އ꿴ܺ*}!)Bݻ#9y|tcRt6OR^PI|ҋYr$+%-߫_#Gę}.O7 j~:-^\MvVyrWbQ0M&tnm^^yu&̍4dl#;J**OT}?3,ruz5~OC㥏,<7ic$-۞	fG^J^s9}D#:i%Ei-F%
+ yʱݗ<<~4 e__	¾&uK໴Mq6V"s=N6i髲cx77bHЫ+WvVW{:0()? @?jO͟|M/_ ĳe먠 [NvyR .f6PO<K G  p:ZW~?76&W!}bnO> LbٷWG  o /K?Wߵ&[sρ'ٯoǉ>kuy>g'ۏ6O8_z?; E3 (g #P~ >;xg?'$_ؿi gyֲcǛu u'x7$~K{2'%$qʜg#~@?4 ˯  j?%/3_|G  	/Y  |:(?Nv|_/MO2?<7y_kDy\*|2ƇA"??ag?o k_
+w~oͿgʿjO͟Mo?_ eX Uv}s Ƶ 	 q u 	)ϲ}y{>qn 6poo[ah	O G~}?g)xA9bI (()J Z \|2  ڏ
+ ?WGo A_;ε_e}v㝹8  kៈ #WK?/Zߵ>yq~9fOX& skם~on<3[K|	xǆ/7엿g3˕UWxr8 3R 
+s
+ +??WE A_;κ_e}v㝹8 ??|1_7e coLw~,_aq|+9ȃ8O ~ X  O _[ '?? WL'ɵ[v|xcvy߰1!?[b|K}g?7~{co|◆>4Lu?^o/~,g+ $0FqAʿ+
+[7eon]_aq|Nr N3& \O ӝ}U@\I o l+υ߰Oo<elxoR~{a?,Tg} am k
+w~oͿg_nq  q '/!2 j e _l7+m;tFI '^7 UW Ohit^x]Xe(ڠlW_{[|D+ZX)t62P8FtW{O˸ÆJUn)[3Q^* } G צxyK × $i:5> =ΨfQ w?Eο?>bGCV o ~   o ~ g˿_	]_g
+KDljH&?ڙF}z3d֚5p$'   Wg.k>Ӆ8SI4wgO_L ]~RᏂe-Ozo߳?J'8Skڋ	I ' h 9_?'ɵjM}э?+~UiO>&q 
+y>MS *nϕn8SR|1? \x?_# VOy_MqW'࿎??$|d_$!H8"+  $_* Q &3 MQ~;|&/xzo{	2T>Hg9yp׿ )j??_-X& sk/W^w7DOl{pp~UiO^&q 
+ y>MS *nϕn8k  +oC¾}ųo9 T _S5| z޿~49o|sMK?dȿX7<09 WI3㷉m Eowk 귾y~ X   v_z~o_?dx7^9&d_)"8<+ l S kړg3go|8 3'|:) o}v㝹8 ҝQ@Q@Q@?Q~hާ/xgĚ{<.$>HTHp8$ O~I_kȿ"ISCqE}@\ 7 ~_W?we/lxRw<uA
+3I5?ڏ my ` @/ QǛwqu_~)xcO4x7SޥyrOJTg ~|M߆᯲ ek_o7.7RTvF?*9iOOX& y~ov|qd1M   ' './!m _o%v|υ߷o< cxoM~ea?J,/#X8 
++oa|	& ;GhZ,/s8`@ ߷;< lR~e,
+	Xg$
+  
+QN W¸7#_ڟo @󼟲y_}ds edL~$x_ں~{maͬBa>Dۓ$ ~˟iOU<3 	/ m|;WSv|>qdgާi$|})2$>x$CgE (ǎ;R?7췿g/̉Ud9Ir MF6F<@t;DXZ^n3DI>T{82s?eωߴ+ G}>+|>Tw822D?h7 />_ښ:[XuﭣT47;pr	㟊_|O_z|ecMeȒTfCqA{|.?Ə;>nMO?dDPy]ʃ	Xg(W
+-2W ¸suy?d Hqq~5~񟌼ڿ5/}jy]IG2F3I5M᣿g/}hOx^ϵ ۝ .p1M  xV%(ƞ]ĺg~zm/Ud9Ir3$! ~I=5s_`	^ޛ}^/̕"O)^D)rp5|'~ҟ<3 	/ [_'<R}o8  i)@?O'w>4~>on]%.%O&Wx8^UKoSoiW_J<Lr!3"u? b KJ S l  ? oSd?ٿ}^lq߲៌<3 	ďWZ}Տ~u-?(Sl6'ȃ;rrē?C/ o_+Ɵ>2o<7}엿0y]OK:G ֯UQN  \x# ^wy_}dsSohޙ$Լ߲Y}(<.'yYPa#s}  L   /hާ/j$Լ(<.$>HPa#A'M} GL j [>~|3o'᯵j`7.ֱK'v=W1M  ?J_ڏw) G?#} Qnϕ6 G  p5WGڏ) 
+ bo @|3 _nϕ'6+ Q >& 3 MvEPEPHzRG  o 7K?Wߵ&[s?_ҟ|3w#_j $j|Yg UTݟ+oݞq zv-X?߰"/̰y`g9y_ |-;<eOĚoK߳?D?*9Sr?ۛ  $  -~ݱ Bb  3/_> L^ϵvn>U ӿS?5} -?m>?H/ڿuXRYb6o|3',I S 1   v (^Xd ;? |3 mwG  d?4ϰO?*9Sr aG&q}<|3- nϗl|Qs o ؟ m}%kW݉>V1'O\ R 5uZ? b%eoڟn<tn8Gî?f/&__?&*  i@
+ '3lN L   /^'O^2 <Iy_k<Py\I|*FO$ W R 5	7Z? b%󮢃oڟn<tn8G~?71w&O&?ba7 Le߻<~R[Ꮝ>-3cz/Kʒ+<hxa`+ uŏ&_ &? jOҟMĳj|X [7gF7cd˟UiOq 
+ y>M *nϕn8xcc7LޙY}Y2Wfs,q _~)x࿎x7S&O<OJ)#T9h3 
+Oa^W.)>xg?-G? G7RI>V1'?a?& qϴ}<3- n۳[>WQԟ b&5o|7_Z}]M먥Mq+q
+  'i?^&q ٿgOy>MS ޛm0|ዿ6 I~ 0 h lm:⏉9u?ia%/Ud9Ir_?wgP4F
+ '3lU _ҟ|Mw#_e $j| UTݟ+oݞqW-0~g'O c#Ŀj־ucKkmeI ܜ$:b e S hO! oj?*3_o|8 ] 	/g 	|:) }v}U3\c5 m ¸#^G 'qq T>ω ] yW㷆~# bE}wk,v>yq]_P0  Gm 
+O>?7 VwnÌ ݵgio7dȰ%y_s,q u_wgP4F?g . +oL$¾oKw=x  L g( ӿS?5} -?m>?H/ڿuXRYb6o|3',I E QE QE!@G_z|eoiW쿲/ȒT⁐$Cg\=b  S 
+ '3l?[?  1M   f/)@?T l S h l S hz? E7 ( #W|>c[ qoH | ]Z>w7gʓyF+?j?%/3_|G  	/Y  |:(?Nvz˯ rOcx7ԾK{<.'%\aqʌ#~kWO_o3S㷆~m ;^Ok, 귦[~_[?	 ޿Wo?|elxoR/`<xuq*35  wg  "u  |  e q?5G?ڏ my ` @/ QǛwq|.);xg?-H ~ GyֲOnsg# ๟D 7 S◆>4Lu?^o/~,g+ $0FqA jOړ'%/V+}uPmve_s
+ '??WE A_;κ_e}v㝹8 0? /e쿶}>|鼽k?նxݸ k_oh_bl'> >wv 6ү1g lxoR~{y`<^'%Uq*3~jQV o+{} - lះb&d/]K?n߼s<g _qN 3  5\5  Gkuy?kJqgU  ' _ qQ  ' _ qP+z_4>9|K?dױ-Y728  hs$K/E <0q* h]_ԟ >x?'$ؿf gyQAcǛ W	K.|N h #_` O󼟵%}c3 } JSnomo k_w~cͿg
+ '7k?_1[e coM{ygR$"Vs
+q Mr?j??+G}+|I>Tw822~ԟ?>#_f >7QOznϕn8g / +oL%¾oKw=x   |M g+O/|&/j|Y2T>HAg' _T>ω e~Q>&3 NvkcJ® qoH>ukděIs#? W_1  	|m qؿ-||~  l S hV((   |M g+ w|eOĚg~{xxYRGr9 Oo?i_T1? ӥ ~U  i)@?z?; E3 (g #WʴPLOo?i_* o*?ҾT l '0?~)x࿎x7S&O<OJ)#T9k 
+όo_a%gaoή0FqU>)|Roj~27]%HY^D)rp4s'~ҟ؟M 	/[_'&QoϕW Uڏ) 
+ǉ"կ} _nϕ'6 z	-'x2?4߷}"/̿>xd9I@U~޿4>osKkȱ.%O(4<00x$WO?o&4OX }կy~gSv|qdK	Z?+wg/̕"O%g9yp)3cJm ¸7$ؾG .|;ěIs# ||s>K/K?X[ <r93G5??>ԼdXAyrƇA"j>(~SosM7]E_J<P2xc+qN 3  4_?jO߳_+9}|+|Olwp1Q?Ə;2MOk<Py]ID	g<kqN 3  5.?;M3kDS~eĩ̇)"8<( \~_LM':b g O k+
+[7eon]_aq|Nr N3& 
+.|N?W¸$_ؿڟo O|y_Mqow>>9ota%%,-Vg9y_@~˟' G㷆~|d7&?K]?i=P(M[ #ʒ_I.ៃ<M wď}WEپu-?X_t7?pO w@?eφ?X \xg# W^wy_}ds*?gҾ ~˟iOU<3 	/ m|;WSv|>qdgu; D +g $ GL j? i^ ~_~>񗌼7kױ,."O)^D)rxO?ړ4OX& skם~gn<3K <wZǉ5/+wg3ˉ"O%THp8_j˟' G㷆~|d7&?K]?i=P(M[ #ʒ |h|s/K߳[ $0Fq_  b KJ S l  ? oSd?ٿ}^lqG ?dxZǉ5?}Ayw'$h8QdIρSoǆ#>kkgTݟ*Om>)|-?~M7]""IS牙RD<1pyPEPEPHii ~Q >& 3 MvQR| o m}&dWE?>V߼1<_
+ '7kN L  O8l S h l S koz?; E3 (g #Q GL j S O ӝ| 1_|Q;|h&xgz/<.T>xWx8$WڟC?	 _ kSO® sk3 ^Ou ʛm0jkW {_߰W'Oox$Ծ{<.$"Pa#A'M } F  p9WʟC>?vg\>'?3k'1o_j`OeֱE2m'gnT}S l  O oSd?ٿ}^lpOg?i_T   U߲៌<3 	ďWZ}Տ~u-?(Sl6'ȃ;rrē.ƏOkDy]ĩg<(O~oQ? ~wQ?  \~_L  M/:b e S he*4o8 ] ڿg 	ڼ&Y }7g7g`y  e q?5Uڏw 
+ǉם _Ǜ'ws S㯉#  sk, ^Ok~ԛn2~ \|2  ӿS?5K>φ_ ] ~߷71!?D c 	/+} ]퍽ʿu } \cJ?#uk_Tݟ*?m9,xcc7LޙY}Y2Wfs,q q_* 6!?[  -||+? i_)j?ߴ-X& /O7DI>T{82rYR| kob&d/Z?n߼s<g nyGc!?4 WSc O o&3<~v?j|Q~hާ/xgĚ{<.$>HTHp8$	_zgooio/Ȟ'%$qʜg#@3  m &a?a7 M߻<y_G  o 7K?Wߵ&[s
+QN W¸7#_ڟo @󼟲y_}ds i@QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE QE 
\ No newline at end of file
diff -x graphtree -Naru ./include/func.inc.php graphtree/include/func.inc.php
--- ./include/func.inc.php	2016-02-26 17:45:47.000000000 +0800
+++ graphtree/include/func.inc.php	2016-04-18 18:46:02.000000000 +0800
@@ -2293,3 +2293,46 @@
 
 	return imagecolorallocate($image, $red, $green, $blue);
 }
+	/*
+         * debug echo print_r var_dump or exit
+         */
+	function _ex($obj = null,$exit = true){
+		static $cnt = 1;
+		$type = gettype($obj);
+		switch($type){
+			case "boolean":
+				var_dump($obj);
+				echo ("Step ".$cnt." >> boolean -- ".date("m-d H:i:s")." <br>");
+				break;
+			case "integer":
+			case "double":
+			case "string":
+				echo ("Step ".$cnt." >> ".$obj." -- ".date("m-d H:i:s")." <br>");
+				break;
+			case "array":
+				print_r($obj);
+				echo "<br>";
+				echo ("Step ".$cnt." >> array count:".count($obj)." -- ".date("m-d H:i:s")." <br>");
+				break;
+			case "object":
+				var_dump($obj);
+				echo ("Step ".$cnt." >> object -- ".date("m-d H:i:s")." <br>");
+				break;
+			case "resource":
+				var_dump($obj);
+				echo ("Step ".$cnt." >> resource -- ".date("m-d H:i:s")." <br>");
+				break;
+			case "NULL":
+				var_dump($obj);
+				echo ("Step ".$cnt." >> NULL -- ".date("m-d H:i:s")." <br>");
+				break;
+			default:
+				break;
+		}
+
+		if($exit){
+			exit();
+		}
+
+		$cnt++;
+	}
\ No newline at end of file
diff -x graphtree -Naru ./include/menu.inc.php graphtree/include/menu.inc.php
--- ./include/menu.inc.php	2016-02-26 17:45:56.000000000 +0800
+++ graphtree/include/menu.inc.php	2016-04-18 18:46:02.000000000 +0800
@@ -22,408 +22,401 @@
 /**
  * NOTE - menu array format:
  * first level:
- *	'label' = main menu title.
- *	'default_page_id	= default page url from 'pages' then opened menu.
- *	'pages' = collection of pages which are displayed from this menu.
- *	these pages are saved a last visited submenu of main menu.
+ *    'label' = main menu title.
+ *    'default_page_id    = default page url from 'pages' then opened menu.
+ *    'pages' = collection of pages which are displayed from this menu.
+ *    these pages are saved a last visited submenu of main menu.
  *
  * second level (pages):
- *	'url' = real url for this page
- *	'label' =  submenu title, if missing, menu skipped, but remembered as last visited page.
- *	'sub_pages' = collection of pages for displaying but not remembered as last visited.
+ *    'url' = real url for this page
+ *    'label' =  submenu title, if missing, menu skipped, but remembered as last visited page.
+ *    'sub_pages' = collection of pages for displaying but not remembered as last visited.
  */
 function zbx_construct_menu(&$main_menu, &$sub_menus, &$page, $action = null) {
-	$zbx_menu = [
-		'view' => [
-			'label' => _('Monitoring'),
-			'user_type' => USER_TYPE_ZABBIX_USER,
-			'default_page_id' => 0,
-			'pages' => [
-				[
-					'url' => 'zabbix.php',
-					'action' => 'dashboard.view',
-					'active_if' => ['dashboard.view'],
-					'label' => _('Dashboard'),
-					'sub_pages' => ['dashconf.php']
-				],
-				[
-					'url' => 'overview.php',
-					'label' => _('Overview')
-				],
-				[
-					'url' => 'zabbix.php',
-					'action' => 'web.view',
-					'active_if' => ['web.view'],
-					'label' => _('Web'),
-					'sub_pages' => ['httpdetails.php']
-				],
-				[
-					'url' => 'latest.php',
-					'label' => _('Latest data'),
-					'sub_pages' => ['history.php', 'chart.php']
-				],
-				[
-					'url' => 'tr_status.php',
-					'active_if' => ['acknowledge.edit'],
-					'label' => _('Triggers'),
-					'sub_pages' => ['tr_comments.php', 'chart4.php', 'scripts_exec.php']
-				],
-				[
-					'url' => 'events.php',
-					'label' => _('Events'),
-					'sub_pages' => ['tr_events.php']
-				],
-				[
-					'url' => 'charts.php',
-					'label' => _('Graphs'),
-					'sub_pages' => ['chart2.php', 'chart3.php', 'chart6.php', 'chart7.php']
-				],
-				[
-					'url' => 'screens.php',
-					'label' => _('Screens'),
-					'sub_pages' => [
-						'screenconf.php',
-						'screenedit.php',
-						'screen.import.php',
-						'slides.php',
-						'slideconf.php'
-					]
-				],
-				[
-					'url' => 'zabbix.php',
-					'action' => 'map.view',
-					'active_if' => ['map.view'],
-					'label' => _('Maps'),
-					'sub_pages' => ['image.php', 'sysmaps.php', 'sysmap.php', 'map.php', 'map.import.php']
-				],
-				[
-					'url' => 'zabbix.php',
-					'action' => 'discovery.view',
-					'active_if' => ['discovery.view'],
-					'label' => _('Discovery'),
-					'user_type' => USER_TYPE_ZABBIX_ADMIN
-				],
-				[
-					'url' => 'srv_status.php',
-					'active_if' => ['report.services'],
-					'label' => _('IT services'),
-					'sub_pages' => ['chart5.php']
-				],
-				[
-					'url' => 'chart3.php'
-				],
-				[
-					'url' => 'imgstore.php'
-				],
-				[
-					'url' => 'search.php'
-				],
-				[
-					'url' => 'jsrpc.php'
-				]
-			]
-		],
-		'cm' => [
-			'label' => _('Inventory'),
-			'user_type' => USER_TYPE_ZABBIX_USER,
-			'default_page_id' => 0,
-			'pages' => [
-				[
-					'url' => 'hostinventoriesoverview.php',
-					'label' => _('Overview')
-				],
-				[
-					'url' => 'hostinventories.php',
-					'label' => _('Hosts')
-				]
-			]
-		],
-		'reports' => [
-			'label' => _('Reports'),
-			'user_type' => USER_TYPE_ZABBIX_USER,
-			'default_page_id' => 0,
-			'pages' => [
-				[
-					'url' => 'zabbix.php',
-					'action' => 'report.status',
-					'active_if' => ['report.status'],
-					'label' => _('Status of Zabbix'),
-					'user_type' => USER_TYPE_SUPER_ADMIN
-				],
-				[
-					'url' => 'report2.php',
-					'label' => _('Availability report')
-				],
-				[
-					'url' => 'toptriggers.php',
-					'label' => _('Triggers top 100')
-				],
-				[
-					'url' => 'auditlogs.php',
-					'label' => _('Audit'),
-					'user_type' => USER_TYPE_SUPER_ADMIN
-				],
-				[
-					'url' => 'auditacts.php',
-					'label' => _('Action log'),
-					'user_type' => USER_TYPE_SUPER_ADMIN
-				],
-				[
-					'url' => 'report4.php',
-					'label' => _('Notifications'),
-					'user_type' => USER_TYPE_ZABBIX_ADMIN
-				],
-				[
-					'url' => 'popup.php'
-				],
-				[
-					'url' => 'popup_right.php'
-				]
-			]
-		],
-		'config' => [
-			'label' => _('Configuration'),
-			'user_type' => USER_TYPE_ZABBIX_ADMIN,
-			'default_page_id' => 0,
-			'pages' => [
-				[
-					'url' => 'conf.import.php'
-				],
-				[
-					'url' => 'hostgroups.php',
-					'label' => _('Host groups')
-				],
-				[
-					'url' => 'templates.php',
-					'label' => _('Templates'),
-					'sub_pages' => [
-						'screenconf.php',
-						'screenedit.php'
-					]
-				],
-				[
-					'url' => 'hosts.php',
-					'label' => _('Hosts'),
-					'sub_pages' => [
-						'items.php',
-						'triggers.php',
-						'graphs.php',
-						'applications.php',
-						'tr_logform.php',
-						'tr_testexpr.php',
-						'popup_trexpr.php',
-						'host_discovery.php',
-						'disc_prototypes.php',
-						'trigger_prototypes.php',
-						'host_prototypes.php',
-						'httpconf.php',
-						'popup_httpstep.php'
-					]
-				],
-				[
-					'url' => 'maintenance.php',
-					'label' => _('Maintenance')
-				],
-				[
-					'url' => 'actionconf.php',
-					'label' => _('Actions')
-				],
-				[
-					'url' => 'discoveryconf.php',
-					'label' => _('Discovery')
-				],
-				[
-					'url' => 'services.php',
-					'label' => _('IT services')
-				]
-			]
-		],
-		'admin' => [
-			'label' => _('Administration'),
-			'user_type' => USER_TYPE_SUPER_ADMIN,
-			'default_page_id' => 0,
-			'pages' => [
-				[
-					'url' => 'adm.gui.php',
-					'label' => _('General'),
-					'sub_pages' => [
-						'adm.housekeeper.php',
-						'adm.images.php',
-						'adm.iconmapping.php',
-						'adm.regexps.php',
-						'adm.macros.php',
-						'adm.valuemapping.php',
-						'adm.workingtime.php',
-						'adm.triggerseverities.php',
-						'adm.triggerdisplayoptions.php',
-						'adm.other.php'
-					]
-				],
-				[
-					'url' => 'zabbix.php',
-					'action' => 'proxy.list',
-					'active_if' => ['proxy.edit', 'proxy.list'],
-					'label' => _('Proxies')
-				],
-				[
-					'url' => 'authentication.php',
-					'label' => _('Authentication')
-				],
-				[
-					'url' => 'usergrps.php',
-					'label' => _('User groups')
-				],
-				[
-					'url' => 'users.php',
-					'label' => _('Users'),
-					'sub_pages' => [
-						'popup_usrgrp.php',
-						'popup_media.php'
-					],
-				],
-				[
-					'url' => 'zabbix.php',
-					'action' => 'mediatype.list',
-					'active_if' => ['mediatype.edit', 'mediatype.list'],
-					'label' => _('Media types')
-				],
-				[
-					'url' => 'zabbix.php',
-					'action' => 'script.list',
-					'active_if' => ['script.edit', 'script.list'],
-					'label' => _('Scripts')
-				],
-				[
-					'url' => 'queue.php',
-					'label' => _('Queue')
-				]
-			]
-		],
-		'login' => [
-			'label' => _('Login'),
-			'user_type' => 0,
-			'default_page_id' => 0,
-			'pages' => [
-				[
-					'url' => 'index.php',
-					'sub_pages' => ['profile.php', 'popup_media.php']
-				]
-			]
-		]
-	];
-
-	$denied_page_requested = false;
-	$page_exists = false;
-	$deny = true;
-
-	foreach ($zbx_menu as $label => $menu) {
-		$show_menu = true;
-
-		if (isset($menu['user_type'])) {
-			$show_menu &= ($menu['user_type'] <= CWebUser::$data['type']);
-		}
-		if ($label == 'login') {
-			$show_menu = false;
-		}
-
-		$menu_class = null;
-		$sub_menus[$label] = [];
-
-		foreach ($menu['pages'] as $sub_page) {
-			$show_sub_menu = true;
-
-			// show check
-			if (!isset($sub_page['label'])) {
-				$show_sub_menu = false;
-			}
-			if (!isset($sub_page['user_type'])) {
-				$sub_page['user_type'] = $menu['user_type'];
-			}
-			if (CWebUser::$data['type'] < $sub_page['user_type']) {
-				$show_sub_menu = false;
-			}
-
-			$row = [
-				'menu_text' => array_key_exists('label', $sub_page) ? $sub_page['label'] : '',
-				'menu_url' => $sub_page['url'],
-				'menu_action' => array_key_exists('action', $sub_page) ? $sub_page['action'] : null,
-				'selected' => false
-			];
-
-			if ($action == null) {
-				$sub_menu_active = ($page['file'] == $sub_page['url']);
-
-				// Quick and dirty hack to display correct menu for templated screens.
-				if (array_key_exists('sub_pages', $sub_page)) {
-					if ((str_in_array('screenconf.php', $sub_page['sub_pages'])
-							|| str_in_array('screenedit.php', $sub_page['sub_pages']))
-								&& ($page['file'] === 'screenconf.php' || $page['file'] === 'screenedit.php')) {
-						if ($label === 'view') {
-							$sub_menu_active |= getRequest('templateid') ? false : true;
-						}
-						elseif ($label === 'config') {
-							$sub_menu_active |= getRequest('templateid') ? true : false;
-						}
-					}
-					elseif (str_in_array($page['file'], $sub_page['sub_pages'])) {
-						$sub_menu_active |= true;
-					}
-				}
-				else {
-					$sub_menu_active |= false;
-				}
-			}
-			else {
-				$sub_menu_active = array_key_exists('active_if', $sub_page) && str_in_array($action, $sub_page['active_if']);
-			}
-
-			if ($sub_menu_active) {
-				// permission check
-				$deny &= (CWebUser::$data['type'] < $menu['user_type'] || CWebUser::$data['type'] < $sub_page['user_type']);
-
-				$menu_class = 'selected';
-				$page_exists = true;
-				$page['menu'] = $label;
-				$row['selected'] = true;
-
-				if (!defined('ZBX_PAGE_NO_MENU')) {
-					CProfile::update('web.menu.'.$label.'.last', $sub_page['url'], PROFILE_TYPE_STR);
-				}
-			}
-
-			if ($show_sub_menu) {
-				$sub_menus[$label][] = $row;
-			}
-		}
-
-		if ($page_exists && $deny) {
-			$denied_page_requested = true;
-		}
-
-		if (!$show_menu) {
-			unset($sub_menus[$label]);
-			continue;
-		}
-
-		if ($sub_menus[$label][$menu['default_page_id']]['menu_action'] === null) {
-			$menu_url = $sub_menus[$label][$menu['default_page_id']]['menu_url'];
-		}
-		else {
-			$menu_url = $sub_menus[$label][$menu['default_page_id']]['menu_url'].'?action='.$sub_menus[$label][$menu['default_page_id']]['menu_action'];
-		}
-		$mmenu_entry = (new CListItem(
-			(new CLink($menu['label']))
-				->setAttribute('tabindex', 0)
-		))
-			->addClass($menu_class)
-			->setId($label);
-		$mmenu_entry->onClick('javascript: MMenu.mouseOver(\''.$label.'\');');
-		array_push($main_menu, $mmenu_entry);
-	}
-
-	if (!$page_exists && $page['type'] != PAGE_TYPE_XML && $page['type'] != PAGE_TYPE_CSV && $page['type'] != PAGE_TYPE_TEXT_FILE) {
-		$denied_page_requested = true;
-	}
+    $zbx_menu = [
+        'view'    => [
+            'label'           => _('Monitoring'),
+            'user_type'       => USER_TYPE_ZABBIX_USER,
+            'default_page_id' => 0,
+            'pages'           => [
+                [
+                    'url'       => 'zabbix.php',
+                    'action'    => 'dashboard.view',
+                    'active_if' => ['dashboard.view'],
+                    'label'     => _('Dashboard'),
+                    'sub_pages' => ['dashconf.php']
+                ],
+                [
+                    'url'   => 'overview.php',
+                    'label' => _('Overview')
+                ],
+                [
+                    'url'       => 'zabbix.php',
+                    'action'    => 'web.view',
+                    'active_if' => ['web.view'],
+                    'label'     => _('Web'),
+                    'sub_pages' => ['httpdetails.php']
+                ],
+                [
+                    'url'       => 'latest.php',
+                    'label'     => _('Latest data'),
+                    'sub_pages' => ['history.php', 'chart.php']
+                ],
+                [
+                    'url'       => 'tr_status.php',
+                    'active_if' => ['acknowledge.edit'],
+                    'label'     => _('Triggers'),
+                    'sub_pages' => ['tr_comments.php', 'chart4.php', 'scripts_exec.php']
+                ],
+                [
+                    'url'       => 'events.php',
+                    'label'     => _('Events'),
+                    'sub_pages' => ['tr_events.php']
+                ],
+                [
+                    'url'       => 'charts.php',
+                    'label'     => _('Graphs'),
+                    'sub_pages' => ['chart2.php', 'chart3.php', 'chart6.php', 'chart7.php']
+                ],
+                [
+                    'url'       => 'graphtrees.php',
+                    'label'     => _('Graphtrees'),
+                    'sub_pages' => ['graphtree.left.php', 'graphtree.right.php', "biggraph.php"]
+                ],
+                [
+                    'url'       => 'screens.php',
+                    'label'     => _('Screens'),
+                    'sub_pages' => [
+                        'screenconf.php',
+                        'screenedit.php',
+                        'screen.import.php',
+                        'slides.php',
+                        'slideconf.php'
+                    ]
+                ],
+                [
+                    'url'       => 'zabbix.php',
+                    'action'    => 'map.view',
+                    'active_if' => ['map.view'],
+                    'label'     => _('Maps'),
+                    'sub_pages' => ['image.php', 'sysmaps.php', 'sysmap.php', 'map.php', 'map.import.php']
+                ],
+                [
+                    'url'       => 'zabbix.php',
+                    'action'    => 'discovery.view',
+                    'active_if' => ['discovery.view'],
+                    'label'     => _('Discovery'),
+                    'user_type' => USER_TYPE_ZABBIX_ADMIN
+                ],
+                [
+                    'url'       => 'srv_status.php',
+                    'active_if' => ['report.services'],
+                    'label'     => _('IT services'),
+                    'sub_pages' => ['chart5.php']
+                ],
+                [
+                    'url' => 'chart3.php'
+                ],
+                [
+                    'url' => 'imgstore.php'
+                ],
+                [
+                    'url' => 'search.php'
+                ],
+                [
+                    'url' => 'jsrpc.php'
+                ]
+            ]
+        ],
+        'cm'      => [
+            'label'           => _('Inventory'),
+            'user_type'       => USER_TYPE_ZABBIX_USER,
+            'default_page_id' => 0,
+            'pages'           => [
+                [
+                    'url'   => 'hostinventoriesoverview.php',
+                    'label' => _('Overview')
+                ],
+                [
+                    'url'   => 'hostinventories.php',
+                    'label' => _('Hosts')
+                ]
+            ]
+        ],
+        'reports' => [
+            'label'           => _('Reports'),
+            'user_type'       => USER_TYPE_ZABBIX_USER,
+            'default_page_id' => 0,
+            'pages'           => [
+                [
+                    'url'       => 'zabbix.php',
+                    'action'    => 'report.status',
+                    'active_if' => ['report.status'],
+                    'label'     => _('Status of Zabbix'),
+                    'user_type' => USER_TYPE_SUPER_ADMIN
+                ],
+                [
+                    'url'   => 'report2.php',
+                    'label' => _('Availability report')
+                ],
+                [
+                    'url'   => 'toptriggers.php',
+                    'label' => _('Triggers top 100')
+                ],
+                [
+                    'url'       => 'auditlogs.php',
+                    'label'     => _('Audit'),
+                    'user_type' => USER_TYPE_SUPER_ADMIN
+                ],
+                [
+                    'url'       => 'auditacts.php',
+                    'label'     => _('Action log'),
+                    'user_type' => USER_TYPE_SUPER_ADMIN
+                ],
+                [
+                    'url'       => 'report4.php',
+                    'label'     => _('Notifications'),
+                    'user_type' => USER_TYPE_ZABBIX_ADMIN
+                ],
+                [
+                    'url' => 'popup.php'
+                ],
+                [
+                    'url' => 'popup_right.php'
+                ]
+            ]
+        ],
+        'config'  => [
+            'label'           => _('Configuration'),
+            'user_type'       => USER_TYPE_ZABBIX_ADMIN,
+            'default_page_id' => 0,
+            'pages'           => [
+                [
+                    'url' => 'conf.import.php'
+                ],
+                [
+                    'url'   => 'hostgroups.php',
+                    'label' => _('Host groups')
+                ],
+                [
+                    'url'       => 'templates.php',
+                    'label'     => _('Templates'),
+                    'sub_pages' => [
+                        'screenconf.php',
+                        'screenedit.php'
+                    ]
+                ],
+                [
+                    'url'       => 'hosts.php',
+                    'label'     => _('Hosts'),
+                    'sub_pages' => [
+                        'items.php',
+                        'triggers.php',
+                        'graphs.php',
+                        'applications.php',
+                        'tr_logform.php',
+                        'tr_testexpr.php',
+                        'popup_trexpr.php',
+                        'host_discovery.php',
+                        'disc_prototypes.php',
+                        'trigger_prototypes.php',
+                        'host_prototypes.php',
+                        'httpconf.php',
+                        'popup_httpstep.php'
+                    ]
+                ],
+                [
+                    'url'   => 'maintenance.php',
+                    'label' => _('Maintenance')
+                ],
+                [
+                    'url'   => 'actionconf.php',
+                    'label' => _('Actions')
+                ],
+                [
+                    'url'   => 'discoveryconf.php',
+                    'label' => _('Discovery')
+                ],
+                [
+                    'url'   => 'services.php',
+                    'label' => _('IT services')
+                ]
+            ]
+        ],
+        'admin'   => [
+            'label'           => _('Administration'),
+            'user_type'       => USER_TYPE_SUPER_ADMIN,
+            'default_page_id' => 0,
+            'pages'           => [
+                [
+                    'url'       => 'adm.gui.php',
+                    'label'     => _('General'),
+                    'sub_pages' => [
+                        'adm.housekeeper.php',
+                        'adm.images.php',
+                        'adm.iconmapping.php',
+                        'adm.regexps.php',
+                        'adm.macros.php',
+                        'adm.valuemapping.php',
+                        'adm.workingtime.php',
+                        'adm.triggerseverities.php',
+                        'adm.triggerdisplayoptions.php',
+                        'adm.other.php'
+                    ]
+                ],
+                [
+                    'url'       => 'zabbix.php',
+                    'action'    => 'proxy.list',
+                    'active_if' => ['proxy.edit', 'proxy.list'],
+                    'label'     => _('Proxies')
+                ],
+                [
+                    'url'   => 'authentication.php',
+                    'label' => _('Authentication')
+                ],
+                [
+                    'url'   => 'usergrps.php',
+                    'label' => _('User groups')
+                ],
+                [
+                    'url'       => 'users.php',
+                    'label'     => _('Users'),
+                    'sub_pages' => [
+                        'popup_usrgrp.php',
+                        'popup_media.php'
+                    ],
+                ],
+                [
+                    'url'       => 'zabbix.php',
+                    'action'    => 'mediatype.list',
+                    'active_if' => ['mediatype.edit', 'mediatype.list'],
+                    'label'     => _('Media types')
+                ],
+                [
+                    'url'       => 'zabbix.php',
+                    'action'    => 'script.list',
+                    'active_if' => ['script.edit', 'script.list'],
+                    'label'     => _('Scripts')
+                ],
+                [
+                    'url'   => 'queue.php',
+                    'label' => _('Queue')
+                ]
+            ]
+        ],
+        'login'   => [
+            'label'           => _('Login'),
+            'user_type'       => 0,
+            'default_page_id' => 0,
+            'pages'           => [
+                [
+                    'url'       => 'index.php',
+                    'sub_pages' => ['profile.php', 'popup_media.php']
+                ]
+            ]
+        ]
+    ];
+
+    $denied_page_requested = false;
+    $page_exists = false;
+    $deny = true;
+
+    foreach ($zbx_menu as $label => $menu) {
+        $show_menu = true;
+
+        if (isset($menu['user_type'])) {
+            $show_menu &= ($menu['user_type'] <= CWebUser::$data['type']);
+        }
+        if ($label == 'login') {
+            $show_menu = false;
+        }
+
+        $menu_class = null;
+        $sub_menus[$label] = [];
+
+        foreach ($menu['pages'] as $sub_page) {
+            $show_sub_menu = true;
+
+            // show check
+            if (!isset($sub_page['label'])) {
+                $show_sub_menu = false;
+            }
+            if (!isset($sub_page['user_type'])) {
+                $sub_page['user_type'] = $menu['user_type'];
+            }
+            if (CWebUser::$data['type'] < $sub_page['user_type']) {
+                $show_sub_menu = false;
+            }
+
+            $row = [
+                'menu_text'   => array_key_exists('label', $sub_page) ? $sub_page['label'] : '',
+                'menu_url'    => $sub_page['url'],
+                'menu_action' => array_key_exists('action', $sub_page) ? $sub_page['action'] : null,
+                'selected'    => false
+            ];
+
+            if ($action == null) {
+                $sub_menu_active = ($page['file'] == $sub_page['url']);
+
+                // Quick and dirty hack to display correct menu for templated screens.
+                if (array_key_exists('sub_pages', $sub_page)) {
+                    if ((str_in_array('screenconf.php', $sub_page['sub_pages']) || str_in_array('screenedit.php', $sub_page['sub_pages'])) && ($page['file'] === 'screenconf.php' || $page['file'] === 'screenedit.php')) {
+                        if ($label === 'view') {
+                            $sub_menu_active |= getRequest('templateid') ? false : true;
+                        } elseif ($label === 'config') {
+                            $sub_menu_active |= getRequest('templateid') ? true : false;
+                        }
+                    } elseif (str_in_array($page['file'], $sub_page['sub_pages'])) {
+                        $sub_menu_active |= true;
+                    }
+                } else {
+                    $sub_menu_active |= false;
+                }
+            } else {
+                $sub_menu_active = array_key_exists('active_if', $sub_page) && str_in_array($action, $sub_page['active_if']);
+            }
+
+            if ($sub_menu_active) {
+                // permission check
+                $deny &= (CWebUser::$data['type'] < $menu['user_type'] || CWebUser::$data['type'] < $sub_page['user_type']);
+
+                $menu_class = 'selected';
+                $page_exists = true;
+                $page['menu'] = $label;
+                $row['selected'] = true;
+
+                if (!defined('ZBX_PAGE_NO_MENU')) {
+                    CProfile::update('web.menu.' . $label . '.last', $sub_page['url'], PROFILE_TYPE_STR);
+                }
+            }
+
+            if ($show_sub_menu) {
+                $sub_menus[$label][] = $row;
+            }
+        }
+
+        if ($page_exists && $deny) {
+            $denied_page_requested = true;
+        }
+
+        if (!$show_menu) {
+            unset($sub_menus[$label]);
+            continue;
+        }
+
+        if ($sub_menus[$label][$menu['default_page_id']]['menu_action'] === null) {
+            $menu_url = $sub_menus[$label][$menu['default_page_id']]['menu_url'];
+        } else {
+            $menu_url = $sub_menus[$label][$menu['default_page_id']]['menu_url'] . '?action=' . $sub_menus[$label][$menu['default_page_id']]['menu_action'];
+        }
+        $mmenu_entry = (new CListItem((new CLink($menu['label']))->setAttribute('tabindex', 0)))->addClass($menu_class)->setId($label);
+        $mmenu_entry->onClick('javascript: MMenu.mouseOver(\'' . $label . '\');');
+        array_push($main_menu, $mmenu_entry);
+    }
+
+    if (!$page_exists && $page['type'] != PAGE_TYPE_XML && $page['type'] != PAGE_TYPE_CSV && $page['type'] != PAGE_TYPE_TEXT_FILE) {
+        $denied_page_requested = true;
+    }
 
-	return $denied_page_requested;
+    return $denied_page_requested;
 }
diff -x graphtree -Naru ./include/page_header.php graphtree/include/page_header.php
--- ./include/page_header.php	2016-02-26 17:45:47.000000000 +0800
+++ graphtree/include/page_header.php	2016-04-18 18:46:02.000000000 +0800
@@ -151,11 +151,21 @@
 			}
 		}
 	}
-	$pageHeader->addCssFile('styles/'.CHtml::encode($theme).'.css');
+
+    if(!defined('ZBX_PAGE_NO_THEME') || !ZBX_PAGE_NO_THEME){
+        $pageHeader->addCssFile('styles/'.CHtml::encode($theme).'.css');
+    }
 
 	if ($page['file'] == 'sysmap.php') {
 		$pageHeader->addCssFile('imgstore.php?css=1&output=css');
 	}
+
+	if(!empty($page['css']) && is_array($page['css'])){
+		foreach($page['css'] as $v){
+			$pageHeader->addCssFile('styles/' . $v);
+		}
+	}
+
 	$pageHeader->addJsFile('js/browsers.js');
 	$pageHeader->addJsBeforeScripts('var PHP_TZ_OFFSET = '.date('Z').';');
 
diff -x graphtree -Naru ./js/vendors/highlight.min.js graphtree/js/vendors/highlight.min.js
--- ./js/vendors/highlight.min.js	1970-01-01 08:00:00.000000000 +0800
+++ graphtree/js/vendors/highlight.min.js	2016-04-18 18:46:02.000000000 +0800
@@ -0,0 +1,34 @@
+/*
+
+Copyright 2006, Ivan Sagalaev.
+All rights reserved.
+
+Redistribution and use in source and binary forms, with or without modification,
+are permitted provided that the following conditions are met:
+
+* Redistributions of source code must retain the above copyright notice, this
+  list of conditions and the following disclaimer.
+
+* Redistributions in binary form must reproduce the above copyright notice, this
+  list of conditions and the following disclaimer in the documentation and/or
+  other materials provided with the distribution.
+
+* Neither the name of highlight.js nor the names of its contributors may be used
+  to endorse or promote products derived from this software without specific
+  prior written permission.
+
+THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS "AS IS" AND ANY
+EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
+WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+DISCLAIMED. IN NO EVENT SHALL THE REGENTS AND CONTRIBUTORS BE LIABLE FOR ANY
+DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
+(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
+LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
+ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
+SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+*/
+var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function c(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function j(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function g(t,s){var r="";for(var q=0;q<t.childNodes.length;q++){if(t.childNodes[q].nodeType==3){var p=t.childNodes[q].nodeValue;if(s){p=p.replace(/\n/g,"")}r+=p}else{if(t.childNodes[q].nodeName=="BR"){r+="\n"}else{r+=g(t.childNodes[q])}}}if(/MSIE [678]/.test(navigator.userAgent)){r=r.replace(/\r/g,"\n")}return r}function a(s){var q=s.className.split(/\s+/);q=q.concat(s.parentNode.className.split(/\s+/));for(var p=0;p<q.length;p++){var r=q[p].replace(/^language-/,"");if(d[r]||r=="no-highlight"){return r}}}function b(p){var q=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{q.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);q.push({event:"stop",offset:t,node:s.childNodes[r]})}}}return t})(p,0);return q}function l(y,z,x){var r=0;var w="";var t=[];function u(){if(y.length&&z.length){if(y[0].offset!=z[0].offset){return(y[0].offset<z[0].offset)?y:z}else{return z[0].event=="start"?y:z}}else{return y.length?y:z}}function s(C){var D="<"+C.nodeName.toLowerCase();for(var A=0;A<C.attributes.length;A++){var B=C.attributes[A];D+=" "+B.nodeName.toLowerCase();if(B.nodeValue!=undefined&&B.nodeValue!=false&&B.nodeValue!=null){D+='="'+m(B.nodeValue)+'"'}}return D+">"}while(y.length||z.length){var v=u().splice(0,1)[0];w+=m(x.substr(r,v.offset-r));r=v.offset;if(v.event=="start"){w+=s(v.node);t.push(v.node)}else{if(v.event=="stop"){var q=t.length;do{q--;var p=t[q];w+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);t.splice(q,1);while(q<t.length){w+=s(t[q]);q++}}}}w+=x.substr(r);return w}function i(){function p(u,t,v){if(u.compiled){return}if(!v){u.bR=c(t,u.b?u.b:"\\B|\\b");if(!u.e&&!u.eW){u.e="\\B|\\b"}if(u.e){u.eR=c(t,u.e)}}if(u.i){u.iR=c(t,u.i)}if(u.r==undefined){u.r=1}if(u.k){u.lR=c(t,u.l||hljs.IR,true)}for(var s in u.k){if(!u.k.hasOwnProperty(s)){continue}if(u.k[s] instanceof Object){u.kG=u.k}else{u.kG={keyword:u.k}}break}if(!u.c){u.c=[]}u.compiled=true;for(var r=0;r<u.c.length;r++){p(u.c[r],t,false)}if(u.starts){p(u.starts,t,false)}}for(var q in d){if(!d.hasOwnProperty(q)){continue}p(d[q].dM,d[q],true)}}function e(J,D){if(!i.called){i();i.called=true}function z(r,M){for(var L=0;L<M.c.length;L++){if(M.c[L].bR.test(r)){return M.c[L]}}}function w(L,r){if(C[L].e&&C[L].eR.test(r)){return 1}if(C[L].eW){var M=w(L-1,r);return M?M+1:0}return 0}function x(r,L){return L.iR&&L.iR.test(r)}function A(O,N){var M=[];for(var L=0;L<O.c.length;L++){M.push(O.c[L].b)}var r=C.length-1;do{if(C[r].e){M.push(C[r].e)}r--}while(C[r+1].eW);if(O.i){M.push(O.i)}return c(N,"("+M.join("|")+")",true)}function s(M,L){var N=C[C.length-1];if(!N.t){N.t=A(N,H)}N.t.lastIndex=L;var r=N.t.exec(M);if(r){return[M.substr(L,r.index-L),r[0],false]}else{return[M.substr(L),"",true]}}function p(O,r){var L=H.cI?r[0].toLowerCase():r[0];for(var N in O.kG){if(!O.kG.hasOwnProperty(N)){continue}var M=O.kG[N].hasOwnProperty(L);if(M){return[N,M]}}return false}function F(M,O){if(!O.k){return m(M)}var N="";var P=0;O.lR.lastIndex=0;var L=O.lR.exec(M);while(L){N+=m(M.substr(P,L.index-P));var r=p(O,L);if(r){t+=r[1];N+='<span class="'+r[0]+'">'+m(L[0])+"</span>"}else{N+=m(L[0])}P=O.lR.lastIndex;L=O.lR.exec(M)}N+=m(M.substr(P,M.length-P));return N}function K(r,M){if(M.sL&&d[M.sL]){var L=e(M.sL,r);t+=L.keyword_count;return L.value}else{return F(r,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){q+=L;M.buffer=""}else{if(M.eB){q+=m(r)+L;M.buffer=""}else{q+=L;M.buffer=r}}C.push(M);B+=M.r}function E(O,L,Q){var R=C[C.length-1];if(Q){q+=K(R.buffer+O,R);return false}var M=z(L,R);if(M){q+=K(R.buffer+O,R);I(M,L);return M.rB}var r=w(C.length-1,L);if(r){var N=R.cN?"</span>":"";if(R.rE){q+=K(R.buffer+O,R)+N}else{if(R.eE){q+=K(R.buffer+O,R)+N+m(L)}else{q+=K(R.buffer+O+L,R)+N}}while(r>1){N=C[C.length-2].cN?"</span>":"";q+=N;r--;C.length--}var P=C[C.length-1];C.length--;C[C.length-1].buffer="";if(P.starts){I(P.starts,"")}return R.rE}if(x(L,R)){throw"Illegal"}}var H=d[J];var C=[H.dM];var B=0;var t=0;var q="";try{var v=0;H.dM.buffer="";do{var y=s(D,v);var u=E(y[0],y[1],y[2]);v+=y[0].length;if(!u){v+=y[1].length}}while(!y[2]);if(C.length>1){throw"Illegal"}return{r:B,keyword_count:t,value:q}}catch(G){if(G=="Illegal"){return{r:0,keyword_count:0,value:m(D)}}else{throw G}}}function f(t){var r={keyword_count:0,r:0,value:m(t)};var q=r;for(var p in d){if(!d.hasOwnProperty(p)){continue}var s=e(p,t);s.language=p;if(s.keyword_count+s.r>q.keyword_count+q.r){q=s}if(s.keyword_count+s.r>r.keyword_count+r.r){q=r;r=s}}if(q.language){r.second_best=q}return r}function h(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function o(u,x,q){var y=g(u,q);var s=a(u);if(s=="no-highlight"){return}if(s){var w=e(s,y)}else{var w=f(y);s=w.language}var p=b(u);if(p.length){var r=document.createElement("pre");r.innerHTML=w.value;w.value=l(p,b(r),y)}w.value=h(w.value,x,q);var t=u.className;if(!t.match("(\\s|^)(language-)?"+s+"(\\s|$)")){t=t?(t+" "+s):s}if(/MSIE [678]/.test(navigator.userAgent)&&u.tagName=="CODE"&&u.parentNode.tagName=="PRE"){var r=u.parentNode;var v=document.createElement("div");v.innerHTML="<pre><code>"+w.value+"</code></pre>";u=v.firstChild.firstChild;v.firstChild.cN=r.cN;r.parentNode.replaceChild(v.firstChild,r)}else{u.innerHTML=w.value}u.className=t;u.result={language:s,kw:w.keyword_count,re:w.r};if(w.second_best){u.second_best={language:w.second_best.language,kw:w.second_best.keyword_count,re:w.second_best.r}}}function k(){if(k.called){return}k.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=j(r[p]);if(q){o(q,hljs.tabReplace)}}}function n(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",k,false);window.addEventListener("load",k,false)}else{if(window.attachEvent){window.attachEvent("onload",k)}else{window.onload=k}}}var d={};this.LANGUAGES=d;this.highlight=e;this.highlightAuto=f;this.fixMarkup=h;this.highlightBlock=o;this.initHighlighting=k;this.initHighlightingOnLoad=n;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0x[A-Za-z0-9]+|\\d+(\\.\\d+)?)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.inherit=function(p,s){var r={};for(var q in p){r[q]=p[q]}if(s){for(var q in s){r[q]=s[q]}}return r}}();hljs.LANGUAGES.javascript={dM:{k:{keyword:{"in":1,"if":1,"for":1,"while":1,"finally":1,"var":1,"new":1,"function":1,"do":1,"return":1,"void":1,"else":1,"break":1,"catch":1,"instanceof":1,"with":1,"throw":1,"case":1,"default":1,"try":1,"this":1,"switch":1,"continue":1,"typeof":1,"delete":1},literal:{"true":1,"false":1,"null":1}},c:[hljs.ASM,hljs.QSM,hljs.CLCM,hljs.CBLCLM,hljs.CNM,{b:"("+hljs.RSR+"|case|return|throw)\\s*",k:{"return":1,"throw":1,"case":1},c:[hljs.CLCM,hljs.CBLCLM,{cN:"regexp",b:"/",e:"/[gim]*",c:[{b:"\\\\/"}]}],r:0},{cN:"function",b:"\\bfunction\\b",e:"{",k:{"function":1},c:[{cN:"title",b:"[A-Za-z$_][0-9A-Za-z$_]*"},{cN:"params",b:"\\(",e:"\\)",c:[hljs.ASM,hljs.QSM,hljs.CLCM,hljs.CBLCLM]}]}]}};hljs.LANGUAGES.css=function(){var a={cN:"function",b:hljs.IR+"\\(",e:"\\)",c:[{eW:true,eE:true,c:[hljs.NM,hljs.ASM,hljs.QSM]}]};return{cI:true,dM:{i:"[=/|']",c:[hljs.CBLCLM,{cN:"id",b:"\\#[A-Za-z0-9_-]+"},{cN:"class",b:"\\.[A-Za-z0-9_-]+",r:0},{cN:"attr_selector",b:"\\[",e:"\\]",i:"$"},{cN:"pseudo",b:":(:)?[a-zA-Z0-9\\_\\-\\+\\(\\)\\\"\\']+"},{cN:"at_rule",b:"@(font-face|page)",l:"[a-z-]+",k:{"font-face":1,page:1}},{cN:"at_rule",b:"@",e:"[{;]",eE:true,k:{"import":1,page:1,media:1,charset:1},c:[a,hljs.ASM,hljs.QSM,hljs.NM]},{cN:"tag",b:hljs.IR,r:0},{cN:"rules",b:"{",e:"}",i:"[^\\s]",r:0,c:[hljs.CBLCLM,{cN:"rule",b:"[^\\s]",rB:true,e:";",eW:true,c:[{cN:"attribute",b:"[A-Z\\_\\.\\-]+",e:":",eE:true,i:"[^\\s]",starts:{cN:"value",eW:true,eE:true,c:[a,hljs.NM,hljs.QSM,hljs.ASM,hljs.CBLCLM,{cN:"hexcolor",b:"\\#[0-9A-F]+"},{cN:"important",b:"!important"}]}}]}]}]}}}();hljs.LANGUAGES.xml=function(){var b="[A-Za-z0-9\\._:-]+";var a={eW:true,c:[{cN:"attribute",b:b,r:0},{b:'="',rB:true,e:'"',c:[{cN:"value",b:'"',eW:true}]},{b:"='",rB:true,e:"'",c:[{cN:"value",b:"'",eW:true}]},{b:"=",c:[{cN:"value",b:"[^\\s/>]+"}]}]};return{cI:true,dM:{c:[{cN:"pi",b:"<\\?",e:"\\?>",r:10},{cN:"doctype",b:"<!DOCTYPE",e:">",r:10,c:[{b:"\\[",e:"\\]"}]},{cN:"comment",b:"<!--",e:"-->",r:10},{cN:"cdata",b:"<\\!\\[CDATA\\[",e:"\\]\\]>",r:10},{cN:"tag",b:"<style",e:">",k:{title:{style:1}},c:[a],starts:{cN:"css",e:"</style>",rE:true,sL:"css"}},{cN:"tag",b:"<script",e:">",k:{title:{script:1}},c:[a],starts:{cN:"javascript",e:"<\/script>",rE:true,sL:"javascript"}},{cN:"vbscript",b:"<%",e:"%>",sL:"vbscript"},{cN:"tag",b:"</?",e:"/?>",c:[{cN:"title",b:"[^ />]+"},a]}]}}}();
+d3.selectAll("code:not([class])").classed("javascript", 1);
+d3.selectAll("code").each(function() { hljs.highlightBlock(this); });
diff -x graphtree -Naru ./js/vendors/jquery.ztree.core-3.5.js graphtree/js/vendors/jquery.ztree.core-3.5.js
--- ./js/vendors/jquery.ztree.core-3.5.js	1970-01-01 08:00:00.000000000 +0800
+++ graphtree/js/vendors/jquery.ztree.core-3.5.js	2016-04-18 18:46:02.000000000 +0800
@@ -0,0 +1,1671 @@
+/*
+ * JQuery zTree core 3.5.13
+ * http://zTree.me/
+ *
+ * Copyright (c) 2010 Hunter.z
+ *
+ * Licensed same as jquery - MIT License
+ * http://www.opensource.org/licenses/mit-license.php
+ *
+ * email: hunter.z@263.net
+ * Date: 2013-06-02
+ */
+(function($){
+	var settings = {}, roots = {}, caches = {},
+	//default consts of core
+	_consts = {
+		className: {
+			BUTTON: "button",
+			LEVEL: "level",
+			ICO_LOADING: "ico_loading",
+			SWITCH: "switch"
+		},
+		event: {
+			NODECREATED: "ztree_nodeCreated",
+			CLICK: "ztree_click",
+			EXPAND: "ztree_expand",
+			COLLAPSE: "ztree_collapse",
+			ASYNC_SUCCESS: "ztree_async_success",
+			ASYNC_ERROR: "ztree_async_error"
+		},
+		id: {
+			A: "_a",
+			ICON: "_ico",
+			SPAN: "_span",
+			SWITCH: "_switch",
+			UL: "_ul"
+		},
+		line: {
+			ROOT: "root",
+			ROOTS: "roots",
+			CENTER: "center",
+			BOTTOM: "bottom",
+			NOLINE: "noline",
+			LINE: "line"
+		},
+		folder: {
+			OPEN: "open",
+			CLOSE: "close",
+			DOCU: "docu"
+		},
+		node: {
+			CURSELECTED: "curSelectedNode"
+		}
+	},
+	//default setting of core
+	_setting = {
+		treeId: "",
+		treeObj: null,
+		view: {
+			addDiyDom: null,
+			autoCancelSelected: true,
+			dblClickExpand: true,
+			expandSpeed: "fast",
+			fontCss: {},
+			nameIsHTML: false,
+			selectedMulti: true,
+			showIcon: true,
+			showLine: true,
+			showTitle: true
+		},
+		data: {
+			key: {
+				children: "children",
+				name: "name",
+				title: "",
+				url: "url"
+			},
+			simpleData: {
+				enable: false,
+				idKey: "id",
+				pIdKey: "pId",
+				rootPId: null
+			},
+			keep: {
+				parent: false,
+				leaf: false
+			}
+		},
+		async: {
+			enable: false,
+			contentType: "application/x-www-form-urlencoded",
+			type: "post",
+			dataType: "text",
+			url: "",
+			autoParam: [],
+			otherParam: [],
+			dataFilter: null
+		},
+		callback: {
+			beforeAsync:null,
+			beforeClick:null,
+			beforeDblClick:null,
+			beforeRightClick:null,
+			beforeMouseDown:null,
+			beforeMouseUp:null,
+			beforeExpand:null,
+			beforeCollapse:null,
+			beforeRemove:null,
+
+			onAsyncError:null,
+			onAsyncSuccess:null,
+			onNodeCreated:null,
+			onClick:null,
+			onDblClick:null,
+			onRightClick:null,
+			onMouseDown:null,
+			onMouseUp:null,
+			onExpand:null,
+			onCollapse:null,
+			onRemove:null
+		}
+	},
+	//default root of core
+	//zTree use root to save full data
+	_initRoot = function (setting) {
+		var r = data.getRoot(setting);
+		if (!r) {
+			r = {};
+			data.setRoot(setting, r);
+		}
+		r[setting.data.key.children] = [];
+		r.expandTriggerFlag = false;
+		r.curSelectedList = [];
+		r.noSelection = true;
+		r.createdNodes = [];
+		r.zId = 0;
+		r._ver = (new Date()).getTime();
+	},
+	//default cache of core
+	_initCache = function(setting) {
+		var c = data.getCache(setting);
+		if (!c) {
+			c = {};
+			data.setCache(setting, c);
+		}
+		c.nodes = [];
+		c.doms = [];
+	},
+	//default bindEvent of core
+	_bindEvent = function(setting) {
+		var o = setting.treeObj,
+		c = consts.event;
+		o.bind(c.NODECREATED, function (event, treeId, node) {
+			tools.apply(setting.callback.onNodeCreated, [event, treeId, node]);
+		});
+
+		o.bind(c.CLICK, function (event, srcEvent, treeId, node, clickFlag) {
+			tools.apply(setting.callback.onClick, [srcEvent, treeId, node, clickFlag]);
+		});
+
+		o.bind(c.EXPAND, function (event, treeId, node) {
+			tools.apply(setting.callback.onExpand, [event, treeId, node]);
+		});
+
+		o.bind(c.COLLAPSE, function (event, treeId, node) {
+			tools.apply(setting.callback.onCollapse, [event, treeId, node]);
+		});
+
+		o.bind(c.ASYNC_SUCCESS, function (event, treeId, node, msg) {
+			tools.apply(setting.callback.onAsyncSuccess, [event, treeId, node, msg]);
+		});
+
+		o.bind(c.ASYNC_ERROR, function (event, treeId, node, XMLHttpRequest, textStatus, errorThrown) {
+			tools.apply(setting.callback.onAsyncError, [event, treeId, node, XMLHttpRequest, textStatus, errorThrown]);
+		});
+	},
+	_unbindEvent = function(setting) {
+		var o = setting.treeObj,
+		c = consts.event;
+		o.unbind(c.NODECREATED)
+		.unbind(c.CLICK)
+		.unbind(c.EXPAND)
+		.unbind(c.COLLAPSE)
+		.unbind(c.ASYNC_SUCCESS)
+		.unbind(c.ASYNC_ERROR);
+	},
+	//default event proxy of core
+	_eventProxy = function(event) {
+		var target = event.target,
+		setting = data.getSetting(event.data.treeId),
+		tId = "", node = null,
+		nodeEventType = "", treeEventType = "",
+		nodeEventCallback = null, treeEventCallback = null,
+		tmp = null;
+
+		if (tools.eqs(event.type, "mousedown")) {
+			treeEventType = "mousedown";
+		} else if (tools.eqs(event.type, "mouseup")) {
+			treeEventType = "mouseup";
+		} else if (tools.eqs(event.type, "contextmenu")) {
+			treeEventType = "contextmenu";
+		} else if (tools.eqs(event.type, "click")) {
+			if (tools.eqs(target.tagName, "span") && target.getAttribute("treeNode"+ consts.id.SWITCH) !== null) {
+				tId = tools.getNodeMainDom(target).id;
+				nodeEventType = "switchNode";
+			} else {
+				tmp = tools.getMDom(setting, target, [{tagName:"a", attrName:"treeNode"+consts.id.A}]);
+				if (tmp) {
+					tId = tools.getNodeMainDom(tmp).id;
+					nodeEventType = "clickNode";
+				}
+			}
+		} else if (tools.eqs(event.type, "dblclick")) {
+			treeEventType = "dblclick";
+			tmp = tools.getMDom(setting, target, [{tagName:"a", attrName:"treeNode"+consts.id.A}]);
+			if (tmp) {
+				tId = tools.getNodeMainDom(tmp).id;
+				nodeEventType = "switchNode";
+			}
+		}
+		if (treeEventType.length > 0 && tId.length == 0) {
+			tmp = tools.getMDom(setting, target, [{tagName:"a", attrName:"treeNode"+consts.id.A}]);
+			if (tmp) {tId = tools.getNodeMainDom(tmp).id;}
+		}
+		// event to node
+		if (tId.length>0) {
+			node = data.getNodeCache(setting, tId);
+			switch (nodeEventType) {
+				case "switchNode" :
+					if (!node.isParent) {
+						nodeEventType = "";
+					} else if (tools.eqs(event.type, "click")
+						|| (tools.eqs(event.type, "dblclick") && tools.apply(setting.view.dblClickExpand, [setting.treeId, node], setting.view.dblClickExpand))) {
+						nodeEventCallback = handler.onSwitchNode;
+					} else {
+						nodeEventType = "";
+					}
+					break;
+				case "clickNode" :
+					nodeEventCallback = handler.onClickNode;
+					break;
+			}
+		}
+		// event to zTree
+		switch (treeEventType) {
+			case "mousedown" :
+				treeEventCallback = handler.onZTreeMousedown;
+				break;
+			case "mouseup" :
+				treeEventCallback = handler.onZTreeMouseup;
+				break;
+			case "dblclick" :
+				treeEventCallback = handler.onZTreeDblclick;
+				break;
+			case "contextmenu" :
+				treeEventCallback = handler.onZTreeContextmenu;
+				break;
+		}
+		var proxyResult = {
+			stop: false,
+			node: node,
+			nodeEventType: nodeEventType,
+			nodeEventCallback: nodeEventCallback,
+			treeEventType: treeEventType,
+			treeEventCallback: treeEventCallback
+		};
+		return proxyResult
+	},
+	//default init node of core
+	_initNode = function(setting, level, n, parentNode, isFirstNode, isLastNode, openFlag) {
+		if (!n) return;
+		var r = data.getRoot(setting),
+		childKey = setting.data.key.children;
+		n.level = level;
+		n.tId = setting.treeId + "_" + (++r.zId);
+		n.parentTId = parentNode ? parentNode.tId : null;
+		if (n[childKey] && n[childKey].length > 0) {
+			if (typeof n.open == "string") n.open = tools.eqs(n.open, "true");
+			n.open = !!n.open;
+			n.isParent = true;
+			n.zAsync = true;
+		} else {
+			n.open = false;
+			if (typeof n.isParent == "string") n.isParent = tools.eqs(n.isParent, "true");
+			n.isParent = !!n.isParent;
+			n.zAsync = !n.isParent;
+		}
+		n.isFirstNode = isFirstNode;
+		n.isLastNode = isLastNode;
+		n.getParentNode = function() {return data.getNodeCache(setting, n.parentTId);};
+		n.getPreNode = function() {return data.getPreNode(setting, n);};
+		n.getNextNode = function() {return data.getNextNode(setting, n);};
+		n.isAjaxing = false;
+		data.fixPIdKeyValue(setting, n);
+	},
+	_init = {
+		bind: [_bindEvent],
+		unbind: [_unbindEvent],
+		caches: [_initCache],
+		nodes: [_initNode],
+		proxys: [_eventProxy],
+		roots: [_initRoot],
+		beforeA: [],
+		afterA: [],
+		innerBeforeA: [],
+		innerAfterA: [],
+		zTreeTools: []
+	},
+	//method of operate data
+	data = {
+		addNodeCache: function(setting, node) {
+			data.getCache(setting).nodes[data.getNodeCacheId(node.tId)] = node;
+		},
+		getNodeCacheId: function(tId) {
+			return tId.substring(tId.lastIndexOf("_")+1);
+		},
+		addAfterA: function(afterA) {
+			_init.afterA.push(afterA);
+		},
+		addBeforeA: function(beforeA) {
+			_init.beforeA.push(beforeA);
+		},
+		addInnerAfterA: function(innerAfterA) {
+			_init.innerAfterA.push(innerAfterA);
+		},
+		addInnerBeforeA: function(innerBeforeA) {
+			_init.innerBeforeA.push(innerBeforeA);
+		},
+		addInitBind: function(bindEvent) {
+			_init.bind.push(bindEvent);
+		},
+		addInitUnBind: function(unbindEvent) {
+			_init.unbind.push(unbindEvent);
+		},
+		addInitCache: function(initCache) {
+			_init.caches.push(initCache);
+		},
+		addInitNode: function(initNode) {
+			_init.nodes.push(initNode);
+		},
+		addInitProxy: function(initProxy, isFirst) {
+			if (!!isFirst) {
+				_init.proxys.splice(0,0,initProxy);
+			} else {
+				_init.proxys.push(initProxy);
+			}
+		},
+		addInitRoot: function(initRoot) {
+			_init.roots.push(initRoot);
+		},
+		addNodesData: function(setting, parentNode, nodes) {
+			var childKey = setting.data.key.children;
+			if (!parentNode[childKey]) parentNode[childKey] = [];
+			if (parentNode[childKey].length > 0) {
+				parentNode[childKey][parentNode[childKey].length - 1].isLastNode = false;
+				view.setNodeLineIcos(setting, parentNode[childKey][parentNode[childKey].length - 1]);
+			}
+			parentNode.isParent = true;
+			parentNode[childKey] = parentNode[childKey].concat(nodes);
+		},
+		addSelectedNode: function(setting, node) {
+			var root = data.getRoot(setting);
+			if (!data.isSelectedNode(setting, node)) {
+				root.curSelectedList.push(node);
+			}
+		},
+		addCreatedNode: function(setting, node) {
+			if (!!setting.callback.onNodeCreated || !!setting.view.addDiyDom) {
+				var root = data.getRoot(setting);
+				root.createdNodes.push(node);
+			}
+		},
+		addZTreeTools: function(zTreeTools) {
+			_init.zTreeTools.push(zTreeTools);
+		},
+		exSetting: function(s) {
+			$.extend(true, _setting, s);
+		},
+		fixPIdKeyValue: function(setting, node) {
+			if (setting.data.simpleData.enable) {
+				node[setting.data.simpleData.pIdKey] = node.parentTId ? node.getParentNode()[setting.data.simpleData.idKey] : setting.data.simpleData.rootPId;
+			}
+		},
+		getAfterA: function(setting, node, array) {
+			for (var i=0, j=_init.afterA.length; i<j; i++) {
+				_init.afterA[i].apply(this, arguments);
+			}
+		},
+		getBeforeA: function(setting, node, array) {
+			for (var i=0, j=_init.beforeA.length; i<j; i++) {
+				_init.beforeA[i].apply(this, arguments);
+			}
+		},
+		getInnerAfterA: function(setting, node, array) {
+			for (var i=0, j=_init.innerAfterA.length; i<j; i++) {
+				_init.innerAfterA[i].apply(this, arguments);
+			}
+		},
+		getInnerBeforeA: function(setting, node, array) {
+			for (var i=0, j=_init.innerBeforeA.length; i<j; i++) {
+				_init.innerBeforeA[i].apply(this, arguments);
+			}
+		},
+		getCache: function(setting) {
+			return caches[setting.treeId];
+		},
+		getNextNode: function(setting, node) {
+			if (!node) return null;
+			var childKey = setting.data.key.children,
+			p = node.parentTId ? node.getParentNode() : data.getRoot(setting);
+			for (var i=0, l=p[childKey].length-1; i<=l; i++) {
+				if (p[childKey][i] === node) {
+					return (i==l ? null : p[childKey][i+1]);
+				}
+			}
+			return null;
+		},
+		getNodeByParam: function(setting, nodes, key, value) {
+			if (!nodes || !key) return null;
+			var childKey = setting.data.key.children;
+			for (var i = 0, l = nodes.length; i < l; i++) {
+				if (nodes[i][key] == value) {
+					return nodes[i];
+				}
+				var tmp = data.getNodeByParam(setting, nodes[i][childKey], key, value);
+				if (tmp) return tmp;
+			}
+			return null;
+		},
+		getNodeCache: function(setting, tId) {
+			if (!tId) return null;
+			var n = caches[setting.treeId].nodes[data.getNodeCacheId(tId)];
+			return n ? n : null;
+		},
+		getNodeName: function(setting, node) {
+			var nameKey = setting.data.key.name;
+			return "" + node[nameKey];
+		},
+		getNodeTitle: function(setting, node) {
+			var t = setting.data.key.title === "" ? setting.data.key.name : setting.data.key.title;
+			return "" + node[t];
+		},
+		getNodes: function(setting) {
+			return data.getRoot(setting)[setting.data.key.children];
+		},
+		getNodesByParam: function(setting, nodes, key, value) {
+			if (!nodes || !key) return [];
+			var childKey = setting.data.key.children,
+			result = [];
+			for (var i = 0, l = nodes.length; i < l; i++) {
+				if (nodes[i][key] == value) {
+					result.push(nodes[i]);
+				}
+				result = result.concat(data.getNodesByParam(setting, nodes[i][childKey], key, value));
+			}
+			return result;
+		},
+		getNodesByParamFuzzy: function(setting, nodes, key, value) {
+			if (!nodes || !key) return [];
+			var childKey = setting.data.key.children,
+			result = [];
+			value = value.toLowerCase();
+			for (var i = 0, l = nodes.length; i < l; i++) {
+				if (typeof nodes[i][key] == "string" && nodes[i][key].toLowerCase().indexOf(value)>-1) {
+					result.push(nodes[i]);
+				}
+				result = result.concat(data.getNodesByParamFuzzy(setting, nodes[i][childKey], key, value));
+			}
+			return result;
+		},
+		getNodesByFilter: function(setting, nodes, filter, isSingle, invokeParam) {
+			if (!nodes) return (isSingle ? null : []);
+			var childKey = setting.data.key.children,
+			result = isSingle ? null : [];
+			for (var i = 0, l = nodes.length; i < l; i++) {
+				if (tools.apply(filter, [nodes[i], invokeParam], false)) {
+					if (isSingle) {return nodes[i];}
+					result.push(nodes[i]);
+				}
+				var tmpResult = data.getNodesByFilter(setting, nodes[i][childKey], filter, isSingle, invokeParam);
+				if (isSingle && !!tmpResult) {return tmpResult;}
+				result = isSingle ? tmpResult : result.concat(tmpResult);
+			}
+			return result;
+		},
+		getPreNode: function(setting, node) {
+			if (!node) return null;
+			var childKey = setting.data.key.children,
+			p = node.parentTId ? node.getParentNode() : data.getRoot(setting);
+			for (var i=0, l=p[childKey].length; i<l; i++) {
+				if (p[childKey][i] === node) {
+					return (i==0 ? null : p[childKey][i-1]);
+				}
+			}
+			return null;
+		},
+		getRoot: function(setting) {
+			return setting ? roots[setting.treeId] : null;
+		},
+		getRoots: function() {
+			return roots;
+		},
+		getSetting: function(treeId) {
+			return settings[treeId];
+		},
+		getSettings: function() {
+			return settings;
+		},
+		getZTreeTools: function(treeId) {
+			var r = this.getRoot(this.getSetting(treeId));
+			return r ? r.treeTools : null;
+		},
+		initCache: function(setting) {
+			for (var i=0, j=_init.caches.length; i<j; i++) {
+				_init.caches[i].apply(this, arguments);
+			}
+		},
+		initNode: function(setting, level, node, parentNode, preNode, nextNode) {
+			for (var i=0, j=_init.nodes.length; i<j; i++) {
+				_init.nodes[i].apply(this, arguments);
+			}
+		},
+		initRoot: function(setting) {
+			for (var i=0, j=_init.roots.length; i<j; i++) {
+				_init.roots[i].apply(this, arguments);
+			}
+		},
+		isSelectedNode: function(setting, node) {
+			var root = data.getRoot(setting);
+			for (var i=0, j=root.curSelectedList.length; i<j; i++) {
+				if(node === root.curSelectedList[i]) return true;
+			}
+			return false;
+		},
+		removeNodeCache: function(setting, node) {
+			var childKey = setting.data.key.children;
+			if (node[childKey]) {
+				for (var i=0, l=node[childKey].length; i<l; i++) {
+					arguments.callee(setting, node[childKey][i]);
+				}
+			}
+			data.getCache(setting).nodes[data.getNodeCacheId(node.tId)] = null;
+		},
+		removeSelectedNode: function(setting, node) {
+			var root = data.getRoot(setting);
+			for (var i=0, j=root.curSelectedList.length; i<j; i++) {
+				if(node === root.curSelectedList[i] || !data.getNodeCache(setting, root.curSelectedList[i].tId)) {
+					root.curSelectedList.splice(i, 1);
+					i--;j--;
+				}
+			}
+		},
+		setCache: function(setting, cache) {
+			caches[setting.treeId] = cache;
+		},
+		setRoot: function(setting, root) {
+			roots[setting.treeId] = root;
+		},
+		setZTreeTools: function(setting, zTreeTools) {
+			for (var i=0, j=_init.zTreeTools.length; i<j; i++) {
+				_init.zTreeTools[i].apply(this, arguments);
+			}
+		},
+		transformToArrayFormat: function (setting, nodes) {
+			if (!nodes) return [];
+			var childKey = setting.data.key.children,
+			r = [];
+			if (tools.isArray(nodes)) {
+				for (var i=0, l=nodes.length; i<l; i++) {
+					r.push(nodes[i]);
+					if (nodes[i][childKey])
+						r = r.concat(data.transformToArrayFormat(setting, nodes[i][childKey]));
+				}
+			} else {
+				r.push(nodes);
+				if (nodes[childKey])
+					r = r.concat(data.transformToArrayFormat(setting, nodes[childKey]));
+			}
+			return r;
+		},
+		transformTozTreeFormat: function(setting, sNodes) {
+			var i,l,
+			key = setting.data.simpleData.idKey,
+			parentKey = setting.data.simpleData.pIdKey,
+			childKey = setting.data.key.children;
+			if (!key || key=="" || !sNodes) return [];
+
+			if (tools.isArray(sNodes)) {
+				var r = [];
+				var tmpMap = [];
+				for (i=0, l=sNodes.length; i<l; i++) {
+					tmpMap[sNodes[i][key]] = sNodes[i];
+				}
+				for (i=0, l=sNodes.length; i<l; i++) {
+					if (tmpMap[sNodes[i][parentKey]] && sNodes[i][key] != sNodes[i][parentKey]) {
+						if (!tmpMap[sNodes[i][parentKey]][childKey])
+							tmpMap[sNodes[i][parentKey]][childKey] = [];
+						tmpMap[sNodes[i][parentKey]][childKey].push(sNodes[i]);
+					} else {
+						r.push(sNodes[i]);
+					}
+				}
+				return r;
+			}else {
+				return [sNodes];
+			}
+		}
+	},
+	//method of event proxy
+	event = {
+		bindEvent: function(setting) {
+			for (var i=0, j=_init.bind.length; i<j; i++) {
+				_init.bind[i].apply(this, arguments);
+			}
+		},
+		unbindEvent: function(setting) {
+			for (var i=0, j=_init.unbind.length; i<j; i++) {
+				_init.unbind[i].apply(this, arguments);
+			}
+		},
+		bindTree: function(setting) {
+			var eventParam = {
+				treeId: setting.treeId
+			},
+			o = setting.treeObj;
+			// for can't select text
+			o.bind('selectstart', function(e){
+					var n = e.originalEvent.srcElement.nodeName.toLowerCase();
+					return (n === "input" || n === "textarea" );
+			}).css({
+				"-moz-user-select":"-moz-none"
+			});
+			o.bind('click', eventParam, event.proxy);
+			o.bind('dblclick', eventParam, event.proxy);
+			o.bind('mouseover', eventParam, event.proxy);
+			o.bind('mouseout', eventParam, event.proxy);
+			o.bind('mousedown', eventParam, event.proxy);
+			o.bind('mouseup', eventParam, event.proxy);
+			o.bind('contextmenu', eventParam, event.proxy);
+		},
+		unbindTree: function(setting) {
+			var o = setting.treeObj;
+			o.unbind('click', event.proxy)
+			.unbind('dblclick', event.proxy)
+			.unbind('mouseover', event.proxy)
+			.unbind('mouseout', event.proxy)
+			.unbind('mousedown', event.proxy)
+			.unbind('mouseup', event.proxy)
+			.unbind('contextmenu', event.proxy);
+		},
+		doProxy: function(e) {
+			var results = [];
+			for (var i=0, j=_init.proxys.length; i<j; i++) {
+				var proxyResult = _init.proxys[i].apply(this, arguments);
+				results.push(proxyResult);
+				if (proxyResult.stop) {
+					break;
+				}
+			}
+			return results;
+		},
+		proxy: function(e) {
+			var setting = data.getSetting(e.data.treeId);
+			if (!tools.uCanDo(setting, e)) return true;
+			var results = event.doProxy(e),
+			r = true, x = false;
+			for (var i=0, l=results.length; i<l; i++) {
+				var proxyResult = results[i];
+				if (proxyResult.nodeEventCallback) {
+					x = true;
+					r = proxyResult.nodeEventCallback.apply(proxyResult, [e, proxyResult.node]) && r;
+				}
+				if (proxyResult.treeEventCallback) {
+					x = true;
+					r = proxyResult.treeEventCallback.apply(proxyResult, [e, proxyResult.node]) && r;
+				}
+			}
+			return r;
+		}
+	},
+	//method of event handler
+	handler = {
+		onSwitchNode: function (event, node) {
+			var setting = data.getSetting(event.data.treeId);
+			if (node.open) {
+				if (tools.apply(setting.callback.beforeCollapse, [setting.treeId, node], true) == false) return true;
+				data.getRoot(setting).expandTriggerFlag = true;
+				view.switchNode(setting, node);
+			} else {
+				if (tools.apply(setting.callback.beforeExpand, [setting.treeId, node], true) == false) return true;
+				data.getRoot(setting).expandTriggerFlag = true;
+				view.switchNode(setting, node);
+			}
+			return true;
+		},
+		onClickNode: function (event, node) {
+			var setting = data.getSetting(event.data.treeId),
+			clickFlag = ( (setting.view.autoCancelSelected && event.ctrlKey) && data.isSelectedNode(setting, node)) ? 0 : (setting.view.autoCancelSelected && event.ctrlKey && setting.view.selectedMulti) ? 2 : 1;
+			if (tools.apply(setting.callback.beforeClick, [setting.treeId, node, clickFlag], true) == false) return true;
+			if (clickFlag === 0) {
+				view.cancelPreSelectedNode(setting, node);
+			} else {
+				view.selectNode(setting, node, clickFlag === 2);
+			}
+			setting.treeObj.trigger(consts.event.CLICK, [event, setting.treeId, node, clickFlag]);
+			return true;
+		},
+		onZTreeMousedown: function(event, node) {
+			var setting = data.getSetting(event.data.treeId);
+			if (tools.apply(setting.callback.beforeMouseDown, [setting.treeId, node], true)) {
+				tools.apply(setting.callback.onMouseDown, [event, setting.treeId, node]);
+			}
+			return true;
+		},
+		onZTreeMouseup: function(event, node) {
+			var setting = data.getSetting(event.data.treeId);
+			if (tools.apply(setting.callback.beforeMouseUp, [setting.treeId, node], true)) {
+				tools.apply(setting.callback.onMouseUp, [event, setting.treeId, node]);
+			}
+			return true;
+		},
+		onZTreeDblclick: function(event, node) {
+			var setting = data.getSetting(event.data.treeId);
+			if (tools.apply(setting.callback.beforeDblClick, [setting.treeId, node], true)) {
+				tools.apply(setting.callback.onDblClick, [event, setting.treeId, node]);
+			}
+			return true;
+		},
+		onZTreeContextmenu: function(event, node) {
+			var setting = data.getSetting(event.data.treeId);
+			if (tools.apply(setting.callback.beforeRightClick, [setting.treeId, node], true)) {
+				tools.apply(setting.callback.onRightClick, [event, setting.treeId, node]);
+			}
+			return (typeof setting.callback.onRightClick) != "function";
+		}
+	},
+	//method of tools for zTree
+	tools = {
+		apply: function(fun, param, defaultValue) {
+			if ((typeof fun) == "function") {
+				return fun.apply(zt, param?param:[]);
+			}
+			return defaultValue;
+		},
+		canAsync: function(setting, node) {
+			var childKey = setting.data.key.children;
+			return (setting.async.enable && node && node.isParent && !(node.zAsync || (node[childKey] && node[childKey].length > 0)));
+		},
+		clone: function (obj){
+			if (obj === null) return null;
+			var o = tools.isArray(obj) ? [] : {};
+			for(var i in obj){
+				o[i] = (obj[i] instanceof Date) ? new Date(obj[i].getTime()) : (typeof obj[i] === "object" ? arguments.callee(obj[i]) : obj[i]);
+			}
+			return o;
+		},
+		eqs: function(str1, str2) {
+			return str1.toLowerCase() === str2.toLowerCase();
+		},
+		isArray: function(arr) {
+			return Object.prototype.toString.apply(arr) === "[object Array]";
+		},
+		$: function(node, exp, setting) {
+			if (!!exp && typeof exp != "string") {
+				setting = exp;
+				exp = "";
+			}
+			if (typeof node == "string") {
+				return $(node, setting ? setting.treeObj.get(0).ownerDocument : null);
+			} else {
+				return $("#" + node.tId + exp, setting ? setting.treeObj : null);
+			}
+		},
+		getMDom: function (setting, curDom, targetExpr) {
+			if (!curDom) return null;
+			while (curDom && curDom.id !== setting.treeId) {
+				for (var i=0, l=targetExpr.length; curDom.tagName && i<l; i++) {
+					if (tools.eqs(curDom.tagName, targetExpr[i].tagName) && curDom.getAttribute(targetExpr[i].attrName) !== null) {
+						return curDom;
+					}
+				}
+				curDom = curDom.parentNode;
+			}
+			return null;
+		},
+		getNodeMainDom:function(target) {
+			return ($(target).parent("li").get(0) || $(target).parentsUntil("li").parent().get(0));
+		},
+		uCanDo: function(setting, e) {
+			return true;
+		}
+	},
+	//method of operate ztree dom
+	view = {
+		addNodes: function(setting, parentNode, newNodes, isSilent) {
+			if (setting.data.keep.leaf && parentNode && !parentNode.isParent) {
+				return;
+			}
+			if (!tools.isArray(newNodes)) {
+				newNodes = [newNodes];
+			}
+			if (setting.data.simpleData.enable) {
+				newNodes = data.transformTozTreeFormat(setting, newNodes);
+			}
+			if (parentNode) {
+				var target_switchObj = $$(parentNode, consts.id.SWITCH, setting),
+				target_icoObj = $$(parentNode, consts.id.ICON, setting),
+				target_ulObj = $$(parentNode, consts.id.UL, setting);
+
+				if (!parentNode.open) {
+					view.replaceSwitchClass(parentNode, target_switchObj, consts.folder.CLOSE);
+					view.replaceIcoClass(parentNode, target_icoObj, consts.folder.CLOSE);
+					parentNode.open = false;
+					target_ulObj.css({
+						"display": "none"
+					});
+				}
+
+				data.addNodesData(setting, parentNode, newNodes);
+				view.createNodes(setting, parentNode.level + 1, newNodes, parentNode);
+				if (!isSilent) {
+					view.expandCollapseParentNode(setting, parentNode, true);
+				}
+			} else {
+				data.addNodesData(setting, data.getRoot(setting), newNodes);
+				view.createNodes(setting, 0, newNodes, null);
+			}
+		},
+		appendNodes: function(setting, level, nodes, parentNode, initFlag, openFlag) {
+			if (!nodes) return [];
+			var html = [],
+			childKey = setting.data.key.children;
+			for (var i = 0, l = nodes.length; i < l; i++) {
+				var node = nodes[i];
+				if (initFlag) {
+					var tmpPNode = (parentNode) ? parentNode: data.getRoot(setting),
+					tmpPChild = tmpPNode[childKey],
+					isFirstNode = ((tmpPChild.length == nodes.length) && (i == 0)),
+					isLastNode = (i == (nodes.length - 1));
+					data.initNode(setting, level, node, parentNode, isFirstNode, isLastNode, openFlag);
+					data.addNodeCache(setting, node);
+				}
+
+				var childHtml = [];
+				if (node[childKey] && node[childKey].length > 0) {
+					//make child html first, because checkType
+					childHtml = view.appendNodes(setting, level + 1, node[childKey], node, initFlag, openFlag && node.open);
+				}
+				if (openFlag) {
+
+					view.makeDOMNodeMainBefore(html, setting, node);
+					view.makeDOMNodeLine(html, setting, node);
+					data.getBeforeA(setting, node, html);
+					view.makeDOMNodeNameBefore(html, setting, node);
+					data.getInnerBeforeA(setting, node, html);
+					view.makeDOMNodeIcon(html, setting, node);
+					data.getInnerAfterA(setting, node, html);
+					view.makeDOMNodeNameAfter(html, setting, node);
+					data.getAfterA(setting, node, html);
+					if (node.isParent && node.open) {
+						view.makeUlHtml(setting, node, html, childHtml.join(''));
+					}
+					view.makeDOMNodeMainAfter(html, setting, node);
+					data.addCreatedNode(setting, node);
+				}
+			}
+			return html;
+		},
+		appendParentULDom: function(setting, node) {
+			var html = [],
+			nObj = $$(node, setting);
+			if (!nObj.get(0) && !!node.parentTId) {
+				view.appendParentULDom(setting, node.getParentNode());
+				nObj = $$(node, setting);
+			}
+			var ulObj = $$(node, consts.id.UL, setting);
+			if (!ulObj.get(0)) {
+				var childKey = setting.data.key.children,
+				childHtml = view.appendNodes(setting, node.level+1, node[childKey], node, false, true);
+				view.makeUlHtml(setting, node, html, childHtml.join(''));
+				nObj.append(html.join(''));
+			}
+		},
+		asyncNode: function(setting, node, isSilent, callback) {
+			var i, l;
+			if (node && !node.isParent) {
+				tools.apply(callback);
+				return false;
+			} else if (node && node.isAjaxing) {
+				return false;
+			} else if (tools.apply(setting.callback.beforeAsync, [setting.treeId, node], true) == false) {
+				tools.apply(callback);
+				return false;
+			}
+			if (node) {
+				node.isAjaxing = true;
+				var icoObj = $$(node, consts.id.ICON, setting);
+				icoObj.attr({"style":"", "class":consts.className.BUTTON + " " + consts.className.ICO_LOADING});
+			}
+
+			var tmpParam = {};
+			for (i = 0, l = setting.async.autoParam.length; node && i < l; i++) {
+				var pKey = setting.async.autoParam[i].split("="), spKey = pKey;
+				if (pKey.length>1) {
+					spKey = pKey[1];
+					pKey = pKey[0];
+				}
+				tmpParam[spKey] = node[pKey];
+			}
+			if (tools.isArray(setting.async.otherParam)) {
+				for (i = 0, l = setting.async.otherParam.length; i < l; i += 2) {
+					tmpParam[setting.async.otherParam[i]] = setting.async.otherParam[i + 1];
+				}
+			} else {
+				for (var p in setting.async.otherParam) {
+					tmpParam[p] = setting.async.otherParam[p];
+				}
+			}
+
+			var _tmpV = data.getRoot(setting)._ver;
+			$.ajax({
+				contentType: setting.async.contentType,
+				type: setting.async.type,
+				url: tools.apply(setting.async.url, [setting.treeId, node], setting.async.url),
+				data: tmpParam,
+				dataType: setting.async.dataType,
+				success: function(msg) {
+					if (_tmpV != data.getRoot(setting)._ver) {
+						return;
+					}
+					var newNodes = [];
+					try {
+						if (!msg || msg.length == 0) {
+							newNodes = [];
+						} else if (typeof msg == "string") {
+							newNodes = eval("(" + msg + ")");
+						} else {
+							newNodes = msg;
+						}
+					} catch(err) {
+						newNodes = msg;
+					}
+
+					if (node) {
+						node.isAjaxing = null;
+						node.zAsync = true;
+					}
+					view.setNodeLineIcos(setting, node);
+					if (newNodes && newNodes !== "") {
+						newNodes = tools.apply(setting.async.dataFilter, [setting.treeId, node, newNodes], newNodes);
+						view.addNodes(setting, node, !!newNodes ? tools.clone(newNodes) : [], !!isSilent);
+					} else {
+						view.addNodes(setting, node, [], !!isSilent);
+					}
+					setting.treeObj.trigger(consts.event.ASYNC_SUCCESS, [setting.treeId, node, msg]);
+					tools.apply(callback);
+				},
+				error: function(XMLHttpRequest, textStatus, errorThrown) {
+					if (_tmpV != data.getRoot(setting)._ver) {
+						return;
+					}
+					if (node) node.isAjaxing = null;
+					view.setNodeLineIcos(setting, node);
+					setting.treeObj.trigger(consts.event.ASYNC_ERROR, [setting.treeId, node, XMLHttpRequest, textStatus, errorThrown]);
+				}
+			});
+			return true;
+		},
+		cancelPreSelectedNode: function (setting, node) {
+			var list = data.getRoot(setting).curSelectedList;
+			for (var i=0, j=list.length-1; j>=i; j--) {
+				if (!node || node === list[j]) {
+					$$(list[j], consts.id.A, setting).removeClass(consts.node.CURSELECTED);
+					if (node) {
+						data.removeSelectedNode(setting, node);
+						break;
+					}
+				}
+			}
+			if (!node) data.getRoot(setting).curSelectedList = [];
+		},
+		createNodeCallback: function(setting) {
+			if (!!setting.callback.onNodeCreated || !!setting.view.addDiyDom) {
+				var root = data.getRoot(setting);
+				while (root.createdNodes.length>0) {
+					var node = root.createdNodes.shift();
+					tools.apply(setting.view.addDiyDom, [setting.treeId, node]);
+					if (!!setting.callback.onNodeCreated) {
+						setting.treeObj.trigger(consts.event.NODECREATED, [setting.treeId, node]);
+					}
+				}
+			}
+		},
+		createNodes: function(setting, level, nodes, parentNode) {
+			if (!nodes || nodes.length == 0) return;
+			var root = data.getRoot(setting),
+			childKey = setting.data.key.children,
+			openFlag = !parentNode || parentNode.open || !!$$(parentNode[childKey][0], setting).get(0);
+			root.createdNodes = [];
+			var zTreeHtml = view.appendNodes(setting, level, nodes, parentNode, true, openFlag);
+			if (!parentNode) {
+				setting.treeObj.append(zTreeHtml.join(''));
+			} else {
+				var ulObj = $$(parentNode, consts.id.UL, setting);
+				if (ulObj.get(0)) {
+					ulObj.append(zTreeHtml.join(''));
+				}
+			}
+			view.createNodeCallback(setting);
+		},
+		destroy: function(setting) {
+			if (!setting) return;
+			data.initCache(setting);
+			data.initRoot(setting);
+			event.unbindTree(setting);
+			event.unbindEvent(setting);
+			setting.treeObj.empty();
+		},
+		expandCollapseNode: function(setting, node, expandFlag, animateFlag, callback) {
+			var root = data.getRoot(setting),
+			childKey = setting.data.key.children;
+			if (!node) {
+				tools.apply(callback, []);
+				return;
+			}
+			if (root.expandTriggerFlag) {
+				var _callback = callback;
+				callback = function(){
+					if (_callback) _callback();
+					if (node.open) {
+						setting.treeObj.trigger(consts.event.EXPAND, [setting.treeId, node]);
+					} else {
+						setting.treeObj.trigger(consts.event.COLLAPSE, [setting.treeId, node]);
+					}
+				};
+				root.expandTriggerFlag = false;
+			}
+			if (!node.open && node.isParent && ((!$$(node, consts.id.UL, setting).get(0)) || (node[childKey] && node[childKey].length>0 && !$$(node[childKey][0], setting).get(0)))) {
+				view.appendParentULDom(setting, node);
+				view.createNodeCallback(setting);
+			}
+			if (node.open == expandFlag) {
+				tools.apply(callback, []);
+				return;
+			}
+			var ulObj = $$(node, consts.id.UL, setting),
+			switchObj = $$(node, consts.id.SWITCH, setting),
+			icoObj = $$(node, consts.id.ICON, setting);
+
+			if (node.isParent) {
+				node.open = !node.open;
+				if (node.iconOpen && node.iconClose) {
+					icoObj.attr("style", view.makeNodeIcoStyle(setting, node));
+				}
+
+				if (node.open) {
+					view.replaceSwitchClass(node, switchObj, consts.folder.OPEN);
+					view.replaceIcoClass(node, icoObj, consts.folder.OPEN);
+					if (animateFlag == false || setting.view.expandSpeed == "") {
+						ulObj.show();
+						tools.apply(callback, []);
+					} else {
+						if (node[childKey] && node[childKey].length > 0) {
+							ulObj.slideDown(setting.view.expandSpeed, callback);
+						} else {
+							ulObj.show();
+							tools.apply(callback, []);
+						}
+					}
+				} else {
+					view.replaceSwitchClass(node, switchObj, consts.folder.CLOSE);
+					view.replaceIcoClass(node, icoObj, consts.folder.CLOSE);
+					if (animateFlag == false || setting.view.expandSpeed == "" || !(node[childKey] && node[childKey].length > 0)) {
+						ulObj.hide();
+						tools.apply(callback, []);
+					} else {
+						ulObj.slideUp(setting.view.expandSpeed, callback);
+					}
+				}
+			} else {
+				tools.apply(callback, []);
+			}
+		},
+		expandCollapseParentNode: function(setting, node, expandFlag, animateFlag, callback) {
+			if (!node) return;
+			if (!node.parentTId) {
+				view.expandCollapseNode(setting, node, expandFlag, animateFlag, callback);
+				return;
+			} else {
+				view.expandCollapseNode(setting, node, expandFlag, animateFlag);
+			}
+			if (node.parentTId) {
+				view.expandCollapseParentNode(setting, node.getParentNode(), expandFlag, animateFlag, callback);
+			}
+		},
+		expandCollapseSonNode: function(setting, node, expandFlag, animateFlag, callback) {
+			var root = data.getRoot(setting),
+			childKey = setting.data.key.children,
+			treeNodes = (node) ? node[childKey]: root[childKey],
+			selfAnimateSign = (node) ? false : animateFlag,
+			expandTriggerFlag = data.getRoot(setting).expandTriggerFlag;
+			data.getRoot(setting).expandTriggerFlag = false;
+			if (treeNodes) {
+				for (var i = 0, l = treeNodes.length; i < l; i++) {
+					if (treeNodes[i]) view.expandCollapseSonNode(setting, treeNodes[i], expandFlag, selfAnimateSign);
+				}
+			}
+			data.getRoot(setting).expandTriggerFlag = expandTriggerFlag;
+			view.expandCollapseNode(setting, node, expandFlag, animateFlag, callback );
+		},
+		makeDOMNodeIcon: function(html, setting, node) {
+			var nameStr = data.getNodeName(setting, node),
+			name = setting.view.nameIsHTML ? nameStr : nameStr.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
+			html.push("<span id='", node.tId, consts.id.ICON,
+				"' title='' treeNode", consts.id.ICON," class='", view.makeNodeIcoClass(setting, node),
+				"' style='", view.makeNodeIcoStyle(setting, node), "'></span><span id='", node.tId, consts.id.SPAN,
+				"'>",name,"</span>");
+		},
+		makeDOMNodeLine: function(html, setting, node) {
+			html.push("<span id='", node.tId, consts.id.SWITCH,	"' title='' class='", view.makeNodeLineClass(setting, node), "' treeNode", consts.id.SWITCH,"></span>");
+		},
+		makeDOMNodeMainAfter: function(html, setting, node) {
+			html.push("</li>");
+		},
+		makeDOMNodeMainBefore: function(html, setting, node) {
+			html.push("<li id='", node.tId, "' class='", consts.className.LEVEL, node.level,"' tabindex='0' hidefocus='true' treenode>");
+		},
+		makeDOMNodeNameAfter: function(html, setting, node) {
+			html.push("</a>");
+		},
+		makeDOMNodeNameBefore: function(html, setting, node) {
+			var title = data.getNodeTitle(setting, node),
+			url = view.makeNodeUrl(setting, node),
+			fontcss = view.makeNodeFontCss(setting, node),
+			fontStyle = [];
+			for (var f in fontcss) {
+				fontStyle.push(f, ":", fontcss[f], ";");
+			}
+			html.push("<a id='", node.tId, consts.id.A, "' class='", consts.className.LEVEL, node.level,"' treeNode", consts.id.A," onclick=\"", (node.click || ''),
+				"\" ", ((url != null && url.length > 0) ? "href='" + url + "'" : ""), " target='",view.makeNodeTarget(node),"' style='", fontStyle.join(''),
+				"'");
+			if (tools.apply(setting.view.showTitle, [setting.treeId, node], setting.view.showTitle) && title) {html.push("title='", title.replace(/'/g,"&#39;").replace(/</g,'&lt;').replace(/>/g,'&gt;'),"'");}
+			html.push(">");
+		},
+		makeNodeFontCss: function(setting, node) {
+			var fontCss = tools.apply(setting.view.fontCss, [setting.treeId, node], setting.view.fontCss);
+			return (fontCss && ((typeof fontCss) != "function")) ? fontCss : {};
+		},
+		makeNodeIcoClass: function(setting, node) {
+			var icoCss = ["ico"];
+			if (!node.isAjaxing) {
+				icoCss[0] = (node.iconSkin ? node.iconSkin + "_" : "") + icoCss[0];
+				if (node.isParent) {
+					icoCss.push(node.open ? consts.folder.OPEN : consts.folder.CLOSE);
+				} else {
+					icoCss.push(consts.folder.DOCU);
+				}
+			}
+			return consts.className.BUTTON + " " + icoCss.join('_');
+		},
+		makeNodeIcoStyle: function(setting, node) {
+			var icoStyle = [];
+			if (!node.isAjaxing) {
+				var icon = (node.isParent && node.iconOpen && node.iconClose) ? (node.open ? node.iconOpen : node.iconClose) : node.icon;
+				if (icon) icoStyle.push("background:url(", icon, ") 0 0 no-repeat;");
+				if (setting.view.showIcon == false || !tools.apply(setting.view.showIcon, [setting.treeId, node], true)) {
+					icoStyle.push("width:0px;height:0px;");
+				}
+			}
+			return icoStyle.join('');
+		},
+		makeNodeLineClass: function(setting, node) {
+			var lineClass = [];
+			if (setting.view.showLine) {
+				if (node.level == 0 && node.isFirstNode && node.isLastNode) {
+					lineClass.push(consts.line.ROOT);
+				} else if (node.level == 0 && node.isFirstNode) {
+					lineClass.push(consts.line.ROOTS);
+				} else if (node.isLastNode) {
+					lineClass.push(consts.line.BOTTOM);
+				} else {
+					lineClass.push(consts.line.CENTER);
+				}
+			} else {
+				lineClass.push(consts.line.NOLINE);
+			}
+			if (node.isParent) {
+				lineClass.push(node.open ? consts.folder.OPEN : consts.folder.CLOSE);
+			} else {
+				lineClass.push(consts.folder.DOCU);
+			}
+			return view.makeNodeLineClassEx(node) + lineClass.join('_');
+		},
+		makeNodeLineClassEx: function(node) {
+			return consts.className.BUTTON + " " + consts.className.LEVEL + node.level + " " + consts.className.SWITCH + " ";
+		},
+		makeNodeTarget: function(node) {
+			return (node.target || "_blank");
+		},
+		makeNodeUrl: function(setting, node) {
+			var urlKey = setting.data.key.url;
+			return node[urlKey] ? node[urlKey] : null;
+		},
+		makeUlHtml: function(setting, node, html, content) {
+			html.push("<ul id='", node.tId, consts.id.UL, "' class='", consts.className.LEVEL, node.level, " ", view.makeUlLineClass(setting, node), "' style='display:", (node.open ? "block": "none"),"'>");
+			html.push(content);
+			html.push("</ul>");
+		},
+		makeUlLineClass: function(setting, node) {
+			return ((setting.view.showLine && !node.isLastNode) ? consts.line.LINE : "");
+		},
+		removeChildNodes: function(setting, node) {
+			if (!node) return;
+			var childKey = setting.data.key.children,
+			nodes = node[childKey];
+			if (!nodes) return;
+
+			for (var i = 0, l = nodes.length; i < l; i++) {
+				data.removeNodeCache(setting, nodes[i]);
+			}
+			data.removeSelectedNode(setting);
+			delete node[childKey];
+
+			if (!setting.data.keep.parent) {
+				node.isParent = false;
+				node.open = false;
+				var tmp_switchObj = $$(node, consts.id.SWITCH, setting),
+				tmp_icoObj = $$(node, consts.id.ICON, setting);
+				view.replaceSwitchClass(node, tmp_switchObj, consts.folder.DOCU);
+				view.replaceIcoClass(node, tmp_icoObj, consts.folder.DOCU);
+				$$(node, consts.id.UL, setting).remove();
+			} else {
+				$$(node, consts.id.UL, setting).empty();
+			}
+		},
+		setFirstNode: function(setting, parentNode) {
+			var childKey = setting.data.key.children, childLength = parentNode[childKey].length;
+			if ( childLength > 0) {
+				parentNode[childKey][0].isFirstNode = true;
+			}
+		},
+		setLastNode: function(setting, parentNode) {
+			var childKey = setting.data.key.children, childLength = parentNode[childKey].length;
+			if ( childLength > 0) {
+				parentNode[childKey][childLength - 1].isLastNode = true;
+			}
+		},
+		removeNode: function(setting, node) {
+			var root = data.getRoot(setting),
+			childKey = setting.data.key.children,
+			parentNode = (node.parentTId) ? node.getParentNode() : root;
+
+			node.isFirstNode = false;
+			node.isLastNode = false;
+			node.getPreNode = function() {return null;};
+			node.getNextNode = function() {return null;};
+
+			if (!data.getNodeCache(setting, node.tId)) {
+				return;
+			}
+
+			$$(node, setting).remove();
+			data.removeNodeCache(setting, node);
+			data.removeSelectedNode(setting, node);
+
+			for (var i = 0, l = parentNode[childKey].length; i < l; i++) {
+				if (parentNode[childKey][i].tId == node.tId) {
+					parentNode[childKey].splice(i, 1);
+					break;
+				}
+			}
+			view.setFirstNode(setting, parentNode);
+			view.setLastNode(setting, parentNode);
+
+			var tmp_ulObj,tmp_switchObj,tmp_icoObj,
+			childLength = parentNode[childKey].length;
+
+			//repair nodes old parent
+			if (!setting.data.keep.parent && childLength == 0) {
+				//old parentNode has no child nodes
+				parentNode.isParent = false;
+				parentNode.open = false;
+				tmp_ulObj = $$(parentNode, consts.id.UL, setting);
+				tmp_switchObj = $$(parentNode, consts.id.SWITCH, setting);
+				tmp_icoObj = $$(parentNode, consts.id.ICON, setting);
+				view.replaceSwitchClass(parentNode, tmp_switchObj, consts.folder.DOCU);
+				view.replaceIcoClass(parentNode, tmp_icoObj, consts.folder.DOCU);
+				tmp_ulObj.css("display", "none");
+
+			} else if (setting.view.showLine && childLength > 0) {
+				//old parentNode has child nodes
+				var newLast = parentNode[childKey][childLength - 1];
+				tmp_ulObj = $$(newLast, consts.id.UL, setting);
+				tmp_switchObj = $$(newLast, consts.id.SWITCH, setting);
+				tmp_icoObj = $$(newLast, consts.id.ICON, setting);
+				if (parentNode == root) {
+					if (parentNode[childKey].length == 1) {
+						//node was root, and ztree has only one root after move node
+						view.replaceSwitchClass(newLast, tmp_switchObj, consts.line.ROOT);
+					} else {
+						var tmp_first_switchObj = $$(parentNode[childKey][0], consts.id.SWITCH, setting);
+						view.replaceSwitchClass(parentNode[childKey][0], tmp_first_switchObj, consts.line.ROOTS);
+						view.replaceSwitchClass(newLast, tmp_switchObj, consts.line.BOTTOM);
+					}
+				} else {
+					view.replaceSwitchClass(newLast, tmp_switchObj, consts.line.BOTTOM);
+				}
+				tmp_ulObj.removeClass(consts.line.LINE);
+			}
+		},
+		replaceIcoClass: function(node, obj, newName) {
+			if (!obj || node.isAjaxing) return;
+			var tmpName = obj.attr("class");
+			if (tmpName == undefined) return;
+			var tmpList = tmpName.split("_");
+			switch (newName) {
+				case consts.folder.OPEN:
+				case consts.folder.CLOSE:
+				case consts.folder.DOCU:
+					tmpList[tmpList.length-1] = newName;
+					break;
+			}
+			obj.attr("class", tmpList.join("_"));
+		},
+		replaceSwitchClass: function(node, obj, newName) {
+			if (!obj) return;
+			var tmpName = obj.attr("class");
+			if (tmpName == undefined) return;
+			var tmpList = tmpName.split("_");
+			switch (newName) {
+				case consts.line.ROOT:
+				case consts.line.ROOTS:
+				case consts.line.CENTER:
+				case consts.line.BOTTOM:
+				case consts.line.NOLINE:
+					tmpList[0] = view.makeNodeLineClassEx(node) + newName;
+					break;
+				case consts.folder.OPEN:
+				case consts.folder.CLOSE:
+				case consts.folder.DOCU:
+					tmpList[1] = newName;
+					break;
+			}
+			obj.attr("class", tmpList.join("_"));
+			if (newName !== consts.folder.DOCU) {
+				obj.removeAttr("disabled");
+			} else {
+				obj.attr("disabled", "disabled");
+			}
+		},
+		selectNode: function(setting, node, addFlag) {
+			if (!addFlag) {
+				view.cancelPreSelectedNode(setting);
+			}
+			$$(node, consts.id.A, setting).addClass(consts.node.CURSELECTED);
+			data.addSelectedNode(setting, node);
+		},
+		setNodeFontCss: function(setting, treeNode) {
+			var aObj = $$(treeNode, consts.id.A, setting),
+			fontCss = view.makeNodeFontCss(setting, treeNode);
+			if (fontCss) {
+				aObj.css(fontCss);
+			}
+		},
+		setNodeLineIcos: function(setting, node) {
+			if (!node) return;
+			var switchObj = $$(node, consts.id.SWITCH, setting),
+			ulObj = $$(node, consts.id.UL, setting),
+			icoObj = $$(node, consts.id.ICON, setting),
+			ulLine = view.makeUlLineClass(setting, node);
+			if (ulLine.length==0) {
+				ulObj.removeClass(consts.line.LINE);
+			} else {
+				ulObj.addClass(ulLine);
+			}
+			switchObj.attr("class", view.makeNodeLineClass(setting, node));
+			if (node.isParent) {
+				switchObj.removeAttr("disabled");
+			} else {
+				switchObj.attr("disabled", "disabled");
+			}
+			icoObj.removeAttr("style");
+			icoObj.attr("style", view.makeNodeIcoStyle(setting, node));
+			icoObj.attr("class", view.makeNodeIcoClass(setting, node));
+		},
+		setNodeName: function(setting, node) {
+			var title = data.getNodeTitle(setting, node),
+			nObj = $$(node, consts.id.SPAN, setting);
+			nObj.empty();
+			if (setting.view.nameIsHTML) {
+				nObj.html(data.getNodeName(setting, node));
+			} else {
+				nObj.text(data.getNodeName(setting, node));
+			}
+			if (tools.apply(setting.view.showTitle, [setting.treeId, node], setting.view.showTitle)) {
+				var aObj = $$(node, consts.id.A, setting);
+				aObj.attr("title", !title ? "" : title);
+			}
+		},
+		setNodeTarget: function(setting, node) {
+			var aObj = $$(node, consts.id.A, setting);
+			aObj.attr("target", view.makeNodeTarget(node));
+		},
+		setNodeUrl: function(setting, node) {
+			var aObj = $$(node, consts.id.A, setting),
+			url = view.makeNodeUrl(setting, node);
+			if (url == null || url.length == 0) {
+				aObj.removeAttr("href");
+			} else {
+				aObj.attr("href", url);
+			}
+		},
+		switchNode: function(setting, node) {
+			if (node.open || !tools.canAsync(setting, node)) {
+				view.expandCollapseNode(setting, node, !node.open);
+			} else if (setting.async.enable) {
+				if (!view.asyncNode(setting, node)) {
+					view.expandCollapseNode(setting, node, !node.open);
+					return;
+				}
+			} else if (node) {
+				view.expandCollapseNode(setting, node, !node.open);
+			}
+		}
+	};
+	// zTree defind
+	$.fn.zTree = {
+		consts : _consts,
+		_z : {
+			tools: tools,
+			view: view,
+			event: event,
+			data: data
+		},
+		getZTreeObj: function(treeId) {
+			var o = data.getZTreeTools(treeId);
+			return o ? o : null;
+		},
+		destroy: function(treeId) {
+			if (!!treeId && treeId.length > 0) {
+				view.destroy(data.getSetting(treeId));
+			} else {
+				for(var s in settings) {
+					view.destroy(settings[s]);
+				}
+			}
+		},
+		init: function(obj, zSetting, zNodes) {
+			var setting = tools.clone(_setting);
+			$.extend(true, setting, zSetting);
+			setting.treeId = obj.attr("id");
+			setting.treeObj = obj;
+			setting.treeObj.empty();
+			settings[setting.treeId] = setting;
+			//For some older browser,(e.g., ie6)
+			if(typeof document.body.style.maxHeight === "undefined") {
+				setting.view.expandSpeed = "";
+			}
+			data.initRoot(setting);
+			var root = data.getRoot(setting),
+			childKey = setting.data.key.children;
+			zNodes = zNodes ? tools.clone(tools.isArray(zNodes)? zNodes : [zNodes]) : [];
+			if (setting.data.simpleData.enable) {
+				root[childKey] = data.transformTozTreeFormat(setting, zNodes);
+			} else {
+				root[childKey] = zNodes;
+			}
+
+			data.initCache(setting);
+			event.unbindTree(setting);
+			event.bindTree(setting);
+			event.unbindEvent(setting);
+			event.bindEvent(setting);
+
+			var zTreeTools = {
+				setting : setting,
+				addNodes : function(parentNode, newNodes, isSilent) {
+					if (!newNodes) return null;
+					if (!parentNode) parentNode = null;
+					if (parentNode && !parentNode.isParent && setting.data.keep.leaf) return null;
+					var xNewNodes = tools.clone(tools.isArray(newNodes)? newNodes: [newNodes]);
+					function addCallback() {
+						view.addNodes(setting, parentNode, xNewNodes, (isSilent==true));
+					}
+
+					if (tools.canAsync(setting, parentNode)) {
+						view.asyncNode(setting, parentNode, isSilent, addCallback);
+					} else {
+						addCallback();
+					}
+					return xNewNodes;
+				},
+				cancelSelectedNode : function(node) {
+					view.cancelPreSelectedNode(setting, node);
+				},
+				destroy : function() {
+					view.destroy(setting);
+				},
+				expandAll : function(expandFlag) {
+					expandFlag = !!expandFlag;
+					view.expandCollapseSonNode(setting, null, expandFlag, true);
+					return expandFlag;
+				},
+				expandNode : function(node, expandFlag, sonSign, focus, callbackFlag) {
+					if (!node || !node.isParent) return null;
+					if (expandFlag !== true && expandFlag !== false) {
+						expandFlag = !node.open;
+					}
+					callbackFlag = !!callbackFlag;
+
+					if (callbackFlag && expandFlag && (tools.apply(setting.callback.beforeExpand, [setting.treeId, node], true) == false)) {
+						return null;
+					} else if (callbackFlag && !expandFlag && (tools.apply(setting.callback.beforeCollapse, [setting.treeId, node], true) == false)) {
+						return null;
+					}
+					if (expandFlag && node.parentTId) {
+						view.expandCollapseParentNode(setting, node.getParentNode(), expandFlag, false);
+					}
+					if (expandFlag === node.open && !sonSign) {
+						return null;
+					}
+
+					data.getRoot(setting).expandTriggerFlag = callbackFlag;
+					if (!tools.canAsync(setting, node) && sonSign) {
+						view.expandCollapseSonNode(setting, node, expandFlag, true, function() {
+							if (focus !== false) {try{$$(node, setting).focus().blur();}catch(e){}}
+						});
+					} else {
+						node.open = !expandFlag;
+						view.switchNode(this.setting, node);
+						if (focus !== false) {try{$$(node, setting).focus().blur();}catch(e){}}
+					}
+					return expandFlag;
+				},
+				getNodes : function() {
+					return data.getNodes(setting);
+				},
+				getNodeByParam : function(key, value, parentNode) {
+					if (!key) return null;
+					return data.getNodeByParam(setting, parentNode?parentNode[setting.data.key.children]:data.getNodes(setting), key, value);
+				},
+				getNodeByTId : function(tId) {
+					return data.getNodeCache(setting, tId);
+				},
+				getNodesByParam : function(key, value, parentNode) {
+					if (!key) return null;
+					return data.getNodesByParam(setting, parentNode?parentNode[setting.data.key.children]:data.getNodes(setting), key, value);
+				},
+				getNodesByParamFuzzy : function(key, value, parentNode) {
+					if (!key) return null;
+					return data.getNodesByParamFuzzy(setting, parentNode?parentNode[setting.data.key.children]:data.getNodes(setting), key, value);
+				},
+				getNodesByFilter: function(filter, isSingle, parentNode, invokeParam) {
+					isSingle = !!isSingle;
+					if (!filter || (typeof filter != "function")) return (isSingle ? null : []);
+					return data.getNodesByFilter(setting, parentNode?parentNode[setting.data.key.children]:data.getNodes(setting), filter, isSingle, invokeParam);
+				},
+				getNodeIndex : function(node) {
+					if (!node) return null;
+					var childKey = setting.data.key.children,
+					parentNode = (node.parentTId) ? node.getParentNode() : data.getRoot(setting);
+					for (var i=0, l = parentNode[childKey].length; i < l; i++) {
+						if (parentNode[childKey][i] == node) return i;
+					}
+					return -1;
+				},
+				getSelectedNodes : function() {
+					var r = [], list = data.getRoot(setting).curSelectedList;
+					for (var i=0, l=list.length; i<l; i++) {
+						r.push(list[i]);
+					}
+					return r;
+				},
+				isSelectedNode : function(node) {
+					return data.isSelectedNode(setting, node);
+				},
+				reAsyncChildNodes : function(parentNode, reloadType, isSilent) {
+					if (!this.setting.async.enable) return;
+					var isRoot = !parentNode;
+					if (isRoot) {
+						parentNode = data.getRoot(setting);
+					}
+					if (reloadType=="refresh") {
+						var childKey = this.setting.data.key.children;
+						for (var i = 0, l = parentNode[childKey] ? parentNode[childKey].length : 0; i < l; i++) {
+							data.removeNodeCache(setting, parentNode[childKey][i]);
+						}
+						data.removeSelectedNode(setting);
+						parentNode[childKey] = [];
+						if (isRoot) {
+							this.setting.treeObj.empty();
+						} else {
+							var ulObj = $$(parentNode, consts.id.UL, setting);
+							ulObj.empty();
+						}
+					}
+					view.asyncNode(this.setting, isRoot? null:parentNode, !!isSilent);
+				},
+				refresh : function() {
+					this.setting.treeObj.empty();
+					var root = data.getRoot(setting),
+					nodes = root[setting.data.key.children]
+					data.initRoot(setting);
+					root[setting.data.key.children] = nodes
+					data.initCache(setting);
+					view.createNodes(setting, 0, root[setting.data.key.children]);
+				},
+				removeChildNodes : function(node) {
+					if (!node) return null;
+					var childKey = setting.data.key.children,
+					nodes = node[childKey];
+					view.removeChildNodes(setting, node);
+					return nodes ? nodes : null;
+				},
+				removeNode : function(node, callbackFlag) {
+					if (!node) return;
+					callbackFlag = !!callbackFlag;
+					if (callbackFlag && tools.apply(setting.callback.beforeRemove, [setting.treeId, node], true) == false) return;
+					view.removeNode(setting, node);
+					if (callbackFlag) {
+						this.setting.treeObj.trigger(consts.event.REMOVE, [setting.treeId, node]);
+					}
+				},
+				selectNode : function(node, addFlag) {
+					if (!node) return;
+					if (tools.uCanDo(setting)) {
+						addFlag = setting.view.selectedMulti && addFlag;
+						if (node.parentTId) {
+							view.expandCollapseParentNode(setting, node.getParentNode(), true, false, function() {
+								try{$$(node, setting).focus().blur();}catch(e){}
+							});
+						} else {
+							try{$$(node, setting).focus().blur();}catch(e){}
+						}
+						view.selectNode(setting, node, addFlag);
+					}
+				},
+				transformTozTreeNodes : function(simpleNodes) {
+					return data.transformTozTreeFormat(setting, simpleNodes);
+				},
+				transformToArray : function(nodes) {
+					return data.transformToArrayFormat(setting, nodes);
+				},
+				updateNode : function(node, checkTypeFlag) {
+					if (!node) return;
+					var nObj = $$(node, setting);
+					if (nObj.get(0) && tools.uCanDo(setting)) {
+						view.setNodeName(setting, node);
+						view.setNodeTarget(setting, node);
+						view.setNodeUrl(setting, node);
+						view.setNodeLineIcos(setting, node);
+						view.setNodeFontCss(setting, node);
+					}
+				}
+			}
+			root.treeTools = zTreeTools;
+			data.setZTreeTools(setting, zTreeTools);
+
+			if (root[childKey] && root[childKey].length > 0) {
+				view.createNodes(setting, 0, root[childKey]);
+			} else if (setting.async.enable && setting.async.url && setting.async.url !== '') {
+				view.asyncNode(setting);
+			}
+			return zTreeTools;
+		}
+	};
+
+	var zt = $.fn.zTree,
+	$$ = tools.$,
+	consts = zt.consts;
+})(jQuery);
\ No newline at end of file
diff -x graphtree -Naru ./jsLoader.php graphtree/jsLoader.php
--- ./jsLoader.php	2016-02-26 17:45:58.000000000 +0800
+++ graphtree/jsLoader.php	2016-04-18 18:46:02.000000000 +0800
@@ -1,289 +1,304 @@
 <?php
-/*
-** Zabbix
-** Copyright (C) 2001-2016 Zabbix SIA
-**
-** This program is free software; you can redistribute it and/or modify
-** it under the terms of the GNU General Public License as published by
-** the Free Software Foundation; either version 2 of the License, or
-** (at your option) any later version.
-**
-** This program is distributed in the hope that it will be useful,
-** but WITHOUT ANY WARRANTY; without even the implied warranty of
-** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
-** GNU General Public License for more details.
-**
-** You should have received a copy of the GNU General Public License
-** along with this program; if not, write to the Free Software
-** Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
-**/
-
-
-// get language translations
-require_once dirname(__FILE__).'/include/gettextwrapper.inc.php';
-require_once dirname(__FILE__).'/include/js.inc.php';
-require_once dirname(__FILE__).'/include/locales.inc.php';
-
-// if we must provide language constants on language different from English
-if (isset($_GET['lang'])) {
-	if (function_exists('bindtextdomain')) {
-		// initializing gettext translations depending on language selected by user
-		$locales = zbx_locale_variants($_GET['lang']);
-		foreach ($locales as $locale) {
-			putenv('LC_ALL='.$locale);
-			putenv('LANG='.$locale);
-			putenv('LANGUAGE='.$locale);
-			if (setlocale(LC_ALL, $locale)) {
-				break;
-			}
-		}
-		bindtextdomain('frontend', 'locale');
-		bind_textdomain_codeset('frontend', 'UTF-8');
-		textdomain('frontend');
-	}
-	// numeric Locale to default
-	setlocale(LC_NUMERIC, ['C', 'POSIX', 'en', 'en_US', 'en_US.UTF-8', 'English_United States.1252', 'en_GB', 'en_GB.UTF-8']);
-}
-
-require_once dirname(__FILE__).'/include/translateDefines.inc.php';
-
-// available scripts 'scriptFileName' => 'path relative to js/'
-$availableJScripts = [
-	'common.js' => '',
-	'menupopup.js' => '',
-	'gtlc.js' => '',
-	'functions.js' => '',
-	'main.js' => '',
-	'dom.js' => '',
-	'servercheck.js' => '',
-	'flickerfreescreen.js' => '',
-	'multiselect.js' => '',
-	'chkbxrange.js' => '',
-	// vendors
-	'prototype.js' => 'vendors/',
-	'jquery.js' => 'vendors/',
-	'jquery-ui.js' => 'vendors/',
-	// classes
-	'class.bbcode.js' => '',
-	'class.calendar.js' => '',
-	'class.cdate.js' => '',
-	'class.cdebug.js' => '',
-	'class.cmap.js' => '',
-	'class.cmessages.js' => '',
-	'class.cookie.js' => '',
-	'class.cscreen.js' => '',
-	'class.csuggest.js' => '',
-	'class.cswitcher.js' => '',
-	'class.ctree.js' => '',
-	'class.curl.js' => '',
-	'class.rpc.js' => '',
-	'class.pmaster.js' => '',
-	'class.cviewswitcher.js' => '',
-	'init.js' => '',
-	// templates
-	'sysmap.tpl.js' => 'templates/',
-	// page-specific scripts
-	'items.js' => 'pages/',
-	'tr_logform.js' => 'pages/',
-];
-
-$tranStrings = [
-	'gtlc.js' => [
-		'S_ALL_S' => _('All'),
-		'S_ZOOM' => _('Zoom'),
-		'S_FIXED_SMALL' => _('fixed'),
-		'S_DYNAMIC_SMALL' => _('dynamic'),
-		'S_NOW_SMALL' => _('now'),
-		'S_YEAR_SHORT' => _x('y', 'year short'),
-		'S_MONTH_SHORT' => _x('m', 'month short'),
-		'S_DAY_SHORT' => _x('d', 'day short'),
-		'S_HOUR_SHORT' => _x('h', 'hour short'),
-		'S_MINUTE_SHORT' => _x('m', 'minute short'),
-		'S_DATE_FORMAT' => DATE_TIME_FORMAT
-	],
-	'functions.js' => [
-		'Cancel' => _('Cancel'),
-		'Execute' => _('Execute'),
-		'Execution confirmation' => _('Execution confirmation')
-	],
-	'tr_logform.js' => [
-		'S_REMOVE' => _('Remove')
-	],
-	'class.calendar.js' => [
-		'S_JANUARY' => _('January'),
-		'S_FEBRUARY' => _('February'),
-		'S_MARCH' => _('March'),
-		'S_APRIL' => _('April'),
-		'S_MAY' => _('May'),
-		'S_JUNE' => _('June'),
-		'S_JULY' => _('July'),
-		'S_AUGUST' => _('August'),
-		'S_SEPTEMBER' => _('September'),
-		'S_OCTOBER' => _('October'),
-		'S_NOVEMBER' => _('November'),
-		'S_DECEMBER' => _('December'),
-		'S_MONDAY_SHORT_BIG' => _x('M', 'Monday short'),
-		'S_TUESDAY_SHORT_BIG' => _x('T', 'Tuesday short'),
-		'S_WEDNESDAY_SHORT_BIG' => _x('W', 'Wednesday short'),
-		'S_THURSDAY_SHORT_BIG' => _x('T', 'Thursday short'),
-		'S_FRIDAY_SHORT_BIG' => _x('F', 'Friday short'),
-		'S_SATURDAY_SHORT_BIG' => _x('S', 'Saturday short'),
-		'S_SUNDAY_SHORT_BIG' => _x('S', 'Sunday short'),
-		'S_NOW' => _('Now'),
-		'S_DONE' => _('Done'),
-		'S_TIME' => _('Time')
-	],
-	'class.cmap.js' => [
-		'S_ON' => _('On'),
-		'S_OFF' => _('Off'),
-		'S_HIDDEN' => _('Hidden'),
-		'S_SHOWN' => _('Shown'),
-		'S_HOST' => _('Host'),
-		'S_MAP' => _('Map'),
-		'S_TRIGGER' => _('Trigger'),
-		'S_HOST_GROUP' => _('Host group'),
-		'S_IMAGE' => _('Image'),
-		'S_DEFAULT' => _('Default'),
-		'S_PLEASE_SELECT_TWO_ELEMENTS' => _('Please select two elements'),
-		'S_DOT' => _('Dot'),
-		'S_TWO_ELEMENTS_SHOULD_BE_SELECTED' => _('Two elements should be selected'),
-		'S_DELETE_SELECTED_ELEMENTS_Q' => _('Delete selected elements?'),
-		'S_NEW_ELEMENT' => _('New element'),
-		'S_INCORRECT_ELEMENT_MAP_LINK' => _('All links should have "Name" and "URL" specified'),
-		'S_EACH_URL_SHOULD_HAVE_UNIQUE' => _('Each URL should have a unique name. Please make sure there is only one URL named'),
-		'S_DELETE_LINKS_BETWEEN_SELECTED_ELEMENTS_Q' => _('Delete links between selected elements?'),
-		'S_NO_IMAGES' => 'You need to have at least one image uploaded to create map element. Images can be uploaded in Administration->General->Images section.',
-		'S_ICONMAP_IS_NOT_ENABLED' => _('Iconmap is not enabled'),
-		'Colour "%1$s" is not correct: expecting hexadecimal colour code (6 symbols).' => _('Colour "%1$s" is not correct: expecting hexadecimal colour code (6 symbols).')
-	],
-	'class.cmessages.js' => [
-		'S_MUTE' => _('Mute'),
-		'S_UNMUTE' => _('Unmute'),
-		'S_MESSAGES' => _('Messages'),
-		'S_CLEAR' => _('Clear'),
-		'S_SNOOZE' => _('Snooze')
-	],
-	'class.cookie.js' => [
-		'S_MAX_COOKIE_SIZE_REACHED' => _('We are sorry, the maximum possible number of elements to remember has been reached.')
-	],
-	'main.js' => [
-		'S_EXPAND' => _('Expand'),
-		'S_COLLAPSE' => _('Collapse'),
-	],
-	'multiselect.js' => [
-		'No matches found' => _('No matches found'),
-		'More matches found...' => _('More matches found...'),
-		'type here to search' => _('type here to search'),
-		'new' => _('new'),
-		'Select' => _('Select')
-	],
-	'menupopup.js' => [
-		'Acknowledge' => _('Acknowledge'),
-		'Add' => _('Add'),
-		'Configuration' => _('Configuration'),
-		'Create trigger' => _('Create trigger'),
-		'Delete service "%1$s"?' => _('Delete service "%1$s"?'),
-		'Do you wish to replace the conditional expression?' => _('Do you wish to replace the conditional expression?'),
-		'Edit trigger' => _('Edit trigger'),
-		'Events' => _('Events'),
-		'Favourite graphs' => _('Favourite graphs'),
-		'Favourite maps' => _('Favourite maps'),
-		'Favourite screens' => _('Favourite screens'),
-		'Favourite simple graphs' => _('Favourite simple graphs'),
-		'Favourite slide shows' => _('Favourite slide shows'),
-		'Insert expression' => _('Insert expression'),
-		'Trigger status "OK"' => _('Trigger status "OK"'),
-		'Trigger status "Problem"' => _('Trigger status "Problem"'),
-		'Item "%1$s"' => _('Item "%1$s"'),
-		'Go to' => _('Go to'),
-		'Graphs' => _('Graphs'),
-		'History' => _('History'),
-		'Host inventory' => _('Host inventory'),
-		'Host screens' => _('Host screens'),
-		'Latest data' => _('Latest data'),
-		'Latest values' => _('Latest values'),
-		'Last hour graph' => _('Last hour graph'),
-		'Last month graph' => _('Last month graph'),
-		'Last week graph' => _('Last week graph'),
-		'Refresh time' => _('Refresh time'),
-		'Refresh time multiplier' => _('Refresh time multiplier'),
-		'Remove' => _('Remove'),
-		'Remove all' => _('Remove all'),
-		'Scripts' => _('Scripts'),
-		'Submap' => _('Submap'),
-		'Trigger' => _('Trigger'),
-		'Triggers' => _('Triggers'),
-		'URL' => _('URL'),
-		'URLs' => _('URLs'),
-		'10 seconds' => _n('%1$s second', '%1$s seconds', 10),
-		'30 seconds' => _n('%1$s second', '%1$s seconds', 30),
-		'1 minute' => _n('%1$s minute', '%1$s minutes', 1),
-		'2 minutes' => _n('%1$s minute', '%1$s minutes', 2),
-		'10 minutes' => _n('%1$s minute', '%1$s minutes', 10),
-		'15 minutes' => _n('%1$s minute', '%1$s minutes', 15)
-	],
-	'items.js' => [
-		'To set a host interface select a single item type for all items' => _('To set a host interface select a single item type for all items'),
-		'No interface found' => _('No interface found')
-	]
-];
-
-if (empty($_GET['files'])) {
-	$files = [
-		'prototype.js',
-		'jquery.js',
-		'jquery-ui.js',
-		'common.js',
-		'class.cdebug.js',
-		'class.cdate.js',
-		'class.cookie.js',
-		'class.curl.js',
-		'class.rpc.js',
-		'class.bbcode.js',
-		'class.csuggest.js',
-		'main.js',
-		'chkbxrange.js',
-		'functions.js',
-		'menupopup.js',
-		'init.js'
-	];
-
-	// load frontend messaging only for some pages
-	if (isset($_GET['showGuiMessaging']) && $_GET['showGuiMessaging']) {
-		$files[] = 'class.cmessages.js';
-	}
-}
-else {
-	$files = $_GET['files'];
-}
-
-$js = 'if (typeof(locale) == "undefined") { var locale = {}; }'."\n";
-foreach ($files as $file) {
-	if (isset($tranStrings[$file])) {
-		foreach ($tranStrings[$file] as $origStr => $str) {
-			$js .= "locale['".$origStr."'] = ".zbx_jsvalue($str).";";
-		}
-	}
-}
-
-foreach ($files as $file) {
-	if (isset($availableJScripts[$file])) {
-		$js .= file_get_contents('js/'.$availableJScripts[$file].$file)."\n";
-	}
-}
-
-$jsLength = strlen($js);
-$etag = md5($jsLength);
-if (isset($_SERVER['HTTP_IF_NONE_MATCH']) && $_SERVER['HTTP_IF_NONE_MATCH'] == $etag) {
-	header('HTTP/1.1 304 Not Modified');
-	header('ETag: '.$etag);
-	exit;
-}
-
-header('Content-type: text/javascript; charset=UTF-8');
-// breaks if "zlib.output_compression = On"
-// header('Content-length: '.$jsLength);
-header('Cache-Control: public, must-revalidate');
-header('ETag: '.$etag);
+    /*
+    ** Zabbix
+    ** Copyright (C) 2001-2016 Zabbix SIA
+    **
+    ** This program is free software; you can redistribute it and/or modify
+    ** it under the terms of the GNU General Public License as published by
+    ** the Free Software Foundation; either version 2 of the License, or
+    ** (at your option) any later version.
+    **
+    ** This program is distributed in the hope that it will be useful,
+    ** but WITHOUT ANY WARRANTY; without even the implied warranty of
+    ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+    ** GNU General Public License for more details.
+    **
+    ** You should have received a copy of the GNU General Public License
+    ** along with this program; if not, write to the Free Software
+    ** Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+    **/
+
+
+    // get language translations
+    require_once dirname (__FILE__) . '/include/gettextwrapper.inc.php';
+    require_once dirname (__FILE__) . '/include/js.inc.php';
+    require_once dirname (__FILE__) . '/include/locales.inc.php';
+
+    // if we must provide language constants on language different from English
+    if (isset($_GET['lang'])) {
+        if (function_exists ('bindtextdomain')) {
+            // initializing gettext translations depending on language selected by user
+            $locales = zbx_locale_variants ($_GET['lang']);
+            foreach ($locales as $locale) {
+                putenv ('LC_ALL=' . $locale);
+                putenv ('LANG=' . $locale);
+                putenv ('LANGUAGE=' . $locale);
+                if (setlocale (LC_ALL, $locale)) {
+                    break;
+                }
+            }
+            bindtextdomain ('frontend', 'locale');
+            bind_textdomain_codeset ('frontend', 'UTF-8');
+            textdomain ('frontend');
+        }
+        // numeric Locale to default
+        setlocale (LC_NUMERIC, [
+            'C',
+            'POSIX',
+            'en',
+            'en_US',
+            'en_US.UTF-8',
+            'English_United States.1252',
+            'en_GB',
+            'en_GB.UTF-8'
+        ]);
+    }
+
+    require_once dirname (__FILE__) . '/include/translateDefines.inc.php';
+
+    // available scripts 'scriptFileName' => 'path relative to js/'
+    $availableJScripts = [
+        'common.js'                         => '',
+        'menupopup.js'                      => '',
+        'gtlc.js'                           => '',
+        'functions.js'                      => '',
+        'main.js'                           => '',
+        'dom.js'                            => '',
+        'servercheck.js'                    => '',
+        'flickerfreescreen.js'              => '',
+        'multiselect.js'                    => '',
+        'chkbxrange.js'                     => '',
+        // vendors
+        'prototype.js'                      => 'vendors/',
+        'jquery.js'                         => 'vendors/',
+        'jquery-ui.js'                      => 'vendors/',
+        'jquery.ztree.core-3.5.js'          => 'vendors/',
+        'd3.v2.js'                          => 'vendors/',
+        'cubism.v1.js'                      => 'vendors/',
+        'emcharts.js'                       => 'vendors/emcharts/',
+        'serial.js'                         => 'vendors/emcharts/',
+        'jquery.datetimepicker.full.min.js' => 'vendors/jquery-datetimepicker/',
+
+        // classes
+        'class.bbcode.js'                   => '',
+        'class.calendar.js'                 => '',
+        'class.cdate.js'                    => '',
+        'class.cdebug.js'                   => '',
+        'class.cmap.js'                     => '',
+        'class.cmessages.js'                => '',
+        'class.cookie.js'                   => '',
+        'class.cscreen.js'                  => '',
+        'class.csuggest.js'                 => '',
+        'class.cswitcher.js'                => '',
+        'class.ctree.js'                    => '',
+        'class.curl.js'                     => '',
+        'class.rpc.js'                      => '',
+        'class.pmaster.js'                  => '',
+        'class.cviewswitcher.js'            => '',
+        'init.js'                           => '',
+        // templates
+        'sysmap.tpl.js'                     => 'templates/',
+        // page-specific scripts
+        'items.js'                          => 'pages/',
+        'tr_logform.js'                     => 'pages/',
+    ];
+
+    $tranStrings = [
+        'gtlc.js'            => [
+            'S_ALL_S'         => _ ('All'),
+            'S_ZOOM'          => _ ('Zoom'),
+            'S_FIXED_SMALL'   => _ ('fixed'),
+            'S_DYNAMIC_SMALL' => _ ('dynamic'),
+            'S_NOW_SMALL'     => _ ('now'),
+            'S_YEAR_SHORT'    => _x ('y', 'year short'),
+            'S_MONTH_SHORT'   => _x ('m', 'month short'),
+            'S_DAY_SHORT'     => _x ('d', 'day short'),
+            'S_HOUR_SHORT'    => _x ('h', 'hour short'),
+            'S_MINUTE_SHORT'  => _x ('m', 'minute short'),
+            'S_DATE_FORMAT'   => DATE_TIME_FORMAT
+        ],
+        'functions.js'       => [
+            'Cancel'                 => _ ('Cancel'),
+            'Execute'                => _ ('Execute'),
+            'Execution confirmation' => _ ('Execution confirmation')
+        ],
+        'tr_logform.js'      => [
+            'S_REMOVE' => _ ('Remove')
+        ],
+        'class.calendar.js'  => [
+            'S_JANUARY'             => _ ('January'),
+            'S_FEBRUARY'            => _ ('February'),
+            'S_MARCH'               => _ ('March'),
+            'S_APRIL'               => _ ('April'),
+            'S_MAY'                 => _ ('May'),
+            'S_JUNE'                => _ ('June'),
+            'S_JULY'                => _ ('July'),
+            'S_AUGUST'              => _ ('August'),
+            'S_SEPTEMBER'           => _ ('September'),
+            'S_OCTOBER'             => _ ('October'),
+            'S_NOVEMBER'            => _ ('November'),
+            'S_DECEMBER'            => _ ('December'),
+            'S_MONDAY_SHORT_BIG'    => _x ('M', 'Monday short'),
+            'S_TUESDAY_SHORT_BIG'   => _x ('T', 'Tuesday short'),
+            'S_WEDNESDAY_SHORT_BIG' => _x ('W', 'Wednesday short'),
+            'S_THURSDAY_SHORT_BIG'  => _x ('T', 'Thursday short'),
+            'S_FRIDAY_SHORT_BIG'    => _x ('F', 'Friday short'),
+            'S_SATURDAY_SHORT_BIG'  => _x ('S', 'Saturday short'),
+            'S_SUNDAY_SHORT_BIG'    => _x ('S', 'Sunday short'),
+            'S_NOW'                 => _ ('Now'),
+            'S_DONE'                => _ ('Done'),
+            'S_TIME'                => _ ('Time')
+        ],
+        'class.cmap.js'      => [
+            'S_ON'                                                                         => _ ('On'),
+            'S_OFF'                                                                        => _ ('Off'),
+            'S_HIDDEN'                                                                     => _ ('Hidden'),
+            'S_SHOWN'                                                                      => _ ('Shown'),
+            'S_HOST'                                                                       => _ ('Host'),
+            'S_MAP'                                                                        => _ ('Map'),
+            'S_TRIGGER'                                                                    => _ ('Trigger'),
+            'S_HOST_GROUP'                                                                 => _ ('Host group'),
+            'S_IMAGE'                                                                      => _ ('Image'),
+            'S_DEFAULT'                                                                    => _ ('Default'),
+            'S_PLEASE_SELECT_TWO_ELEMENTS'                                                 => _ ('Please select two elements'),
+            'S_DOT'                                                                        => _ ('Dot'),
+            'S_TWO_ELEMENTS_SHOULD_BE_SELECTED'                                            => _ ('Two elements should be selected'),
+            'S_DELETE_SELECTED_ELEMENTS_Q'                                                 => _ ('Delete selected elements?'),
+            'S_NEW_ELEMENT'                                                                => _ ('New element'),
+            'S_INCORRECT_ELEMENT_MAP_LINK'                                                 => _ ('All links should have "Name" and "URL" specified'),
+            'S_EACH_URL_SHOULD_HAVE_UNIQUE'                                                => _ ('Each URL should have a unique name. Please make sure there is only one URL named'),
+            'S_DELETE_LINKS_BETWEEN_SELECTED_ELEMENTS_Q'                                   => _ ('Delete links between selected elements?'),
+            'S_NO_IMAGES'                                                                  => 'You need to have at least one image uploaded to create map element. Images can be uploaded in Administration->General->Images section.',
+            'S_ICONMAP_IS_NOT_ENABLED'                                                     => _ ('Iconmap is not enabled'),
+            'Colour "%1$s" is not correct: expecting hexadecimal colour code (6 symbols).' => _ ('Colour "%1$s" is not correct: expecting hexadecimal colour code (6 symbols).')
+        ],
+        'class.cmessages.js' => [
+            'S_MUTE'     => _ ('Mute'),
+            'S_UNMUTE'   => _ ('Unmute'),
+            'S_MESSAGES' => _ ('Messages'),
+            'S_CLEAR'    => _ ('Clear'),
+            'S_SNOOZE'   => _ ('Snooze')
+        ],
+        'class.cookie.js'    => [
+            'S_MAX_COOKIE_SIZE_REACHED' => _ ('We are sorry, the maximum possible number of elements to remember has been reached.')
+        ],
+        'main.js'            => [
+            'S_EXPAND'   => _ ('Expand'),
+            'S_COLLAPSE' => _ ('Collapse'),
+        ],
+        'multiselect.js'     => [
+            'No matches found'      => _ ('No matches found'),
+            'More matches found...' => _ ('More matches found...'),
+            'type here to search'   => _ ('type here to search'),
+            'new'                   => _ ('new'),
+            'Select'                => _ ('Select')
+        ],
+        'menupopup.js'       => [
+            'Acknowledge'                                        => _ ('Acknowledge'),
+            'Add'                                                => _ ('Add'),
+            'Configuration'                                      => _ ('Configuration'),
+            'Create trigger'                                     => _ ('Create trigger'),
+            'Delete service "%1$s"?'                             => _ ('Delete service "%1$s"?'),
+            'Do you wish to replace the conditional expression?' => _ ('Do you wish to replace the conditional expression?'),
+            'Edit trigger'                                       => _ ('Edit trigger'),
+            'Events'                                             => _ ('Events'),
+            'Favourite graphs'                                   => _ ('Favourite graphs'),
+            'Favourite maps'                                     => _ ('Favourite maps'),
+            'Favourite screens'                                  => _ ('Favourite screens'),
+            'Favourite simple graphs'                            => _ ('Favourite simple graphs'),
+            'Favourite slide shows'                              => _ ('Favourite slide shows'),
+            'Insert expression'                                  => _ ('Insert expression'),
+            'Trigger status "OK"'                                => _ ('Trigger status "OK"'),
+            'Trigger status "Problem"'                           => _ ('Trigger status "Problem"'),
+            'Item "%1$s"'                                        => _ ('Item "%1$s"'),
+            'Go to'                                              => _ ('Go to'),
+            'Graphs'                                             => _ ('Graphs'),
+            'History'                                            => _ ('History'),
+            'Host inventory'                                     => _ ('Host inventory'),
+            'Host screens'                                       => _ ('Host screens'),
+            'Latest data'                                        => _ ('Latest data'),
+            'Latest values'                                      => _ ('Latest values'),
+            'Last hour graph'                                    => _ ('Last hour graph'),
+            'Last month graph'                                   => _ ('Last month graph'),
+            'Last week graph'                                    => _ ('Last week graph'),
+            'Refresh time'                                       => _ ('Refresh time'),
+            'Refresh time multiplier'                            => _ ('Refresh time multiplier'),
+            'Remove'                                             => _ ('Remove'),
+            'Remove all'                                         => _ ('Remove all'),
+            'Scripts'                                            => _ ('Scripts'),
+            'Submap'                                             => _ ('Submap'),
+            'Trigger'                                            => _ ('Trigger'),
+            'Triggers'                                           => _ ('Triggers'),
+            'URL'                                                => _ ('URL'),
+            'URLs'                                               => _ ('URLs'),
+            '10 seconds'                                         => _n ('%1$s second', '%1$s seconds', 10),
+            '30 seconds'                                         => _n ('%1$s second', '%1$s seconds', 30),
+            '1 minute'                                           => _n ('%1$s minute', '%1$s minutes', 1),
+            '2 minutes'                                          => _n ('%1$s minute', '%1$s minutes', 2),
+            '10 minutes'                                         => _n ('%1$s minute', '%1$s minutes', 10),
+            '15 minutes'                                         => _n ('%1$s minute', '%1$s minutes', 15)
+        ],
+        'items.js'           => [
+            'To set a host interface select a single item type for all items' => _ ('To set a host interface select a single item type for all items'),
+            'No interface found'                                              => _ ('No interface found')
+        ]
+    ];
+
+    if (empty($_GET['files'])) {
+        $files = [
+            'prototype.js',
+            'jquery.js',
+            'jquery-ui.js',
+            'common.js',
+            'class.cdebug.js',
+            'class.cdate.js',
+            'class.cookie.js',
+            'class.curl.js',
+            'class.rpc.js',
+            'class.bbcode.js',
+            'class.csuggest.js',
+            'main.js',
+            'chkbxrange.js',
+            'functions.js',
+            'menupopup.js',
+            'init.js'
+        ];
+
+        // load frontend messaging only for some pages
+        if (isset($_GET['showGuiMessaging']) && $_GET['showGuiMessaging']) {
+            $files[] = 'class.cmessages.js';
+        }
+    } else {
+        $files = $_GET['files'];
+    }
+
+    $js = 'if (typeof(locale) == "undefined") { var locale = {}; }' . "\n";
+    foreach ($files as $file) {
+        if (isset($tranStrings[$file])) {
+            foreach ($tranStrings[$file] as $origStr => $str) {
+                $js .= "locale['" . $origStr . "'] = " . zbx_jsvalue ($str) . ";";
+            }
+        }
+    }
+
+    foreach ($files as $file) {
+        if (isset($availableJScripts[$file])) {
+            $js .= file_get_contents ('js/' . $availableJScripts[$file] . $file) . "\n";
+        }
+    }
+
+    $jsLength = strlen ($js);
+    $etag = md5 ($jsLength);
+    if (isset($_SERVER['HTTP_IF_NONE_MATCH']) && $_SERVER['HTTP_IF_NONE_MATCH'] == $etag) {
+        header ('HTTP/1.1 304 Not Modified');
+        header ('ETag: ' . $etag);
+        exit;
+    }
+
+    header ('Content-type: text/javascript; charset=UTF-8');
+    // breaks if "zlib.output_compression = On"
+    // header('Content-length: '.$jsLength);
+    header ('Cache-Control: public, must-revalidate');
+    header ('ETag: ' . $etag);
 
-echo $js;
+    echo $js;
diff -x graphtree -Naru ./locale/lt/LC_MESSAGES/frontend.po graphtree/locale/lt/LC_MESSAGES/frontend.po
--- ./locale/lt/LC_MESSAGES/frontend.po	2016-02-26 17:45:56.000000000 +0800
+++ graphtree/locale/lt/LC_MESSAGES/frontend.po	2016-04-18 18:46:02.000000000 +0800
@@ -251,8 +251,8 @@
 msgid "Access denied!"
 msgstr "Prieiga uždrausta!"
 
-# 1 sekundei
-# 2-9 sekundėms
+# 1 sekundei
+# 2-9 sekundėms
 # 20-100 sekundžių and e.t.c.
 #: include/classes/api/services/CUser.php:1069
 #, c-format
@@ -1104,8 +1104,8 @@
 msgid "Bitwise AND of last (most recent) T value and mask is NOT N"
 msgstr ""
 
-# female - mirksinti
-# male - mirksintis
+# female - mirksinti
+# male - mirksintis
 #: adm.triggerdisplayoptions.php:38 adm.triggerdisplayoptions.php:39
 #: adm.triggerdisplayoptions.php:40 adm.triggerdisplayoptions.php:41
 msgid "Blinking"
diff -x graphtree -Naru ./locale/lv/LC_MESSAGES/frontend.po graphtree/locale/lv/LC_MESSAGES/frontend.po
--- ./locale/lv/LC_MESSAGES/frontend.po	2016-02-26 17:45:57.000000000 +0800
+++ graphtree/locale/lv/LC_MESSAGES/frontend.po	2016-04-18 18:46:02.000000000 +0800
@@ -575,7 +575,7 @@
 msgid "Add to host group"
 msgstr "Pievienot resursdatoru grupai"
 
-# Pievienot resursdatoru grupām?
+# Pievienot resursdatoru grupām?
 #
 #: include/actions.inc.php:622
 msgid "Add to host groups"
diff -x graphtree -Naru ./locale/pt_BR/LC_MESSAGES/frontend.po graphtree/locale/pt_BR/LC_MESSAGES/frontend.po
--- ./locale/pt_BR/LC_MESSAGES/frontend.po	2016-02-26 17:45:56.000000000 +0800
+++ graphtree/locale/pt_BR/LC_MESSAGES/frontend.po	2016-04-18 18:46:02.000000000 +0800
@@ -8434,7 +8434,7 @@
 msgid "Item \"%1$s\" already exists on \"%2$s\", inherited from another template."
 msgstr "O item \"%1$s\" já existe em \"%2$s\", herdado de outro template."
 
-# Very similar string !
+# Very similar string !
 # api/classes/CItemGeneral.php:100
 #: include/classes/api/services/CItem.php:38
 #, c-format
@@ -8717,8 +8717,8 @@
 msgid "June"
 msgstr "Junho"
 
-# In another strings the standard is:
-# Keep XXXX for (in days) 
+# In another strings the standard is:
+# Keep XXXX for (in days) 
 # Maybe change to the standard?
 #: include/views/configuration.host.discovery.edit.php:244
 msgid "Keep lost resources period (in days)"
@@ -10304,7 +10304,7 @@
 msgid "No interface found"
 msgstr "Nenhuma interface encontrada"
 
-# very similary
+# very similary
 # include/views/configuration.item.edit.php:112 include/views/configuration.item.massupdate.php:77 include/views/js/configuration.item.edit.js.php:84
 #: include/classes/api/services/CItemGeneral.php:282
 msgid "No interface found."
@@ -10340,7 +10340,7 @@
 msgid "No item with itemid \"%1$s\"."
 msgstr "Nenhum item com o itemid \"%1$s\"."
 
-# very similary
+# very similary
 # include/items.inc.php:493
 #: include/items.inc.php:516
 #, c-format
@@ -13182,7 +13182,7 @@
 msgid "Show events not older than (in days)"
 msgstr "Não exibir eventos mais antigos que (em dias)"
 
-# very similar
+# very similar
 # adm.gui.php:34 include/views/administration.general.gui.edit.php:43
 #: include/profiles.inc.php:165
 #, c-format
@@ -15284,9 +15284,9 @@
 msgid "User group sharing is missing parameters: %1$s for map \"%2$s\"."
 msgstr "O grupo de usuários compartilhado possui parâmetros ausentes: %1$s no mapa \"%2$s\"."
 
-# Oleksiy:
-# The original message is not beter like (double quotes on first parameter):
-# User group sharing is missing parameters: "%1$s" for screen "%2$s". 
+# Oleksiy:
+# The original message is not beter like (double quotes on first parameter):
+# User group sharing is missing parameters: "%1$s" for screen "%2$s". 
 # ?
 #: include/classes/api/services/CScreen.php:579
 #: include/classes/api/services/CScreen.php:915
diff -x graphtree -Naru ./styles/ztree/line_conn.gif graphtree/styles/ztree/line_conn.gif
--- ./styles/ztree/line_conn.gif	1970-01-01 08:00:00.000000000 +0800
+++ graphtree/styles/ztree/line_conn.gif	2016-04-18 18:46:03.000000000 +0800
@@ -0,0 +1 @@
+GIF89a	    !   ,    	   iP ;
\ No newline at end of file
diff -x graphtree -Naru ./styles/ztree/loading.gif graphtree/styles/ztree/loading.gif
--- ./styles/ztree/loading.gif	1970-01-01 08:00:00.000000000 +0800
+++ graphtree/styles/ztree/loading.gif	2016-04-18 18:46:03.000000000 +0800
@@ -0,0 +1,13 @@
+GIF89a   s   !NETSCAPE2.0   !
+  ,       0hE02\  ^De],_U.Fd !
+  ,      hj&PHa]	 !
+  ,      XTF8`	 !
+  ,
+     XTf4)j B@ !
+  ,
+     hVTJ( J !
+  , 
+    hjE`. ]	 !
+  , 
+    "8X!eA-	 !
+  ,      f!)j-42HE ;
\ No newline at end of file
diff -x graphtree -Naru ./styles/ztree/zTreeStandard.gif graphtree/styles/ztree/zTreeStandard.gif
--- ./styles/ztree/zTreeStandard.gif	1970-01-01 08:00:00.000000000 +0800
+++ graphtree/styles/ztree/zTreeStandard.gif	2016-04-18 18:46:03.000000000 +0800
@@ -0,0 +1,33 @@
+GIF89a a  Lѥ䫊da됏sP땻_Th2GL}9r^ǻϭ!!jJҹͪGLi؈)Z`99MpxdݜװԮeiwoOBX[2gsчtrfҞxɔޔk߸`a}ts{q򪭩ؔ㧶v텘yO˂s׬Ң   Cֶ{xQ!   ,     a  }b3'3b}44;xBB}
+}HM43H}
+å̡rQQra??a֌BM㮏
+9D s C`p SDHQGpl[.>!8FX3P"ir͛dxaiiXģ",.:%TX!$?r2+q5t8鰵̳j޴ib[I	ЁA78F@Xk}>[U9(z%G%TepAF&Rcˆ]dZ0r Dl.q[^L  Nn~ҕhG`Xpwz=~?Q?-ZDa!]`JdA($85]fvDdP<?.7z4I表&E$ 4x_P[9_pא~!^ ~YLFWt g|@xL.74"'aLQ	LHP(y"?$wiP9MʎdK5R3h.+A*)~v&.,0Ǩ>Jj~p(jhQ'
+w(h#S({(P=#ԞB|s g_߆鎰 Q` x݉A0@" EJBHd#(#x
+x!1}8x(.8ǷHdzKGȝQ0@ѰhxH!Bm#D2I'Ig.2+J}2՛-+1;ojP#J@=Wpq(&uv"k߀#P0 l)Pц`~~4=	_H?tLq0P<8'6:8VTC2P{:pOP@OL\.?}ƝMpbb@ 4t`R;7NA2PKGч5k`>>2H<}9nE
+AB 6HA
+lm1a+ޝ< 	2ݠ+GL2'm@!O h[Ġ_xƥn9 :zWD&@	4DȠȀfx揁2ZPe-9D F bC1Jlc|@@t"SD(AxRpPK,7i[<  T |!1	XDwb9=d@"3@s~*PHg"Ff/l4`[K@ag@̂sփ.@>D%7\Xy%ԗȧ>i`,`]dl6`Ka*S,7ͩEp)P3 tT2@xJ$GMT@*=|"oȰŲ	O
+ZS5-H#֚	rC xJ6U8܀*uq{pO"L6\d0Z6k"ik}hK6smh_֒+8X"kSuчê[oܭErQ{3pU!+M0+P0]
+>`un՜"ԛEx	4c*q5 1Ռ0+ OF2`;A%USS[1
+F-C
+@ B
+p8qޢa>m[V3.Sں5A
+-`O	VrhNs  t9csv6!M	:z,
+GA2|dښ@&)# 6@
+@:Uҙf4yΤV16nf& aj}kmYMXCӯ͏J2t`wld+өVQ8ڬ\݈zCpx;5`j0r+R`'}O|{' 6Wlk3`C=mq
+O7c⦋6>%h`Ͱn@a	(G»KaON xCwy7Ct69:V]7}ۯ@9>:R_B.^c|g x &T"H+@F3cJ?)9bCwzf)7n	gԾ$e?@RIJ"ά&bjwgWO^n]gP/h~i*Ӛt&4qS?,@& ͂'A@}맛5/7ƃw!;.|!ENq@# 3lاn} lg(0@ ր
+`C
+ 0vp~@~@ q R/S
+SAu j&gӖ~ $MPki@5x9;؃3=	o~g?BB$FB(V*8S5^>f4>^69	x؁L?'Q(9BZEZ[rePsXU6o~xEoL焋,/~/R Ȳe^U^ՅCc9E։&	"K\`l$30a	b/`#?#<ă?ʣ'<D ={FHBf"ʵ"uW~fP	:#D/?@c.bYc16c@?c<ŨnEjCVDX@@2$"&%hujȊHi6>co`veHf^vflDTqmW0'`d@m mW &+3na!aa22@* J${8#9P9ij#m!Ae@RDd-FEp EmrNqWHfJ.Lhx	;!)kC;iOlɶl;x_q' u!r0<-/&h>4P	o6J%PzJ@Nw	KD Rg!@S Zږ&Æө0J{|6NjW@NDmI"K`3Aosه]uE`mECe8dt;cr9MQkp2ɹ"ՖpR	
+c (~g^FsWwT	rFv#}MePE I`4in-ɓ	
+(:hyzB
+z{[XEni[pXW@`2ꏆ UJ`%h;Z	=J$=
+g|dMW|Ȅ|iz[Wuv[䄌u{Fdt}IP   PPPŨc=:0	~
+dH0_*CbS>`/fS8S)S3S-詰
+(
+C _6UxDWUWʫ*0
+l`p2t0>ꬱ	
+!5=2ZDrZy5$JM{?-A ;>>:`ؚ_#ו]]h]{p۱믌p_Cc/vIaeA0`g` D۱GUO	B)_@PccZc`c:k=lO{wQ&~  0@EٷHP;0w0Xji)fea{6ph[d2k˶KK[t{;BK;`bdjYJp&p#Q  UiiW`ֻYB 
+l [
+ϫ2>˪b	&+2Y	`wdpj  K8	澎9t(:{;0  ~QCb*|Y`pw o	($nKprK0y{&dyi5PUd0~pB+|A;jHQܴI&֚#Ú P*U9ttE5$,MċD7<<I.WC~l"sQQ|`.` !Jwl4mZrگ; |		 !рI_o* *z$zmtZL ЬH	L$6r  	e0&e U` Mkz|hMLzuY ] ce<CPC0el<,/* L 8<ES ઩бXPP'<r# .-C SCWZ!=$?Q/ >tXwh; ?m+Ҍ #e# 0	՞Ju"6#	 FGg\	0f_j,3bзI ]d +Cd :b:|k]lZpȝ*# h3cVyfP*ڞWit	"p@m+! 2Z͟)I`;ˀ\'"gB up <Ca}	BFm3A  7"v4p @KuydK	RR 
+06䑚h) 
+Jp v Z_չ>7>e04Q;0w$z;Xff NEǔ^Iƀ !ܽ垚<VoJg  /z< FOp &cp OԂ>T`, 6 OO ֓>6+3鋰 m^Ӻ >Ǵ@ gc. !^XPrOprX>ua`px항j@( ;
\ No newline at end of file
diff -x graphtree -Naru ./styles/ztree/zTreeStandard.png graphtree/styles/ztree/zTreeStandard.png
--- ./styles/ztree/zTreeStandard.png	1970-01-01 08:00:00.000000000 +0800
+++ graphtree/styles/ztree/zTreeStandard.png	2016-04-18 18:46:03.000000000 +0800
@@ -0,0 +1,41 @@
+PNG
+
+   IHDR      a   Q{<   tEXtSoftware Adobe ImageReadyqe<  +GIDATx}	|T}ɾADkXT@iRZ)ZUKO,O[JEvD@@v@B2YI&3oM޼y3L&Dy̻{g2s9{vZŗB	ZK`p\ʀYAϸHqBu[3%;zNr BI(-=}Cš>~}`ސ;:^X8]Z{`Ͱi)T\I۩
+9cr|N5dmܳ1X,MڋCٸ;`4aa~;nc[}B2ͤNJiG.`߇'drѓ  ~rѤ.fFBXAL|,=8JuɤsIk<`$`ȧR_3LL"MKoUeqZwr5lk.-[S/V38b\cVd~|v%Oy֮67rCd-D>8(,`jhH~_LyդrýOxbJ>8\D|#ì	Ch)N-W-U[%q'.#,!?㯳£V]P8Y W+`{KaZϱ@۰uO^ӮR\q9`5C,V8r =>6}S5%4p޻ o!OHR0p[07s`X$̝;h<f	]xv;lӁslޅrwd:{iK/ô5|C{&ow2*^(m|?r7F钒=.۷<,vעM
+2ￏ=@o4\\+!)#t%壟!/9}O~|܋|aԊC0χ([WL|f6{X0\gͅ8$DpmtȗZq\Nk^;bCi} Z F`߲oPNMPTR53~u6 =!`|BV|
+9e`%RKsi웒4!itP_[AIYCGH`% b<^R!$&W]ϝYϧ$t26bɔQ*p|V>
+pBLXx+Xdbr8|BO|ݞeA=ߖnFmgAnTrބyCI:)Mq(8<s	HS;جfY7e)l6,~_+و'[혃qx,oF'axb8|^,MR8JG|g;e?HIܵĉl0SCY@ƿ8	ISii!vyD<,h[Y<mè,y,,7J|lz?/C{O
+w-ajŘC<FR[&=;eFs+eiIS|/0|)ɼF\ɯO!	1\\dys}cM&Z-&n^M"7P ~uI玃
+^^=}f*}~3?}ɡ񀡘xƓSxm8|ҞCo(ZY_LxF"d>~km>1װe+/6H&F^v)x۰EɂPq<0Y:L`.yx_*Z0©J懐/qaax#oÙ
+ʣ^K;XMu_zd᠊#G|B_J *h׃}1r-Ĩ ^*EC6􀡐W/mnkO0zyZ ?b̌WKZ7 4ѱd}/9A'#[NA^I_o-[z1FKS_IoPiT2;d`5Aiy8Ѱ+KI#rOv0S>5'z-j9_fnU˞mxW[s}R=)=V^[W|=cz3"'E1Z̥u[x3Ep*>&C-dULd1	V։V,P!В2s	~fGF)w2l>p	T` asQ>BEܣǶwؑiCBG"D,$D{/`so72~z:9
+	uc@Q&FD,#C߼x:5&>V9~5L(Zvq5'cSrG&ZƵkn;\ EHع'ɇ-		E{xUO"pl>	S2jj=``azcJ.y0J"z>$.ʠs8j1n8}$LâG324+`rj -폢1:b:1mOBlɛ>[^O=B.[=)3A'FT7L_Xq푹π:@DơFJm(z0pw✚T<k5r_pH>ү$q
+0.kᴠXp~4#H>ZO9l>71_K$m8.>ч|3"a:FtpAo*n$7R8T4`apz@B;3`=iXWO۰G3	y@wP$Aۤ0bL.YkRsT᥆pڭګύ|^w{@>-uz@a>ԆwMd1W-athr}1a 0vB8<5ݸ@j1u8)Cjo)nkqFRHnuѭ8u(@Ŋ`zx>1 ѓzPz<poׅnuz@0þ$q,|L0jŀn8}C,MYl.Mj!rOIn՝4k?	ᑉRr%׬M\APR'Xm.x:O 1%^I1qx|x1(؝Zx=$r1P+}U-4_ӨUeJIB\7Zm=
+i	O57^<rGh'1F.ܶoZr<
+Q>z@1ԝfX<;NO(K0eQkNݢI$	YyZ D"#jVyebQYb`?
+j9!\VEoHx}zOxJ@6Y*'Gr<<ý{P:}=u,9x·e/vll}Qq:uv#ڄlZD1 sÕPॆ1j6뛲#¢H֓ԃqi04{kׂbh"=9m10nx[1Wz>4듼FZ;usr(^C0tNAΪPX A[M0d&`ө28)N$1ZB	<L	d'+q{65
+\RzanfEtTڝP~th#b_,,u3oR+_20rL_zN
+Ң/bj1g:,J_X<#¡%e氹~ SG=౻g`mSs£2Aq`o":,at쥼H 2qјU'U}ܒ8ȌאP	89	"7oY_ë6̵'1I/=އ|z?3VEs;]J3'=y]X!	Cu+(䮾G!2OLtƐItMeӗ6_>㗄Z6]`&AKT2*s49GakIkڝ!&;/4$Y/`OT/.Hjj:b~S$Ҧ81⍨xBB+$|bw=P|2=:*W@^y-X-/٩FC؈B.z#!1f@)p¡ڢ{¸-׷g0&my:br8<5N&UB6$=`GPr	|>WGN]+I>~|a`X=kH2L0,#qD2c)jg?Cיk0ΊoZֺ:bcce+Foom?:|s% nn"N]/-S3iR@NB´8[ZCn`Kyf`T6XoUA:,OB)[K 0Л]R>V.S[RhL3V]7쏄V
+R|phRapd,"ҭ1{-
+̖bJBuߦÕ10{£>kq.|ţS2QxfRͭOW`2+2y[}'e?=|'B&dj@x-Z_1FK3$}(>[:1<r5w!ЗTCAA~IoINK>;lqwK>!nBV?\4Z׹(x/30a@	p`HG>[ǹ^;*7bax>!L?{`;ydZnnn]]^_fk=b]?mE5HQkC!cOZCff嫏EJ8k4&.<6){:9Xuke$qۉ>t$"
+IV"=%	kY-xAz<zaZ/H= B}X0	qN#//LmI;FmT\3QpQ SdS:A*cq:#9]x+M@am?͍6~
+xچ}Ta*Om?y= QoHB1bZok(.R_2?A+#H(T-p$GwW
+8w߽hwm?2Bҟ%Wf絛GS%	B6ᥓRO>P ׽&^Lhnnɇs$W/T+lr)lYGг[%0rUFHB:C^*5]!)M@/}1R{x8?z9"%VT"-5^8$ֆ`c%e`1J^g#$0j<Bp75LW"QK>p@S04qӡ`O텳~y;~8+cv:;;zz^Sa`SA=tNm$߅!>ݼV"ǀBvV1	7|=棆	YkP#(&! >z*k[;IFw..'9`풵aF؞o&}Ԅj`TN<*B	L6,>`K06u W<Qq`m.X^E4ݞN}DYfނajZwMbp&ߕ3q)Mkiߡ37|mwA^',QW {L|@56̏y!Q=Lf،'	ZB	0k@<5^Fxኑ|Xo5L|-c;pzFo%%%Tt^ЯKUM\OGXLm?1BO)JՆa ka@ ǀ|>!`QaTk@$ġ󧆱e^δP#:55UF)!y-ОTmp=րjambk7vMV0-c{,lF&5aDδ0:Pۏ#Tm:V!DZPIcVp͇Ӯ̭s rez]w:7͟F,*e˖a<+F{̙p5݀:@02L\0X9*/0eQ+a=7If,$/JS wcrjP,B%K+^nݩ{abWapj0+P4!GpHT@q'D0pR.'0<. D5{a.CJ(	Cw=I*!\?\
+RzM}qX`XױhG+K5J*|^&9&}p$ŀu[	xB/-*he!ʩFE8-;O ^$1ͼՆTÐ+!k[ax[R{;=JW&kC)ܾ,xPWtL:!{'RILG^Ӈ[PX91:6L5d,|L0j!Lv{Lăy*#q~yX׆6^UT|sq/-!ݙB5C
+X%aXf99-72&{Wcry^;ut7H^75̭bx!y0reJdoޒW[ĵxsOUP\3iS!,TTI=3XV})Uju	5e^1	 D^>.joqL>y?O _J@tHKhck[uSl(*h+*.#-㚛A8WϞJfldT|`|Gq?$H>É0OSW5fh~M>`$C'f sɠАD(AMvV頴V_QlmWbka<oYM'ws3TA Ul_N=t4}ry>w]@$^H䓓WK̑^8>S	Hci齔z=8UJ_PqwE4?"ҹۚA˩>l29gr+/5}|m?lĞ~뢎ubq}qv<dJ르Lhl-=R}pe]E{?$4*+οuL`Z<+ik*Z:cxmIPu5ed}6ȇ|Br{""8ͳԚpWKK\
+g4v`PL
+h4VZM5G~
+_3D3}FCI$F/9U,|	6ˋoa^7`X`TK̦VwJ+~
+B\(F7˖-:7нag.$g[0X	8ᆃT*S&C ~\
+ĳχJuuEҥKZ܇k_.m~/χ&؍,d2hן'aS&|K˓/99CיvO+N5!>X=W놪q/o;<K>&/RvQ뀡wqk%(݋IOd1F2ԗ;Mfett${/S=TD#		?/Wkaov?Jja+ys,yGB&#uQi48Z*a=`(㐄"˭)au2UD--J&ջȸδvstf}h{}_>.^x8W:R]-BXzhJؤ鷻dN|B
+:Ý
+LcS&
+w4Ѓ!_sS]qa7Rbyo]Y?ka1M_]tr~Z*LwOʌpx	(⣷Le#1HqFZZ5=<:~xxa> %p=*&t1eQ+v=D:n"P(t2`Lx<u]3>'G1Y#ɔCޟȘ+-,zIm,OX3FJ+vbi5Fr<b'z/%݌8+'ϊ(7~	PW`U+OEpmf>XKJu:Y֝#Qfe\q~c5o]ɦPF*dRa7777t*K>8)Y}'ҫ72JrFiI\\r*;w'F095b5%XKHgt,"Q_c6GQr 	ؤc4AĵUl	0εi{(z$S&\
+6ST	CkR_= oB=!X(8oJcwyb%>VC#"uع0ՌN80,ϝ>TG>Oڗކ];۳<PF`
+Bq`_ H>`|FM뎒~Vnk[͜LK#Hx.7cN\Z+Si
+Q gt+1䷏|Ǉ<L.SD\ CΏ~z{8]mcN"u_= &P7=12{ N<2Z8k;ׁ='CHl!F<,! 6w~|iJa%Ɂal?xCmIhvaSzGĴd'|SM)%ABM~2DX/L+׽ LX9#ȃ> {4щ:D,LXSA5 EUn7==cgbt1@B.Y4S@E%^Yw 䣠vɑczɄ$=`_ ֓{wzӑfw[<aK9p/o؂ ł,<qjSud'KUYi!$@&˴Hj!ޚ\`_ļzz$deIٍPG3.yˋ̭_\;v6u /M 76Aɣ~9Lu;8[qh-/Y%S*+p/JuRߖ{>pĶ-VmYȖGψjɲR/Çr{ u4^w6-.r!k
+kr-ů2;?[ SoB#[*JܿeZ!%NJ(6Y_7_("xPw^pun:Ix}8_--ZqGMMo7:"m6g\A)V=	6)w[	xфP;9OTCk9ו8Rz@vur'9'u>`u؂QG2oq:cuMDCvn^'Fq=AǅAV?׫Zc׬ۣ!D;zh[wzy.P/Z`>ሶMkVVOȐ/:&`UGKz:VB3&!Yi	2]FO oVjjj2x۰Eb.b7P](i&A;xu^&qC!_o
+"..Nje4]{I򮍘VU4t7Hut1Ʌ 񦉬^	oo%aee3"""bZFyP)H?[ε}&v{n3!X;U3
+ʲ޽LϚ&LAY!!菉>}=|/&`&&3]V@J anw4ěL%.]Z2cƌ{zT+H<@;'СCaiMn4!av[Dqf+//:)x+e	l
+
+
+,}6ir1I}Ru	xwv|"4rWBB?^ȗU-77Wsc7v;QNδhg{]G;v,jR9O>=1"Ċ[FcƌWcǎunnRJy7w@C6m^[Jddd.rZ@=Zo73'''涶b!2vyF_:OMZ˹s8p?5Dj9Z/L[\\>Xܻ7cW\'''zj	NPaC#`2%w:AB_tn  iv"vA    IENDB`
\ No newline at end of file
diff -x graphtree -Naru ./styles/ztree/zTreeStyle.css graphtree/styles/ztree/zTreeStyle.css
--- ./styles/ztree/zTreeStyle.css	1970-01-01 08:00:00.000000000 +0800
+++ graphtree/styles/ztree/zTreeStyle.css	2016-04-18 18:46:03.000000000 +0800
@@ -0,0 +1,108 @@
+/*-------------------------------------
+zTree Style
+
+version:	3.4
+author:		Hunter.z
+email:		hunter.z@263.net
+website:	http://code.google.com/p/jquerytree/
+
+-------------------------------------*/
+
+.ztree * {padding:0; margin:0; font-size:10px; font-family: Verdana, Arial, Helvetica, AppleGothic, sans-serif}
+.ztree {margin:0; padding:1px; color:#333}
+.ztree li{padding:0; margin:0 0; list-style:none; line-height:14px; text-align:left; white-space:nowrap; outline:0}
+.ztree li ul{ margin:0; padding:0 0 0 12px}
+.ztree li ul.line{ background:url(line_conn.gif) 0 0 repeat-y;}
+
+.ztree li a {padding:1px 3px 0 0; margin:0; cursor:pointer; height:17px; color:#333; background-color: transparent;
+	text-decoration:none; vertical-align:top; display: inline-block}
+.ztree li a:hover {text-decoration:underline}
+.ztree li a.curSelectedNode {padding-top:0px; background-color:#FFE6B0; color:black; height:16px; border:1px #FFB951 solid; opacity:0.8;}
+.ztree li a.curSelectedNode_Edit {padding-top:0px; background-color:#FFE6B0; color:black; height:16px; border:1px #FFB951 solid; opacity:0.8;}
+.ztree li a.tmpTargetNode_inner {padding-top:0px; background-color:#316AC5; color:white; height:16px; border:1px #316AC5 solid;
+	opacity:0.8; filter:alpha(opacity=80)}
+.ztree li a.tmpTargetNode_prev {}
+.ztree li a.tmpTargetNode_next {}
+.ztree li a input.rename {height:14px; width:80px; padding:0; margin:0;
+	font-size:12px; border:1px #7EC4CC solid; *border:0px}
+.ztree li span {line-height:16px; margin-right:2px}
+.ztree li span.button {line-height:0; margin:0; width:16px; height:16px; display: inline-block; vertical-align:middle;
+	border:0 none; cursor: pointer;outline:none;
+	background-color:transparent; background-repeat:no-repeat; background-attachment: scroll;
+	background-image:url("zTreeStandard.png"); *background-image:url("zTreeStandard.gif")}
+
+.ztree li span.button.chk {width:13px; height:13px; margin:0 3px 0 0; cursor: auto}
+.ztree li span.button.chk.checkbox_false_full {background-position:0 0}
+.ztree li span.button.chk.checkbox_false_full_focus {background-position:0 -14px}
+.ztree li span.button.chk.checkbox_false_part {background-position:0 -28px}
+.ztree li span.button.chk.checkbox_false_part_focus {background-position:0 -42px}
+.ztree li span.button.chk.checkbox_false_disable {background-position:0 -56px}
+.ztree li span.button.chk.checkbox_true_full {background-position:-14px 0}
+.ztree li span.button.chk.checkbox_true_full_focus {background-position:-14px -14px}
+.ztree li span.button.chk.checkbox_true_part {background-position:-14px -28px}
+.ztree li span.button.chk.checkbox_true_part_focus {background-position:-14px -42px}
+.ztree li span.button.chk.checkbox_true_disable {background-position:-14px -56px}
+.ztree li span.button.chk.radio_false_full {background-position:-28px 0}
+.ztree li span.button.chk.radio_false_full_focus {background-position:-28px -14px}
+.ztree li span.button.chk.radio_false_part {background-position:-28px -28px}
+.ztree li span.button.chk.radio_false_part_focus {background-position:-28px -42px}
+.ztree li span.button.chk.radio_false_disable {background-position:-28px -56px}
+.ztree li span.button.chk.radio_true_full {background-position:-42px 0}
+.ztree li span.button.chk.radio_true_full_focus {background-position:-42px -14px}
+.ztree li span.button.chk.radio_true_part {background-position:-42px -28px}
+.ztree li span.button.chk.radio_true_part_focus {background-position:-42px -42px}
+.ztree li span.button.chk.radio_true_disable {background-position:-42px -56px}
+
+.ztree li span.button.switch {width:14px; height:18px}
+.ztree li span.button.root_open{background-position:-92px -54px}
+.ztree li span.button.root_close{background-position:-74px -54px}
+.ztree li span.button.roots_open{background-position:-92px 0}
+.ztree li span.button.roots_close{background-position:-74px 0}
+.ztree li span.button.center_open{background-position:-92px -18px}
+.ztree li span.button.center_close{background-position:-74px -18px}
+.ztree li span.button.bottom_open{background-position:-92px -36px}
+.ztree li span.button.bottom_close{background-position:-74px -36px}
+.ztree li span.button.noline_open{background-position:-92px -72px}
+.ztree li span.button.noline_close{background-position:-74px -72px}
+.ztree li span.button.root_docu{ background:none;}
+.ztree li span.button.roots_docu{background-position:-56px 0}
+.ztree li span.button.center_docu{background-position:-56px -18px}
+.ztree li span.button.bottom_docu{background-position:-56px -36px}
+.ztree li span.button.noline_docu{ background:none;}
+
+.ztree li span.button.ico_open{margin-right:2px; background-position:-110px -16px; vertical-align:top; *vertical-align:middle}
+.ztree li span.button.ico_close{margin-right:2px; background-position:-110px 0; vertical-align:top; *vertical-align:middle}
+.ztree li span.button.ico_docu{margin-right:2px; background-position:-110px -32px; vertical-align:top; *vertical-align:middle}
+.ztree li span.button.edit {margin-right:2px; background-position:-110px -48px; vertical-align:top; *vertical-align:middle}
+.ztree li span.button.remove {margin-right:2px; background-position:-110px -64px; vertical-align:top; *vertical-align:middle}
+
+.ztree li span.button.ico_loading{margin-right:2px; background:url(loading.gif) no-repeat scroll 0 0 transparent; vertical-align:top; *vertical-align:middle}
+
+ul.tmpTargetzTree {background-color:#FFE6B0; opacity:0.8; filter:alpha(opacity=80)}
+
+span.tmpzTreeMove_arrow {width:16px; height:16px; display: inline-block; padding:0; margin:2px 0 0 1px; border:0 none; position:absolute;
+	background-color:transparent; background-repeat:no-repeat; background-attachment: scroll;
+	background-position:-110px -80px; background-image:url("zTreeStandard.png"); *background-image:url("zTreeStandard.gif")}
+
+ul.ztree.zTreeDragUL {margin:0; padding:0; position:absolute; width:auto; height:auto;overflow:hidden; background-color:#cfcfcf; border:1px #00B83F dotted; opacity:0.8; filter:alpha(opacity=80)}
+.zTreeMask {z-index:10000; background-color:#cfcfcf; opacity:0.0; filter:alpha(opacity=0); position:absolute}
+.ztree li span.button.add {margin-left:2px; margin-right: -1px; background-position:-144px 0; vertical-align:top; *vertical-align:middle}
+/*
+div#rMenu {position:absolute; visibility:hidden; top:0; background-color: #555;text-align: left;padding: 2px;}
+div#rMenu ul li{
+	margin: 1px 0;
+	padding: 0 5px;
+	cursor: pointer;
+	list-style: none outside none;
+	background-color: #DFDFDF;
+}
+*/
+
+/* level style*/
+/*.ztree li span.button.level0 {
+	display:none;
+}
+.ztree li ul.level0 {
+	padding:0;
+	background:none;
+}*/
\ No newline at end of file
